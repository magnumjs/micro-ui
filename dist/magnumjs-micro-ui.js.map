{
  "version": 3,
  "sources": ["../lib/reactive-core.js", "../lib/outlet.js", "../lib/diffHTML.js"],
  "sourcesContent": ["import Outlet from \"./outlet.js\";\nimport diffHTML from \"./diffHTML.js\";\n\nexport function createState(initial) {\n  let state = initial;\n  const subs = new Set();\n\n  function setState(next) {\n    state = typeof next === \"function\" ? next(state) : { ...state, ...next };\n    subs.forEach((fn) => fn(state));\n  }\n\n  function subscribe(fn) {\n    subs.add(fn);\n    fn(state);\n    return () => subs.delete(fn);\n  }\n\n  function get() {\n    return state;\n  }\n\n  return { get, setState, getState: get, subscribe };\n}\n\nexport function createComponent(\n  renderFn,\n  { onMount, onUnmount, onBeforeMount, onBeforeUnmount, events = {} } = {}\n) {\n  let el = null;\n  let mounted = false;\n  let props = {}; // props will now just be a normal property on api\n  let lastHTML = \"\";\n  let onBeforeMountDone = false;\n\n  let state = {};\n  const setState = (next) => {\n    state = typeof next === \"function\" ? next(state) : { ...state, ...next };\n    render(props);\n  };\n\n  const api = {\n    refs: {},\n\n    mount(target) {\n      if (mounted || onBeforeMountDone) return;\n\n      const proceed = () => {\n        onBeforeMountDone = true;\n        el = target;\n        mounted = true;\n        render(props);\n        onMount?.call(api);\n      };\n\n      runBeforeHook(onBeforeMount, proceed);\n    },\n\n    mountTo(selector) {\n      const target = document.querySelector(selector);\n      if (!target) throw new Error(`No element matches selector: ${selector}`);\n      api.mount(target);\n    },\n\n    update(nextProps = {}) {\n      if (!mounted) return;\n      const changed = Object.keys(nextProps).some(\n        (key) => nextProps[key] !== props[key]\n      );\n\n      if (changed) {\n        props = { ...props, ...nextProps };\n        api.props = props; // \u2705 Keep api.props up-to-date for event handlers\n        render(props);\n      }\n    },\n\n    render(newProps = {}) {\n      props = { ...props, ...newProps };\n      api.props = props; // \u2705 Same here for initial mount\n      let html =\n        typeof renderFn === \"function\" ? renderFn.call(api, props) : renderFn;\n\n      // Inject slots (named and default)\n      html = Outlet(html, props);\n      if (html === lastHTML) return null; // No change\n      return html;\n    },\n\n    get renderFn() {\n      return renderFn;\n    },\n    unmount() {\n      if (!mounted || !el) return;\n\n      const cleanup = () => {\n        el.innerHTML = \"\";\n        mounted = false;\n        onBeforeMountDone = false;\n        onUnmount?.call(api);\n      };\n      runBeforeHook(onBeforeUnmount, cleanup);\n    },\n\n    get el() {\n      return el;\n    },\n    // get props() {\n    //   return props;\n    // },\n\n    get state() {\n      return state;\n    },\n\n    setState,\n  };\n\n  function render(currentProps) {\n    props = currentProps;\n    const html = api.render(props);\n    if (html === null) return; // \u2705 skip rendering\n    const replaced = diffHTML(el, html);\n    api.refs = {};\n    if (el) {\n      el.querySelectorAll(\"[data-ref]\").forEach((node) => {\n        api.refs[node.dataset.ref] = node;\n      });\n    }\n    bindEvents(replaced);\n  }\n\n  function bindEvents() {\n    if (!el || !events) return;\n\n    const root = el.firstElementChild;\n    if (!root) return;\n\n    Object.entries(events).forEach(([key, handler]) => {\n      const [eventType, selector] = key.split(\" \");\n      if (!eventType) return;\n\n      // Remove existing bound\n      if (handler._bound) {\n        root.removeEventListener(eventType, handler._bound);\n      }\n\n      const bound = (e) => {\n        const match = selector ? e.target.closest(selector) : e.target;\n        if (match && root.contains(match)) {\n          handler.call(api, e);\n        }\n      };\n\n      handler._bound = bound;\n      root.addEventListener(eventType, bound);\n    });\n  }\n\n  return api;\n}\n\nfunction runBeforeHook(onBeforeUnmount, cleanup) {\n  if (onBeforeUnmount) {\n    if (onBeforeUnmount?.length) {\n      onBeforeUnmount(cleanup); // callback style\n    } else {\n      Promise.resolve(onBeforeUnmount?.()).then(cleanup); // promise style\n    }\n  } else {\n    cleanup();\n  }\n}\n\nexport function renderList(\n  array,\n  renderFn,\n  keyFn = (item) => item.id ?? item.key ?? item\n) {\n  return array\n    .map((item, index) => {\n      const key = keyFn(item, index);\n      const inner = renderFn(item, index);\n      const hasWrapper =\n        typeof inner === \"string\" && !inner.trim().startsWith(\"<div\");\n      return hasWrapper\n        ? `<div data-key=\"${key}\">${inner}</div>`\n        : inner.replace(/^<div/, `<div data-key=\"${key}\"`);\n    })\n    .join(\"\");\n}\n", "export default function Outlet(html, props = {}) {\n  if (typeof html === \"string\") {\n\n      const { children = {}, slots = {} } = props;\n\n    html = html.replace(\n      /<slot(?:\\s+name=\"([^\"]+)\")?>([\\s\\S]*?)<\\/slot>/gs,\n      (_, name, fallback) => {\n        const { children, slots } = props;\n\n        if (!name) {\n          // Default unnamed slot\n          if (typeof children === \"object\" && children?.default != null) {\n            return children.default;\n          } else if (typeof slots === \"object\" && slots?.default != null) {\n            return slots.default;\n          } else {\n            return typeof children === \"string\" ? children : fallback;\n          }\n        }\n\n        // Named slot lookup\n        if (typeof children === \"object\" && children?.[name] != null) {\n          return children[name];\n        } else if (typeof slots === \"object\" && slots?.[name] != null) {\n          return slots[name];\n        } else {\n          return fallback;\n        }\n      }\n    );\n\n    // Replace <div data-slot=\"footer\">...</div> with children or slot\n    html = html.replace(\n      /<([a-z]+)([^>]*)\\sdata-slot=\"([^\"]+)\"([^>]*)>(.*?)<\\/\\1>/gis,\n      (_, tag, before, name, after, fallback) => {\n        const content =\n          (typeof children === \"object\" && children[name]) ||\n          slots[name] ||\n          fallback;\n\n        return `<${tag}${before}${after}>${content}</${tag}>`;\n      }\n    );\n  }\n\n  return html ? html : \"\";\n}\n", "export default function diffHTML(el, newHTML) {\n  if (!el) return false;\n\n  const temp = document.createElement(\"div\");\n  temp.innerHTML = newHTML;\n\n  const newChildren = Array.from(temp.children);\n  const oldChildren = Array.from(el.children);\n\n  const newKeyed = new Map();\n  const oldKeyed = new Map();\n\n  // Index new keyed nodes\n  for (const child of newChildren) {\n    const key = child.dataset.key;\n    if (key) newKeyed.set(key, child);\n  }\n\n  // Index old keyed nodes\n  for (const child of oldChildren) {\n    const key = child.dataset.key;\n    if (key) oldKeyed.set(key, child);\n  }\n\n  let cursor = 0;\n  for (const newChild of newChildren) {\n    const key = newChild.dataset.key;\n\n    if (key && oldKeyed.has(key)) {\n      const existing = oldKeyed.get(key);\n\n      // Update innerHTML if different\n      if (existing.innerHTML !== newChild.innerHTML) {\n        existing.innerHTML = newChild.innerHTML;\n      }\n\n      const currentNode = el.children[cursor];\n      if (currentNode !== existing) {\n        el.insertBefore(existing, currentNode || null);\n      }\n\n      oldKeyed.delete(key);\n    } else {\n      // Insert new node\n      const currentNode = el.children[cursor];\n      el.insertBefore(newChild, currentNode || null);\n    }\n\n    cursor++;\n  }\n\n  // Remove any leftover keyed nodes not used\n  for (const leftover of oldKeyed.values()) {\n    leftover.remove();\n  }\n\n  // Remove extra unkeyed nodes if new is shorter\n  while (el.children.length > newChildren.length) {\n    el.lastChild.remove();\n  }\n\n  return true;\n}\n"],
  "mappings": "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",
  "names": ["reactive_core_exports", "__export", "createComponent", "createState", "renderList", "Outlet", "html", "props", "children", "slots", "_", "name", "fallback", "tag", "before", "after", "content", "diffHTML", "el", "newHTML", "temp", "newChildren", "oldChildren", "newKeyed", "oldKeyed", "child", "key", "cursor", "newChild", "existing", "currentNode", "leftover", "createState", "initial", "state", "subs", "setState", "next", "fn", "subscribe", "get", "createComponent", "renderFn", "onMount", "onUnmount", "onBeforeMount", "onBeforeUnmount", "events", "el", "mounted", "props", "lastHTML", "onBeforeMountDone", "api", "target", "runBeforeHook", "render", "selector", "nextProps", "key", "newProps", "html", "Outlet", "currentProps", "replaced", "diffHTML", "node", "bindEvents", "root", "handler", "eventType", "bound", "e", "match", "cleanup", "renderList", "array", "keyFn", "item", "index", "inner"]
}
