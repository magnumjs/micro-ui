/*!
 * @magnumjs/micro-ui v1.10.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var K=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var de=Object.prototype.hasOwnProperty;var pe=(e,t)=>{for(var n in t)K(e,n,{get:t[n],enumerable:!0})},me=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of fe(t))!de.call(e,r)&&r!==n&&K(e,r,{get:()=>t[r],enumerable:!(o=le(t,r))||o.enumerable});return e};var he=e=>me(K({},"__esModule",{value:!0}),e);var Ie={};pe(Ie,{__VERSION__:()=>ge,context:()=>k,createChannelMap:()=>z,createComponent:()=>se,createState:()=>ie,getComponentById:()=>Z,globalComponentRegistry:()=>N,registerComponent:()=>oe,renderList:()=>ne,shared:()=>ce,unregisterComponent:()=>re,useContext:()=>Se,useCurrentComponent:()=>w,useEffect:()=>we,useEmits:()=>ve,useFetch:()=>Ee,useState:()=>xe});function G(e,t){if(!e)return!1;let n=document.createElement("div");if(n.innerHTML=t,n.children.length===0&&e.children.length===0&&n.textContent)return e.textContent!==n.textContent&&(e.textContent=n.textContent),!0;let o=Array.from(n.children),r=Array.from(e.children),c=new Map,s=new Map;for(let i of o){let l=i.dataset.key;l&&c.set(l,i)}for(let i of r){let l=i.dataset.key;l&&s.set(l,i)}let a=0;for(let i of o){let l=i.dataset.key,b=e.children[a];if(l&&s.has(l)){let _=s.get(l);_.hasAttribute("data-comp-root")||Y(_,i),_!==b&&e.insertBefore(_,b||null),s.delete(l)}else e.insertBefore(i,b||null);a++}for(let i of s.values())i.hasAttribute("data-comp-root")||i.remove();for(;e.children.length>o.length;){let i=e.lastChild;if(i?.hasAttribute?.("data-comp-root"))break;i.remove()}return!0}function Y(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}be(e,t),!e.hasAttribute("data-comp-root")&&_e(e,t)}function be(e,t){let n=e.attributes,o=t.attributes;for(let{name:r}of Array.from(n))t.hasAttribute(r)||e.removeAttribute(r);for(let{name:r,value:c}of Array.from(o))e.getAttribute(r)!==c&&e.setAttribute(r,c)}function _e(e,t){let n=Array.from(e.childNodes),o=Array.from(t.childNodes),r=Math.max(n.length,o.length);for(let c=0;c<r;c++){let s=n[c],a=o[c];if(!a&&s){if(s.nodeType===1&&s.hasAttribute("data-comp-root"))continue;e.removeChild(s);continue}if(!s&&a){e.appendChild(a.cloneNode(!0));continue}ye(s,a)}}function ye(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?Y(e,t):e.replaceWith(t.cloneNode(!0))}}function O(e,t,n,o){if(!t||!t.children[0]||!n)return;let r=t.children.length>1?t:t.children[0];function c(a,i){for(let l=a;l&&l!==i.parentNode;l=l.parentElement)if(!(!l||!l.hasAttributes||!l.hasAttributes())){for(let b of l.attributes)if(b.name==="data-action"||b.name.startsWith("data-action-"))return l}return null}function s(a,i=!1){if(a&&!(!i&&a.hasAttribute&&a.hasAttribute("data-comp-root"))){Object.entries(n).forEach(([l,b])=>{let _=l.includes(":"),[$,B]=_?l.split(":"):l.split(" "),h=$==="*";(h?["click","input","change","keydown","submit"]:[$]).forEach(m=>{let M=A=>{let C=c(A.target,r),v="",x="";if(C){let f=`data-action-${A.type}`,F=`data-args-${A.type}`;v=C.getAttribute(f)??C.getAttribute("data-action")??"",x=C.getAttribute(F)??C.getAttribute("data-args")??""}let E=v.split(":"),H=E[0],T=[];if(x)try{let f=JSON.parse(x);T=Array.isArray(f)?f:[f]}catch{console.warn("Invalid JSON in data-args:",x)}else T=E.slice(1);let L={...A.target.dataset,event:A,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:H,args:T};if(_&&C&&(B==="*"||B===H)&&(h||A.type===$))return b.call(e,L);if(!_){let f=A.target.closest(B||"*");return f&&r.contains(f)?b.call(e,L):void 0}},j=`__microBound_${m}_${l}`;r[j]||(r.addEventListener(m,M),r[j]=!0,o.push({node:r,type:m,listener:M}))})});for(let l of a.children)s(l,!1)}}s(t,!0)}var ee=new WeakMap;function W(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let n=ee.get(e);if(n||(n={},ee.set(e,n)),n[t]){let s=n[t];if(s.isConnected&&e.contains(s))return s;delete n[t]}let o=e.querySelector(`[data-key="${t}"]`);if(o&&o._componentInstance)return n[t]=o._componentInstance,o._componentInstance;let r=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function c(s,a){if(s===a)return!0;let i=s.closest("[data-comp-root]");return!i||i===a}for(let s of r){let a=null;try{let i=e.querySelectorAll(s);for(let l of i)if(c(l,e)){a=l;break}}catch{throw new Error(`ref() invalid selector: '${s}' for ref name '${t}'`)}if(a)return n[t]=a,a}return null}var q=new WeakMap;function J(e,t,n){if(!e||t===null||q.has(e)&&q.get(e).value===t)return;let o=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&o&&typeof o=="object"&&"default"in o&&(o=o.default),Array.isArray(o)){let r=e.parentNode;if(!r)return;let c={};Array.from(r.children).forEach(a=>{let i=a.getAttribute&&a.getAttribute("data-key");i!=null&&(c[i]=a)});let s=[];o.forEach(a=>{let i=typeof a=="function"?a():a,l=null,b=i?.props?.key??(i?.el?.getAttribute&&i.el.getAttribute("data-key"));if(b!=null&&c[b])l=c[b],i&&typeof i.update=="function"&&i.update();else if(i&&typeof i.mount=="function"){let _=document.createElement("div");i.mount(_),l=i.el instanceof HTMLElement?i.el:_,n._mountedChildren.includes(i)||n._mountedChildren.push(i)}else if(i?.el instanceof HTMLElement)l=i.el;else if(i instanceof Node)l=i;else if(typeof i=="string"){let _=document.createElement("div");_.innerHTML=i,l=_.firstChild}l&&s.push(l)}),r.contains(e)&&r.removeChild(e),s.forEach((a,i)=>{r.children[i]!==a&&r.insertBefore(a,r.children[i]||null)}),Array.from(r.children).forEach(a=>{s.includes(a)||r.removeChild(a)}),q.set(e,{value:t});return}if(o&&typeof o.mount=="function"){if(o.isMounted())o.update(),o.el!==e&&e.replaceWith(o.el);else{let r=document.createElement("div");e.replaceWith(r),o.mount(r),o.el===e&&(o.el=r)}n._mountedChildren.includes(o)||n._mountedChildren.push(o)}else if(o?.el instanceof HTMLElement)e.replaceWith(o.el);else if(o instanceof Node)e.replaceWith(o);else if(typeof o=="string"){let r=document.createElement("div");r.innerHTML=o;let c=document.createDocumentFragment();for(;r.firstChild;)c.appendChild(r.firstChild);e.replaceWith(c)}else e.replaceWith(document.createTextNode(""));q.set(e,{value:t})}function X(e,t,n,o){let c={...typeof o=="function"?o.call(n,t):typeof o=="object"?o:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(c={default:t.slots}),t.children!==void 0?c.default=t.children:c.default||(c.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(a=>{let i=a.getAttribute("data-comp");if(!i)return;let l=Z(+i);l&&(a.setAttribute("data-ref",i),c[i]||(l._fromSlotHydration=!0,c[i]=l({...l._prevProps,...a.dataset}),l._fromSlotHydration=!1))}),Object.entries(c).forEach(([a,i])=>{let l;if(a==="default"||a==="children"?l=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):l=W(e.el,a),!l||i==null)return;let b=l.querySelector("[data-comp-root='"+e._id+"']");!b&&i&&typeof i.mount=="function"&&(b=document.createElement("div"),b.setAttribute("data-comp-root",e._id),l.innerHTML="",l.appendChild(b));let _=b||l;i._id&&(i._fromSlotHydration=!0),J(_,i,n),i._id&&(i._fromSlotHydration=!1)})}function Q(e,t){if(!t)return;t.querySelectorAll("*").forEach(o=>{Array.from(o.attributes).forEach(r=>{if(!r.name.startsWith("data-action-"))return;let c=r.name.slice(12),s=r.value;if(!s)return;let a=`${c}:${s}`;if(typeof e.on[a]!="function"){if(typeof e.on[s]=="function"){e.on[a]=e.on[s].bind(e);return}typeof e[s]=="function"&&(e.on[a]=e[s].bind(e))}})})}function U(e,t,n=!0,o){for(let r of e)try{r.call(o,t)}catch(c){console.error(c)}n&&(e.length=0)}function V(e,t,n){if(Array.isArray(e)){let r=function(){if(o<e.length){let c=e[o++];try{c.length?c.call(n,r):Promise.resolve(c.call(n)).then(r).catch(s=>{console.error(s),r()})}catch(s){console.error(s),r()}}else t()},o=0;r()}else if(e)try{e.length?e.call(n,t):Promise.resolve(e.call(n)).then(t).catch(o=>{console.error(o),t()})}catch(o){console.error(o),t()}else t()}function te(e,t){for(let n of Object.keys(e))n in t||Object.defineProperty(t,n,{get(){return e[n]},enumerable:!0})}function ne(e,t,n=o=>o.id??o.key??o){return e.map((o,r)=>{let c=n(o,r),s=t(o,r);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(c).replace(/"/g,"&quot;")}"`):s}).join("")}var Ce=1,ge="1.10.0",N=new Map;function oe(e){e._id&&N.set(e._id,e)}function re(e){e._id&&N.delete(e._id)}function Z(e){return N.get(e)}var I=null;function Ae(e,t={}){let n=e._frozenTemplate,o=se(n.renderFn,n.options);return o._initialProps=t,o._templateSource=e,o}function se(e,t={}){let n,o={},r=typeof e;r==="object"&&r!=="function"&&e!==null&&!Array.isArray(e)?(n=e.render,o={...e},delete o.render):(n=e,o=t||{});let{state:c={},on:s={},slots:a={},onMount:i,onUnmount:l,onBeforeMount:b,onBeforeUnmount:_,onUpdate:$,...B}=o,h=null,S=!1,m={},M={},j=null,A=!1,C=[],v=c,x=null,E=!1,H={...c},T=!1,L=u=>{v=typeof u=="function"?u(v):{...v,...u},T||(T=!0,j={...m},queueMicrotask(()=>{T=!1,d(j),j=null}))},f={refs:{},on:function(u,p){if(u&&p){let g=`h${d._renderIndex++}`;return d.addEvent(`${u} [data-ref=${g}]`,p),`data-ref="${g}"`}},setState:L,props:m,_childCallCache:{},_childCallIndex:0,isMounted:()=>S,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],onMount(u){typeof u=="function"&&this._mountCbs.push(u)},onUnmount(u){typeof u=="function"&&this._unmountCbs.push(u)},onBeforeMount(u){typeof u=="function"&&this._beforeMountCbs.push(u)},onBeforeUnmount(u){typeof u=="function"&&this._beforeUnmountCbs.push(u)},onUpdate(u){typeof u=="function"&&this._updateCbs.push(u)},addEvent(u,p){f.on[u]||(f.on[u]=p)},mount(u,p={}){if(S||A)return;let g=typeof u=="string"?document.querySelector(u):u;if(!g)throw new Error(`No element matches: ${u}`);let y=()=>{A=!0,h=g,h.setAttribute("data-comp-root",d._id+"-"+(n.name||"")),m={...m,...p},M={...m},f.props=m,h._componentInstance=d,m.key&&h.setAttribute("data-key",m.key),d(m),E||(S=!0,U(f._mountCbs,void 0,!1,d))};V(f._beforeMountCbs,y,d)},update(u={}){if(!S)return;let p=u.props?u.props:u,g=p.on;g&&Object.assign(f.on,g);let y={...m,...p};M={...m},m=y,f.props=m,m.key!==M.key&&h.setAttribute("data-key",m.key),d(m)},render(u={}){m={...m,...u},f.props=m;let p=typeof n=="function"?n.call(f,{state:v,setState:L,props:m,refs:f.refs}):n;return p&&(p=new String(p),p._id=d._id),te(f,d),p},_resetInternal:()=>{f._mountedChildren.forEach(u=>{u&&typeof u.unmount=="function"&&u.unmount()}),f._mountedChildren=[],x=null,E=!1,h=null,S=!1,A=!1,C=[],m={},M={},v={...H}},unmount(){if(!S||!h)return;let u=()=>{h.firstChild&&(x=h.firstChild.cloneNode(!0),h.removeChild(h.firstChild)),U(f._unmountCbs,void 0,!0,d),C.forEach(({node:p,type:g,listener:y})=>{p.removeEventListener(g,y)}),C=[],S=!1,A=!1,E=!0,re(d),f._resetInternal&&f._resetInternal()};V(f._beforeUnmountCbs,u,f)},get renderFn(){return n},get el(){return h},get state(){return v}};i&&f.onMount(i),l&&f.onUnmount(l),b&&f.onBeforeMount(b),_&&f.onBeforeUnmount(_),$&&f.onUpdate($),Object.assign(f.on,s),f.ref=function(u){return W(this.el,u)},f.refs=new Proxy({},{get(u,p){return f.ref(p)}});function F(u){m={...f.props,...u},f.props=m,!h||h.isConnected;let p=f.render(m);if(p===null||p===""){!E&&h&&h.firstChild?(x=h.firstChild.cloneNode(!0),V(f._beforeUnmountCbs,()=>{h.innerHTML="",C.forEach(({node:y,type:ue,listener:ae})=>{y.removeEventListener(ue,ae)}),C=[],S=!1,E=!0,U(f._unmountCbs,void 0,!0,d)},f)):E=!0;return}if(E&&x){h.appendChild(x),x=null,E=!1,S=!0,O(d,h,d.on,C),U(f._mountCbs,void 0,!1,d);return}return G(h,p),X(d,m,f,a),Q(d,h),O(d,h,d.on,C),S&&U(f._updateCbs,M,!1,d),E=!1,p}let P="";function d(u={}){if(!d._fromSlotHydration&&I&&I!==d){let p=I;p._childCallIndex==null&&(p._childCallIndex=0),p._childCallCache||(p._childCallCache={});let g=u.key!=null?u.key:p._childCallIndex++,y=p._childCallCache[g];return!y||y._templateSource!==d?(y=Ae(d,u),y._prevProps={...u},y.toString=()=>`<div data-comp="${y._id}"></div>`,p._childCallCache[g]=y):(y._prevProps={...u},y.update(u)),y}return I=d,d._renderIndex=0,d._childCallIndex=0,d._prevProps=u,P=d._render(u),I=null,d}return d.toString=function(){return!P||String(P)===""&&!d.isMounted()&&I!==null&&I._id!==d._id?String(d._id):P?String(P):""},Object.assign(d,f,B),["el","props","state","setState"].forEach(u=>{Object.defineProperty(d,u,{get(){return f[u]},enumerable:!0,configurable:!1})}),d._render=F,d.render=f.render,d._id=Ce++,d.getId=()=>d._id,oe(d),d._frozenTemplate=Object.freeze({renderFn:n,options:{...o,state:{...H}}}),d}function w(){return I}function Ee(e,t={}){let n=w();if(!n)throw new Error("useFetch must be called inside a component render or lifecycle");(!n.state||n.state.data===void 0&&n.state.loading===void 0&&n.state.error===void 0)&&n.setState({data:null,loading:!0,error:null});async function o(){n.setState(r=>({...r,loading:!0}));try{let c=await(await fetch(e,t)).json();n.setState({data:c,error:null,loading:!1}),n.emit&&n.emit("fetch::done",{url:e,data:c})}catch(r){n.setState({data:null,error:r,loading:!1}),n.emit&&n.emit("fetch::error",{url:e,error:r})}}return n.onMount(o),n.onEmit&&n.onEmit("fetch::refresh",o),{get:()=>({...n.state}),subscribe:r=>(n.onUpdate(()=>r({...n.state})),()=>{}),refresh:o}}var R={};function Se(e,t={}){let n=w();if(!n)throw new Error("useContext() must be inside render()");R[e]||(R[e]={value:t,subs:new Set});let o=R[e];o.subs.add(n),n.onUnmount(()=>o.subs.delete(n));let r=c=>{o.value=typeof c=="function"?c(o.value):c,o.subs.forEach(s=>s.update())};return[o.value,r]}function xe(e){let t=w();if(!t)throw new Error("useState must be inside render()");t._hasStateSetters||(t.state&&Object.keys(t.state).forEach(r=>{let c="set"+r.charAt(0).toUpperCase()+r.slice(1);t[c]||(t[c]=s=>{let a=t.state[r],i=typeof s=="function"?s(a):s;i!==a&&(t.state[r]=i,t.update())})}),t._hasStateSetters=!0);let n=t._renderIndex++;t._hooks||(t._hooks=[]),t._hooks[n]===void 0&&(t._hooks[n]=typeof e=="function"?e():e);let o=r=>{let c=t._hooks[n],s=typeof r=="function"?r(c):r;s!==c&&(t._hooks[n]=s,t.update())};return[t._hooks[n],o]}function we(e,t=[]){let n=w();if(!n)throw new Error("useEffect must be inside render()");let o=n._renderIndex++;n._hooks=n._hooks||[];let r=n._hooks[o]||[];if(t.length===0||t.some((s,a)=>s!==r[a])){let s;n.onUnmount(()=>s&&s()),s=e(),n._hooks[o]=t}}function z(){let e=new Map;return{subscribe(t,n){e.has(t)||e.set(t,new Set);let o=e.get(t);return o.add(n),()=>o.delete(n)},emit(t,n){let o=e.get(t);if(o)for(let r of o)r(n)},clear(){e.clear()}}}function ie(e){let t=e,n=new Set;function o(s){typeof t=="object"&&t!==null&&typeof s=="object"&&s!==null&&!Array.isArray(t)&&!Array.isArray(s)?t={...t,...s}:t=typeof s=="function"?s(t):s,n.forEach(a=>a(t))}function r(s){return n.add(s),s(t),()=>n.delete(s)}function c(){return t}return{get:c,setState:o,getState:c,subscribe:r}}var k=z(),D=new Map;function ce(e,t={}){if(!D.has(e)){let n=ie(t),o={...n,emit(r,c){n.setState(c),k.emit(`${e}::${r}`,n.getState())},on(r,c){return k.subscribe(`${e}::${r}`,c)}};D.set(e,o)}return D.get(e)}ce.clear=()=>D.clear();function ve(){let e=w();if(!e)throw new Error("useEmits must be inside render()");if(e._hasEmits)return e._emitsApi;e._hasEmits=!0;let t=z(),n={emit:(o,r)=>t.emit(o,r),onEmit:(o,r)=>{let c=t.subscribe(o,r);return e.onUnmount(c),c},emitGlobal:(o,r)=>k.emit(o,r),onEmitGlobal:(o,r)=>{let c=k.subscribe(o,r);return e.onUnmount(c),c}};return Object.assign(e,n),e._emitsApi=n,Me(e,e.on),e.onUnmount(()=>{t.clear()}),n}function Me(e,t={}){let n=[];console.log("Context listeners registered:",Object.entries(t)),Object.entries(t).forEach(([o,r])=>{if(console.log(KeyboardEvent,r),o.includes("::")){let c=r.bind(e),s=k.subscribe(o,c);n.push(s)}else!o.includes(" ")&&!o.includes("*")&&!o.includes(":")&&e.onEmit(o,r.bind(e))}),e.onUnmount(()=>{n.forEach(o=>o()),n=[]})}return he(Ie);})();
//# sourceMappingURL=magnumjs-micro-ui.all.js.map
