/*!
 * @magnumjs/micro-ui v1.9.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var G=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var he=Object.prototype.hasOwnProperty;var pe=(e,t)=>{for(var n in t)G(e,n,{get:t[n],enumerable:!0})},me=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of de(t))!he.call(e,r)&&r!==n&&G(e,r,{get:()=>t[r],enumerable:!(o=fe(t,r))||o.enumerable});return e};var be=e=>me(G({},"__esModule",{value:!0}),e);var Te={};pe(Te,{__VERSION__:()=>Ee,createComponent:()=>ie,getComponentById:()=>Q,globalComponentRegistry:()=>F,registerComponent:()=>re,renderList:()=>oe,unregisterComponent:()=>se,useContext:()=>ve,useCurrentComponent:()=>M,useEffect:()=>Ie,useFetch:()=>xe,useState:()=>Me});function K(e,t){if(!e)return!1;let n=document.createElement("div");if(n.innerHTML=t,n.children.length===0&&e.children.length===0&&n.textContent)return e.textContent!==n.textContent&&(e.textContent=n.textContent),!0;let o=Array.from(n.children),r=Array.from(e.children),l=new Map,s=new Map;for(let c of o){let u=c.dataset.key;u&&l.set(u,c)}for(let c of r){let u=c.dataset.key;u&&s.set(u,c)}let a=0;for(let c of o){let u=c.dataset.key,b=e.children[a];if(u&&s.has(u)){let y=s.get(u);y.hasAttribute("data-comp-root")||ee(y,c),y!==b&&e.insertBefore(y,b||null),s.delete(u)}else e.insertBefore(c,b||null);a++}for(let c of s.values())c.hasAttribute("data-comp-root")||c.remove();for(;e.children.length>o.length;){let c=e.lastChild;if(c?.hasAttribute?.("data-comp-root"))break;c.remove()}return!0}function ee(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}_e(e,t),!e.hasAttribute("data-comp-root")&&ye(e,t)}function _e(e,t){let n=e.attributes,o=t.attributes;for(let{name:r}of Array.from(n))t.hasAttribute(r)||e.removeAttribute(r);for(let{name:r,value:l}of Array.from(o))e.getAttribute(r)!==l&&e.setAttribute(r,l)}function ye(e,t){let n=Array.from(e.childNodes),o=Array.from(t.childNodes),r=Math.max(n.length,o.length);for(let l=0;l<r;l++){let s=n[l],a=o[l];if(!a&&s){if(s.nodeType===1&&s.hasAttribute("data-comp-root"))continue;e.removeChild(s);continue}if(!s&&a){e.appendChild(a.cloneNode(!0));continue}Ce(s,a)}}function Ce(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?ee(e,t):e.replaceWith(t.cloneNode(!0))}}function V(e,t,n,o){if(!t||!t.children[0]||!n)return;let r=t.children.length>1?t:t.children[0];function l(a,c){for(let u=a;u&&u!==c.parentNode;u=u.parentElement)if(!(!u||!u.hasAttributes||!u.hasAttributes())){for(let b of u.attributes)if(b.name==="data-action"||b.name.startsWith("data-action-"))return u}return null}function s(a,c=!1){if(a&&!(!c&&a.hasAttribute&&a.hasAttribute("data-comp-root"))){Object.entries(n).forEach(([u,b])=>{let y=u.includes(":"),[$,U]=y?u.split(":"):u.split(" "),m=$==="*";(m?["click","input","change","keydown","submit"]:[$]).forEach(p=>{let I=S=>{let g=l(S.target,r),v="",x="";if(g){let A=`data-action-${S.type}`,O=`data-args-${S.type}`;v=g.getAttribute(A)??g.getAttribute("data-action")??"",x=g.getAttribute(O)??g.getAttribute("data-args")??""}let E=v.split(":"),L=E[0],k=[];if(x)try{let A=JSON.parse(x);k=Array.isArray(A)?A:[A]}catch{console.warn("Invalid JSON in data-args:",x)}else k=E.slice(1);let B={...S.target.dataset,event:S,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:L,args:k};if(y&&g&&(U==="*"||U===L)&&(m||S.type===$))return b.call(e,B);if(!y){let A=S.target.closest(U||"*");return A&&r.contains(A)?b.call(e,B):void 0}},j=`__microBound_${p}_${u}`;r[j]||(r.addEventListener(p,I),r[j]=!0,o.push({node:r,type:p,listener:I}))})});for(let u of a.children)s(u,!1)}}s(t,!0)}function J(){let e=new Map;return{subscribe(t,n){e.has(t)||e.set(t,new Set);let o=e.get(t);return o.add(n),()=>o.delete(n)},emit(t,n){let o=e.get(t);if(o)for(let r of o)r(n)},clear(){e.clear()}}}function ge(e){let t=e,n=new Set;function o(s){typeof t=="object"&&t!==null&&typeof s=="object"&&s!==null&&!Array.isArray(t)&&!Array.isArray(s)?t={...t,...s}:t=typeof s=="function"?s(t):s,n.forEach(a=>a(t))}function r(s){return n.add(s),s(t),()=>n.delete(s)}function l(){return t}return{get:l,setState:o,getState:l,subscribe:r}}var W=J(),N=new Map;function Ae(e,t={}){if(!N.has(e)){let n=ge(t),o={...n,emit(r,l){n.setState(l),W.emit(`${e}::${r}`,n.getState())},on(r,l){return W.subscribe(`${e}::${r}`,l)}};N.set(e,o)}return N.get(e)}Ae.clear=()=>N.clear();var te=new WeakMap;function q(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let n=te.get(e);if(n||(n={},te.set(e,n)),n[t]){let s=n[t];if(s.isConnected&&e.contains(s))return s;delete n[t]}let o=e.querySelector(`[data-key="${t}"]`);if(o&&o._componentInstance)return n[t]=o._componentInstance,o._componentInstance;let r=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function l(s,a){if(s===a)return!0;let c=s.closest("[data-comp-root]");return!c||c===a}for(let s of r){let a=null;try{let c=e.querySelectorAll(s);for(let u of c)if(l(u,e)){a=u;break}}catch{throw new Error(`ref() invalid selector: '${s}' for ref name '${t}'`)}if(a)return n[t]=a,a}return null}var D=new WeakMap;function X(e,t,n){if(!e||t===null||D.has(e)&&D.get(e).value===t)return;let o=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&o&&typeof o=="object"&&"default"in o&&(o=o.default),Array.isArray(o)){let r=e.parentNode;if(!r)return;let l={};Array.from(r.children).forEach(a=>{let c=a.getAttribute&&a.getAttribute("data-key");c!=null&&(l[c]=a)});let s=[];o.forEach(a=>{let c=typeof a=="function"?a():a,u=null,b=c?.props?.key??(c?.el?.getAttribute&&c.el.getAttribute("data-key"));if(b!=null&&l[b])u=l[b],c&&typeof c.update=="function"&&c.update();else if(c&&typeof c.mount=="function"){let y=document.createElement("div");c.mount(y),u=c.el instanceof HTMLElement?c.el:y,n._mountedChildren.includes(c)||n._mountedChildren.push(c)}else if(c?.el instanceof HTMLElement)u=c.el;else if(c instanceof Node)u=c;else if(typeof c=="string"){let y=document.createElement("div");y.innerHTML=c,u=y.firstChild}u&&s.push(u)}),r.contains(e)&&r.removeChild(e),s.forEach((a,c)=>{r.children[c]!==a&&r.insertBefore(a,r.children[c]||null)}),Array.from(r.children).forEach(a=>{s.includes(a)||r.removeChild(a)}),D.set(e,{value:t});return}if(o&&typeof o.mount=="function"){if(o.isMounted())o.update(),o.el!==e&&e.replaceWith(o.el);else{let r=document.createElement("div");e.replaceWith(r),o.mount(r),o.el===e&&(o.el=r)}n._mountedChildren.includes(o)||n._mountedChildren.push(o)}else if(o?.el instanceof HTMLElement)e.replaceWith(o.el);else if(o instanceof Node)e.replaceWith(o);else if(typeof o=="string"){let r=document.createElement("div");r.innerHTML=o;let l=document.createDocumentFragment();for(;r.firstChild;)l.appendChild(r.firstChild);e.replaceWith(l)}else e.replaceWith(document.createTextNode(""));D.set(e,{value:t})}function Z(e,t,n,o){let l={...typeof o=="function"?o.call(n,t):typeof o=="object"?o:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(l={default:t.slots}),t.children!==void 0?l.default=t.children:l.default||(l.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(a=>{let c=a.getAttribute("data-comp");if(!c)return;let u=Q(+c);u&&(a.setAttribute("data-ref",c),l[c]||(u._fromSlotHydration=!0,l[c]=u({...u._prevProps,...a.dataset}),u._fromSlotHydration=!1))}),Object.entries(l).forEach(([a,c])=>{let u;if(a==="default"||a==="children"?u=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):u=q(e.el,a),!u||c==null)return;let b=u.querySelector("[data-comp-root='"+e._id+"']");!b&&c&&typeof c.mount=="function"&&(b=document.createElement("div"),b.setAttribute("data-comp-root",e._id),u.innerHTML="",u.appendChild(b));let y=b||u;c._id&&(c._fromSlotHydration=!0),X(y,c,n),c._id&&(c._fromSlotHydration=!1)})}function R(e,t){if(!t)return;t.querySelectorAll("*").forEach(o=>{Array.from(o.attributes).forEach(r=>{if(!r.name.startsWith("data-action-"))return;let l=r.name.slice(12),s=r.value;if(!s)return;let a=`${l}:${s}`;if(typeof e.on[a]!="function"){if(typeof e.on[s]=="function"){e.on[a]=e.on[s].bind(e);return}typeof e[s]=="function"&&(e.on[a]=e[s].bind(e))}})})}function H(e,t,n=!0,o){for(let r of e)try{r.call(o,t)}catch(l){console.error(l)}n&&(e.length=0)}function z(e,t,n){if(Array.isArray(e)){let r=function(){if(o<e.length){let l=e[o++];try{l.length?l.call(n,r):Promise.resolve(l.call(n)).then(r).catch(s=>{console.error(s),r()})}catch(s){console.error(s),r()}}else t()},o=0;r()}else if(e)try{e.length?e.call(n,t):Promise.resolve(e.call(n)).then(t).catch(o=>{console.error(o),t()})}catch(o){console.error(o),t()}else t()}function ne(e,t){for(let n of Object.keys(e))n in t||Object.defineProperty(t,n,{get(){return e[n]},enumerable:!0})}function oe(e,t,n=o=>o.id??o.key??o){return e.map((o,r)=>{let l=n(o,r),s=t(o,r);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(l).replace(/"/g,"&quot;")}"`):s}).join("")}var Se=1,Ee="1.9.0",F=new Map;function re(e){e._id&&F.set(e._id,e)}function se(e){e._id&&F.delete(e._id)}function Q(e){return F.get(e)}var T=null;function we(e,t={}){let n=e._frozenTemplate,o=ie(n.renderFn,n.options);return o._initialProps=t,o._templateSource=e,o}function ie(e,t={}){let n,o={},r=typeof e;r==="object"&&r!=="function"&&e!==null&&!Array.isArray(e)?(n=e.render,o={...e},delete o.render):(n=e,o=t||{});let{state:l={},on:s={},slots:a={},onMount:c,onUnmount:u,onBeforeMount:b,onBeforeUnmount:y,onUpdate:$,...U}=o,m=null,w=!1,p={},I={},j=null,S=!1,g=[],v=l,x=null,E=!1,L={...l},k=!1,B=[],A=J(),O=i=>{v=typeof i=="function"?i(v):{...v,...i},k||(k=!0,j={...p},queueMicrotask(()=>{k=!1,h(j),j=null}))},f={refs:{},on:function(i,d){if(i&&d){let _=`h${h._renderIndex++}`;return h.addEvent(`${i} [data-ref=${_}]`,d),`data-ref="${_}"`}},setState:O,props:p,_childCallCache:{},_childCallIndex:0,isMounted:()=>w,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],onMount(i){typeof i=="function"&&this._mountCbs.push(i)},onUnmount(i){typeof i=="function"&&this._unmountCbs.push(i)},onBeforeMount(i){typeof i=="function"&&this._beforeMountCbs.push(i)},onBeforeUnmount(i){typeof i=="function"&&this._beforeUnmountCbs.push(i)},onUpdate(i){typeof i=="function"&&this._updateCbs.push(i)},emit(i,d){A.emit(i,d)},onEmit(i,d){let _=A.subscribe(i,d);return this.onUnmount(_),_},emitGlobal(i,d){W.emit(i,d)},onEmitGlobal(i,d){let _=W.subscribe(i,d);return this.onUnmount(_),_},addEvent(i,d){f.on[i]||(f.on[i]=d)},mount(i,d={}){if(w||S)return;let _=typeof i=="string"?document.querySelector(i):i;if(!_)throw new Error(`No element matches: ${i}`);let C=()=>{S=!0,m=_,m.setAttribute("data-comp-root",h._id+"-"+(n.name||"")),p={...p,...d},I={...p},f.props=p,m._componentInstance=h,p.key&&m.setAttribute("data-key",p.key),h(p),E||(w=!0,H(f._mountCbs,void 0,!1,h),ce())};z(f._beforeMountCbs,C,h)},update(i={}){if(!w)return;let d=i.props?i.props:i,_=d.on;_&&Object.assign(f.on,_);let C={...p,...d};I={...p},p=C,f.props=p,p.key!==I.key&&m.setAttribute("data-key",p.key),h(p)},render(i={}){p={...p,...i},f.props=p;let d=typeof n=="function"?n.call(f,{state:v,setState:O,props:p,refs:f.refs}):n;return d&&(d=new String(d),d._id=h._id),ne(f,h),d},_resetInternal:()=>{f._mountedChildren.forEach(i=>{i&&typeof i.unmount=="function"&&i.unmount()}),f._mountedChildren=[],x=null,E=!1,m=null,w=!1,S=!1,g=[],p={},I={},v={...L}},unmount(){if(!w||!m)return;let i=()=>{m.firstChild&&(x=m.firstChild.cloneNode(!0),m.removeChild(m.firstChild)),H(f._unmountCbs,void 0,!0,h),A.clear(),g.forEach(({node:d,type:_,listener:C})=>{d.removeEventListener(_,C)}),g=[],B.forEach(d=>d()),B=[],w=!1,S=!1,E=!0,se(h),f._resetInternal&&f._resetInternal()};z(f._beforeUnmountCbs,i,f)},get renderFn(){return n},get el(){return m},get state(){return v}};c&&f.onMount(c),u&&f.onUnmount(u),b&&f.onBeforeMount(b),y&&f.onBeforeUnmount(y),$&&f.onUpdate($),Object.assign(f.on,s),f.ref=function(i){return q(this.el,i)},f.refs=new Proxy({},{get(i,d){return f.ref(d)}});function ce(){B=[],Object.entries(f.on).forEach(([i,d])=>{i.includes("::")?h.onEmitGlobal(i,d.bind(f)):!i.includes(" ")&&!i.includes("*")&&!i.includes(":")&&h.onEmit(i,d.bind(f))})}function le(i){p={...f.props,...i},f.props=p,!m||m.isConnected;let d=f.render(p);if(d===null||d===""){!E&&m&&m.firstChild?(x=m.firstChild.cloneNode(!0),z(f._beforeUnmountCbs,()=>{m.innerHTML="",g.forEach(({node:C,type:ae,listener:ue})=>{C.removeEventListener(ae,ue)}),g=[],w=!1,E=!0,H(f._unmountCbs,void 0,!0,h)},f)):E=!0;return}if(E&&x){m.appendChild(x),x=null,E=!1,w=!0,V(f,m,f.on,g),H(f._mountCbs,void 0,!1,h);return}return K(m,d),Z(h,p,f,a),R(h,m),V(f,m,f.on,g),w&&H(f._updateCbs,I,!1,h),E=!1,d}let P="";function h(i={}){if(!h._fromSlotHydration&&T&&T!==h){let d=T;d._childCallIndex==null&&(d._childCallIndex=0),d._childCallCache||(d._childCallCache={});let _=i.key!=null?i.key:d._childCallIndex++,C=d._childCallCache[_];return!C||C._templateSource!==h?(C=we(h,i),C._prevProps={...i},C.toString=()=>`<div data-comp="${C._id}"></div>`,d._childCallCache[_]=C):(C._prevProps={...i},C.update(i)),C}return T=h,h._renderIndex=0,h._childCallIndex=0,h._prevProps=i,P=h._render(i),T=null,h}return h.toString=function(){return!P||String(P)===""&&!h.isMounted()&&T!==null&&T._id!==h._id?String(h._id):P?String(P):""},Object.assign(h,f,U),["el","props","state","setState"].forEach(i=>{Object.defineProperty(h,i,{get(){return f[i]},enumerable:!0,configurable:!1})}),h._render=le,h.render=f.render,h._id=Se++,h.getId=()=>h._id,re(h),h._frozenTemplate=Object.freeze({renderFn:n,options:{...o,state:{...L}}}),h}function M(){return T}function xe(e,t={}){let n=M();if(!n)throw new Error("useFetch must be called inside a component render or lifecycle");(!n.state||n.state.data===void 0&&n.state.loading===void 0&&n.state.error===void 0)&&n.setState({data:null,loading:!0,error:null});async function o(){n.setState(r=>({...r,loading:!0})),console.log("fetch started");try{let l=await(await fetch(e,t)).json();n.setState({data:l,error:null,loading:!1}),console.log("fetch success",{data:l}),n.emit("fetch::done",{url:e,data:l})}catch(r){n.setState({data:null,error:r,loading:!1}),console.log("fetch error",{error:r}),n.emit("fetch::error",{url:e,error:r})}}return n.onMount(o),n.onEmit("fetch::refresh",o),{get:()=>({...n.state}),subscribe:r=>(n.onUpdate(()=>r({...n.state})),()=>{}),refresh:o}}var Y={};function ve(e,t={}){let n=M();if(!n)throw new Error("useContext() must be inside render()");Y[e]||(Y[e]={value:t,subs:new Set});let o=Y[e];o.subs.add(n),n.onUnmount(()=>o.subs.delete(n));let r=l=>{o.value=typeof l=="function"?l(o.value):l,o.subs.forEach(s=>s.update())};return[o.value,r]}function Me(e){let t=M();if(!t)throw new Error("useState must be inside render()");t._hasStateSetters||(t.state&&Object.keys(t.state).forEach(r=>{let l="set"+r.charAt(0).toUpperCase()+r.slice(1);t[l]||(t[l]=s=>{let a=t.state[r],c=typeof s=="function"?s(a):s;c!==a&&(t.state[r]=c,t.update())})}),t._hasStateSetters=!0);let n=t._renderIndex++;t._hooks||(t._hooks=[]),t._hooks[n]===void 0&&(t._hooks[n]=typeof e=="function"?e():e);let o=r=>{let l=t._hooks[n],s=typeof r=="function"?r(l):r;s!==l&&(t._hooks[n]=s,t.update())};return[t._hooks[n],o]}function Ie(e,t=[]){let n=M();if(!n)throw new Error("useEffect must be inside render()");let o=n._renderIndex++;n._hooks=n._hooks||[];let r=n._hooks[o]||[];if(t.length===0||t.some((s,a)=>s!==r[a])){let s;n.onUnmount(()=>s&&s()),s=e(),n._hooks[o]=t}}return be(Te);})();
//# sourceMappingURL=magnumjs-micro-ui.all.js.map
