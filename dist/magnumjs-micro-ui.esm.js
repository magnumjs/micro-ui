/*!
 * @magnumjs/micro-ui v1.10.1
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function O(e,t){if(!e)return!1;let i=document.createElement("div");if(i.innerHTML=t,i.children.length===0&&e.children.length===0&&i.textContent)return e.textContent!==i.textContent&&(e.textContent=i.textContent),!0;let r=Array.from(i.children),s=Array.from(e.children),d=new Map,f=new Map;for(let n of r){let l=n.dataset.key;l&&d.set(l,n)}for(let n of s){let l=n.dataset.key;l&&f.set(l,n)}let c=0;for(let n of r){let l=n.dataset.key,y=e.children[c];if(l&&f.has(l)){let _=f.get(l);_.hasAttribute("data-comp-root")||K(_,n),_!==y&&e.insertBefore(_,y||null),f.delete(l)}else e.insertBefore(n,y||null);c++}for(let n of f.values())n.hasAttribute("data-comp-root")||n.remove();for(;e.children.length>r.length;){let n=e.lastChild;if(n?.hasAttribute?.("data-comp-root"))break;n.remove()}return!0}function K(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}Z(e,t),!e.hasAttribute("data-comp-root")&&ee(e,t)}function Z(e,t){let i=e.attributes,r=t.attributes;for(let{name:s}of Array.from(i))t.hasAttribute(s)||e.removeAttribute(s);for(let{name:s,value:d}of Array.from(r))e.getAttribute(s)!==d&&e.setAttribute(s,d)}function ee(e,t){let i=Array.from(e.childNodes),r=Array.from(t.childNodes),s=Math.max(i.length,r.length);for(let d=0;d<s;d++){let f=i[d],c=r[d];if(!c&&f){if(f.nodeType===1&&f.hasAttribute("data-comp-root"))continue;e.removeChild(f);continue}if(!f&&c){e.appendChild(c.cloneNode(!0));continue}te(f,c)}}function te(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?K(e,t):e.replaceWith(t.cloneNode(!0))}}function U(e,t,i,r){if(!t||!t.children[0]||!i)return;let s=t.children.length>1?t:t.children[0];function d(c,n){for(let l=c;l&&l!==n.parentNode;l=l.parentElement)if(!(!l||!l.hasAttributes||!l.hasAttributes())){for(let y of l.attributes)if(y.name==="data-action"||y.name.startsWith("data-action-"))return l}return null}function f(c,n=!1){if(c&&!(!n&&c.hasAttribute&&c.hasAttribute("data-comp-root"))){Object.entries(i).forEach(([l,y])=>{let _=l.includes(":"),[B,H]=_?l.split(":"):l.split(" "),W=B==="*";(W?["click","input","change","keydown","submit"]:[B]).forEach(g=>{let h=v=>{let E=d(v.target,s),T="",M="";if(E){let A=`data-action-${v.type}`,u=`data-args-${v.type}`;T=E.getAttribute(A)??E.getAttribute("data-action")??"",M=E.getAttribute(u)??E.getAttribute("data-args")??""}let x=T.split(":"),S=x[0],P=[];if(M)try{let A=JSON.parse(M);P=Array.isArray(A)?A:[A]}catch{console.warn("Invalid JSON in data-args:",M)}else P=x.slice(1);let $={...v.target.dataset,event:v,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:S,args:P};if(_&&E&&(H==="*"||H===S)&&(W||v.type===B))return y.call(e,$);if(!_){let A=v.target.closest(H||"*");return A&&s.contains(A)?y.call(e,$):void 0}},I=`__microBound_${g}_${l}`;s[I]||(s.addEventListener(g,h),s[I]=!0,r.push({node:s,type:g,listener:h}))})});for(let l of c.children)f(l,!1)}}f(t,!0)}var F=new WeakMap;function L(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let i=F.get(e);if(i||(i={},F.set(e,i)),i[t]){let f=i[t];if(f.isConnected&&e.contains(f))return f;delete i[t]}let r=e.querySelector(`[data-key="${t}"]`);if(r&&r._componentInstance)return i[t]=r._componentInstance,r._componentInstance;let s=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function d(f,c){if(f===c)return!0;let n=f.closest("[data-comp-root]");return!n||n===c}for(let f of s){let c=null;try{let n=e.querySelectorAll(f);for(let l of n)if(d(l,e)){c=l;break}}catch{console.warn(`ref() invalid selector: ${f} for ref name ${t}`)}if(c)return i[t]=c,c}return null}var N=new WeakMap;function V(e,t,i){if(!e||t===null||N.has(e)&&N.get(e).value===t)return;let r=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&r&&typeof r=="object"&&"default"in r&&(r=r.default),Array.isArray(r)){let s=e.parentNode;if(!s)return;let d={};Array.from(s.children).forEach(c=>{let n=c.getAttribute&&c.getAttribute("data-key");n!=null&&(d[n]=c)});let f=[];r.forEach(c=>{let n=typeof c=="function"?c():c,l=null,y=n?.props?.key??(n?.el?.getAttribute&&n.el.getAttribute("data-key"));if(y!=null&&d[y])l=d[y],n&&typeof n.update=="function"&&n.update();else if(n&&typeof n.mount=="function"){let _=document.createElement("div");n.mount(_),l=n.el instanceof HTMLElement?n.el:_,i._mountedChildren.includes(n)||i._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)l=n.el;else if(n instanceof Node)l=n;else if(typeof n=="string"){let _=document.createElement("div");_.innerHTML=n,l=_.firstChild}l&&f.push(l)}),s.contains(e)&&s.removeChild(e),f.forEach((c,n)=>{s.children[n]!==c&&s.insertBefore(c,s.children[n]||null)}),Array.from(s.children).forEach(c=>{f.includes(c)||s.removeChild(c)}),N.set(e,{value:t});return}if(r&&typeof r.mount=="function"){if(r.isMounted())r.update(),r.el!==e&&e.replaceWith(r.el);else{let s=document.createElement("div");e.replaceWith(s),r.mount(s),r.el===e&&(r.el=s)}i._mountedChildren.includes(r)||i._mountedChildren.push(r)}else if(r?.el instanceof HTMLElement)e.replaceWith(r.el);else if(r instanceof Node)e.replaceWith(r);else if(typeof r=="string"){let s=document.createElement("div");s.innerHTML=r;let d=document.createDocumentFragment();for(;s.firstChild;)d.appendChild(s.firstChild);e.replaceWith(d)}else e.replaceWith(document.createTextNode(""));N.set(e,{value:t})}function R(e,t,i,r){let d={...typeof r=="function"?r.call(i,t):typeof r=="object"?r:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(d={default:t.slots}),t.children!==void 0?d.default=t.children:d.default||(d.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(c=>{let n=c.getAttribute("data-comp");if(!n)return;let l=J(+n);l&&(c.setAttribute("data-ref",n),d[n]||(l._fromSlotHydration=!0,d[n]=l({...l._prevProps,...c.dataset}),l._fromSlotHydration=!1))}),Object.entries(d).forEach(([c,n])=>{let l;if(c==="default"||c==="children"?l=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):l=L(e.el,c),!l||n==null)return;let y=l.querySelector("[data-comp-root='"+e._id+"']");!y&&n&&typeof n.mount=="function"&&(y=document.createElement("div"),y.setAttribute("data-comp-root",e._id),l.innerHTML="",l.appendChild(y));let _=y||l;n._id&&(n._fromSlotHydration=!0),V(_,n,i),n._id&&(n._fromSlotHydration=!1)})}function D(e,t){if(!t)return;t.querySelectorAll("*").forEach(r=>{Array.from(r.attributes).forEach(s=>{if(!s.name.startsWith("data-action-"))return;let d=s.name.slice(12),f=s.value;if(!f)return;let c=`${d}:${f}`;if(typeof e.on[c]!="function"){if(typeof e.on[f]=="function"){e.on[c]=e.on[f].bind(e);return}typeof e[f]=="function"&&(e.on[c]=e[f].bind(e))}})})}function w(e,t,i=!0,r){let s=t;for(let d of e)try{let f=d.call(r,s);f!==void 0&&(s=f)}catch(f){console.error(f)}return i&&(e.length=0),s}function q(e,t,i){if(Array.isArray(e)){let s=function(){if(r<e.length){let d=e[r++];try{d.length?d.call(i,s):Promise.resolve(d.call(i)).then(s).catch(f=>{console.error(f),s()})}catch(f){console.error(f),s()}}else t()},r=0;s()}else if(e)try{e.length?e.call(i,t):Promise.resolve(e.call(i)).then(t).catch(r=>{console.error(r),t()})}catch(r){console.error(r),t()}else t()}function X(e,t){for(let i of Object.keys(e))i in t||Object.defineProperty(t,i,{get(){return e[i]},enumerable:!0})}var ne=1,xe="1.10.1",z=new Map;function re(e){e._id&&z.set(e._id,e)}function oe(e){e._id&&z.delete(e._id)}function J(e){return z.get(e)}var k=null;function ie(e,t={}){let i=e._frozenTemplate,r=se(i.renderFn,i.options);return r._initialProps=t,r._templateSource=e,r}function se(e,t={}){let i,r={},s=typeof e;s==="object"&&s!=="function"&&e!==null&&!Array.isArray(e)?(i=e.render,r={...e},delete r.render):(i=e,r=t||{});let{state:d={},on:f={},slots:c={},onMount:n,onUnmount:l,onBeforeMount:y,onBeforeUnmount:_,onUpdate:B,onBeforeRender:H,...W}=r,m=null,g=!1,h={},I={},v=null,E=!1,T=[],M=d,x=null,S=!1,P={...d},$=!1,A=o=>{M=typeof o=="function"?o(M):{...M,...o},$||($=!0,v={...h},queueMicrotask(()=>{$=!1,a(v),v=null}))},u={refs:{},on(){},setState:A,props:h,_childCallCache:{},_childCallIndex:0,isMounted:()=>g,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],_beforeRenderCbs:[],onMount(o){typeof o=="function"&&this._mountCbs.push(o)},onUnmount(o){typeof o=="function"&&this._unmountCbs.push(o)},onBeforeMount(o){typeof o=="function"&&this._beforeMountCbs.push(o)},onBeforeUnmount(o){typeof o=="function"&&this._beforeUnmountCbs.push(o)},onUpdate(o){typeof o=="function"&&this._updateCbs.push(o)},onBeforeRender(o){typeof o=="function"&&this._beforeRenderCbs.push(o)},addEvent(o,p){this.on[o]||(this.on[o]=p)},mount(o,p={}){if(g||E)return;let b=typeof o=="string"?document.querySelector(o):o;if(!b)throw new Error(`No element matches: ${o}`);let C=()=>{E=!0,m=b,m.setAttribute("data-comp-root",a._id+"-"+(i.name||"")),h={...h,...p},I={...h},u.props=h,m._componentInstance=a,h.key&&m.setAttribute("data-key",h.key),a(h),S||(g=!0,w(u._mountCbs,void 0,!1,a))};q(u._beforeMountCbs,C,a)},update(o={}){if(!g)return;let p=o.props?o.props:o,b=p.on;b&&Object.assign(u.on,b);let C={...h,...p};I={...h},h=C,u.props=h,h.key!==I.key&&m.setAttribute("data-key",h.key),a(h)},render(o={}){h={...h,...o},u.props=h;let p=typeof i=="function"?i.call(a,{state:M,setState:A,props:h,refs:u.refs}):i,b=w(u._beforeRenderCbs,p,!1,a);return b&&(b=new String(b),b._id=a._id),X(u,a),b},_resetInternal:()=>{u._mountedChildren.forEach(o=>{o&&typeof o.unmount=="function"&&o.unmount()}),u._mountedChildren=[],x=null,S=!1,m=null,g=!1,E=!1,T=[],h={},I={},M={...P}},unmount(){if(!g||!m)return;let o=()=>{m.firstChild&&(x=m.firstChild.cloneNode(!0),m.removeChild(m.firstChild)),w(u._unmountCbs,void 0,!0,a),T.forEach(({node:p,type:b,listener:C})=>{p.removeEventListener(b,C)}),T=[],g=!1,E=!1,S=!0,oe(a),u._resetInternal&&u._resetInternal()};q(u._beforeUnmountCbs,o,u)},get renderFn(){return i},get el(){return m},get state(){return M}};n&&u.onMount(n),l&&u.onUnmount(l),y&&u.onBeforeMount(y),_&&u.onBeforeUnmount(_),B&&u.onUpdate(B),H&&u.onBeforeRender(H),Object.assign(u.on,f),u.ref=function(o){return L(this.el,o)},u.refs=new Proxy({},{get(o,p){return u.ref(p)}});function G(o){h={...u.props,...o},u.props=h,!m||m.isConnected;let p=u.render(h);if(p===null||p===""){!S&&m&&m.firstChild?(x=m.firstChild.cloneNode(!0),q(u._beforeUnmountCbs,()=>{m.innerHTML="",T.forEach(({node:C,type:Q,listener:Y})=>{C.removeEventListener(Q,Y)}),T=[],g=!1,S=!0,w(u._unmountCbs,void 0,!0,a)},u)):S=!0;return}if(S&&x){m.appendChild(x),x=null,S=!1,g=!0,U(a,m,a.on,T),w(u._mountCbs,void 0,!1,a);return}return O(m,p),R(a,h,u,c),D(a,m),U(a,m,a.on,T),g&&w(u._updateCbs,I,!1,a),S=!1,p}let j="";function a(o={}){if(!a._fromSlotHydration&&k&&k!==a){let p=k;p._childCallIndex==null&&(p._childCallIndex=0),p._childCallCache||(p._childCallCache={});let b=o.key!=null?o.key:p._childCallIndex++,C=p._childCallCache[b];return!C||C._templateSource!==a?(C=ie(a,o),C._prevProps={...o},C.toString=()=>`<div data-comp="${C._id}"></div>`,p._childCallCache[b]=C):(C._prevProps={...o},C.update(o)),C}return k=a,a._renderIndex=0,a._childCallIndex=0,a._prevProps=o,j=a._render(o),k=null,a}return a.toString=function(){return!j||String(j)===""&&!a.isMounted()&&k!==null&&k._id!==a._id?String(a._id):j?String(j):""},Object.assign(a,u,W),["el","props","state","setState"].forEach(o=>{Object.defineProperty(a,o,{get(){return u[o]},enumerable:!0,configurable:!1})}),a._render=G,a.render=u.render,a._id=ne++,a.getId=()=>a._id,re(a),a._frozenTemplate=Object.freeze({renderFn:i,options:{...r,state:{...P}}}),a}function Ie(){return k}export{xe as __VERSION__,se as createComponent,J as getComponentById,z as globalComponentRegistry,re as registerComponent,oe as unregisterComponent,Ie as useCurrentComponent};
//# sourceMappingURL=magnumjs-micro-ui.esm.js.map
