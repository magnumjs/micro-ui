/*!
 * @magnumjs/micro-ui v1.1.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function D(e,t){if(!e)return!1;let r=document.createElement("div");if(r.innerHTML=t,r.children.length===0&&r.textContent)return e.textContent=r.textContent,!0;let n=Array.from(r.children),o=Array.from(e.children),i=new Map,s=new Map;for(let a of n){let p=a.dataset.key;p&&i.set(p,a)}for(let a of o){let p=a.dataset.key;p&&s.set(p,a)}let f=0;for(let a of n){let p=a.dataset.key,A=e.children[f];if(p&&s.has(p)){let E=s.get(p);J(E,a),E!==A&&e.insertBefore(E,A||null),s.delete(p)}else e.insertBefore(a,A||null);f++}for(let a of s.values())a.remove();for(;e.children.length>n.length;)e.lastChild.remove();return!0}function J(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}G(e,t),Q(e,t)}function G(e,t){let r=e.attributes,n=t.attributes;for(let{name:o}of Array.from(r))t.hasAttribute(o)||e.removeAttribute(o);for(let{name:o,value:i}of Array.from(n))e.getAttribute(o)!==i&&e.setAttribute(o,i)}function Q(e,t){let r=Array.from(e.childNodes),n=Array.from(t.childNodes),o=Math.max(r.length,n.length);for(let i=0;i<o;i++){let s=r[i],f=n[i];if(!f&&s){e.removeChild(s);continue}if(!s&&f){e.appendChild(f.cloneNode(!0));continue}Y(s,f)}}function Y(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?J(e,t):e.replaceWith(t.cloneNode(!0))}}function B(e,t,r,n){if(!t||!r)return;let o=t.firstElementChild;if(!o)return;function i(s,f=!1){if(s){!f&&s.hasAttribute&&s.hasAttribute("data-comp-root"),Object.entries(r).forEach(([a,p])=>{let A=a.includes(":"),[E,O]=A?a.split(":"):a.split(" "),h=E==="*";(h?["click","input","change","keydown","submit"]:[E]).forEach(d=>{let w=M=>{let C=M.target.closest("[data-action]"),T=C?.dataset.action||"",S=C?.dataset.args,y=T.split(":"),$=y[0],x=[];if(S)try{let b=JSON.parse(S);x=Array.isArray(b)?b:[b]}catch{console.warn("Invalid JSON in data-args:",S)}else x=y.slice(1);let L={event:M,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:$,args:x};if(A&&C&&(O==="*"||O===$)&&(h||M.type===E))return p.call(e,L);if(!A){let b=M.target.closest(O||"*");if(b&&o.contains(b))return p.call(e,L)}},H=`__microBound_${d}_${a}`;o[H]||(o.addEventListener(d,w),o[H]=!0,n.push({node:o,type:d,listener:w}))})});for(let a of s.children)i(a,!1)}}i(t,!0)}function ee(e){let t=e,r=new Set;function n(s){t=typeof s=="function"?s(t):{...t,...s},r.forEach(f=>f(t))}function o(s){return r.add(s),s(t),()=>r.delete(s)}function i(){return t}return{get:i,setState:n,getState:i,subscribe:o}}var N=new Map,P={subscribe(e,t){N.has(e)||N.set(e,new Set);let r=N.get(e);return r.add(t),()=>r.delete(t)},emit(e,t){let r=N.get(e);if(r)for(let n of r)n(t)},clear(){N.clear()}},I=new Map;function te(e,t={}){if(!I.has(e)){let r=ee(t),n={...r,emit(o,i){r.setState(i),P.emit(`${e}::${o}`,r.getState())},on(o,i){return P.subscribe(`${e}::${o}`,i)}};I.set(e,n)}return I.get(e)}te.clear=()=>I.clear();var j={};function W(e,t){if(!e)return null;if(j[t]){let o=j[t];if(o.isConnected){if(e.contains(o)||e.parentNode&&e.parentNode!==document.body&&e.parentNode.contains(o))return o;delete j[t]}else delete j[t]}let r=document.getElementById(t);if(r&&(e.contains(r)||e.parentNode&&e.parentNode.contains(r)))return j[t]=r,r;let n=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",t];for(let o of n){let i=e.querySelector(o);if(i||e.parentNode&&(i=e.parentNode.querySelector(o),i))return j[t]=i,i}return null}var q=new WeakMap;function U(e,t,r){if(!e||t===null||q.has(e)&&q.get(e).value===t)return;let n=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&n&&typeof n=="object"&&"default"in n&&(n=n.default),Array.isArray(n)){let o=document.createDocumentFragment();n.forEach(i=>{let s=typeof i=="function"?i():i;if(s&&typeof s.mount=="function"){let f=document.createElement("div");if(s.isMounted())s.update(),s.el instanceof HTMLElement&&o.appendChild(s.el);else for(s.mount(f),r._mountedChildren.includes(s)||r._mountedChildren.push(s);f.firstChild;)o.appendChild(f.firstChild)}else if(s?.el instanceof HTMLElement)o.appendChild(s.el);else if(s instanceof Node)o.appendChild(s);else if(typeof s=="string"){let f=document.createElement("div");for(f.innerHTML=s;f.firstChild;)o.appendChild(f.firstChild)}}),e.replaceWith(o),q.set(e,{value:t});return}if(n&&typeof n.mount=="function"){if(n.isMounted())n.update(),n.el!==e&&e.replaceWith(n.el);else{let o=document.createElement("div");e.replaceWith(o),n.mount(o),n.el===e&&(n.el=o)}r._mountedChildren.includes(n)||r._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let o=document.createElement("div");o.innerHTML=n;let i=document.createDocumentFragment();for(;o.firstChild;)i.appendChild(o.firstChild);e.replaceWith(i)}else e.replaceWith(document.createTextNode(""));q.set(e,{value:t})}function k(e,t,r,n){let i={...typeof n=="function"?n.call(r,t):typeof n=="object"?n:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(i={default:t.slots}),t.children!==void 0?i.default=t.children:i.default||(i.default=null),Object.entries(i).forEach(([s,f])=>{let a;if(s==="default"||s==="children"?a=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):a=W(e.el,s),!a||f==null)return;let p=a.querySelector("[data-comp-root='"+e._id+"']");!p&&f&&typeof f.mount=="function"&&(p=document.createElement("div"),p.setAttribute("data-comp-root",e._id),a.innerHTML="",a.appendChild(p)),U(p||a,f,r)})}var ne=1,ge="1.1.0";function re(e,t){for(let r of Object.keys(e))r in t||Object.defineProperty(t,r,{get(){return e[r]},enumerable:!0})}var F=null;function Ce(e,t={}){let r,n={},o=typeof e;o==="object"&&o!=="funcion"&&e!==null&&!Array.isArray(e)?(r=e.render,n={...e},delete n.render):(r=e,n=t||{});let{state:i={},on:s={},slots:f={},onMount:a,onUnmount:p,onBeforeMount:A,onBeforeUnmount:E,onUpdate:O}=n,h=null,g=!1,d={},w={},H=null,M=!1,C=[],T=i,S=null,y=!1,$={...i},x=!1,L=[],b=c=>{T=typeof c=="function"?c(T):{...T,...c},x||(x=!0,H={...d},queueMicrotask(()=>{x=!1,m(H),H=null}))},l={refs:{},setState:b,props:d,isMounted:()=>g,_mountedChildren:[],mount(c,u={}){if(g||M)return;let _=typeof c=="string"?document.querySelector(c):c;if(!_)throw new Error(`No element matches: ${c}`);V(A,()=>{M=!0,h=_,h.setAttribute("data-comp-root",m._id),d={...d,...u},w={...d},l.props=d,m(d),y||(g=!0,a?.call(m),K())})},update(c={}){if(!g)return;let u=c.props?c.props:c,_=u.on;_&&_!==s&&(s=_);let v={...d,...u};w={...d},d=v,l.props=d,m(d)},render(c={}){d={...d,...c},l.props=d;let u=typeof r=="function"?r.call(l,{state:T,setState:b,props:d,refs:l.refs}):r;return u&&(u=new String(u),u._id=m._id),re(l,m),u},_resetInternal:()=>{l._mountedChildren.forEach(c=>{c&&typeof c.unmount=="function"&&c.unmount()}),l._mountedChildren=[],S=null,y=!1,h=null,g=!1,M=!1,C=[],d={},w={},T={...$}},unmount(){if(!g||!h)return;V(E,()=>{h.firstChild&&(S=h.firstChild.cloneNode(!0),h.removeChild(h.firstChild)),C.forEach(({node:u,type:_,listener:v})=>{u.removeEventListener(_,v)}),C=[],L.forEach(u=>u()),L=[],g=!1,M=!1,y=!0,p?.call(l),l._resetInternal&&l._resetInternal()})},get renderFn(){return r},get el(){return h},get state(){return T}};l.ref=function(c){return W(this.el,c)},l.refs=new Proxy({},{get(c,u){return l.ref(u)}}),l.action=function(c){return c.target.closest("[data-action]")?.dataset.action||null};function K(){L=[],Object.entries(s).forEach(([c,u])=>{if(c.includes("::")){let _=u.bind(l),v=P.subscribe(c,_);L.push(v)}})}function z(c){d={...l.props,...c},l.props=d,!h||h.isConnected;let u=l.render(d);if(u===null||u===""){!y&&h&&h.firstChild?(S=h.firstChild.cloneNode(!0),V(E,()=>{h.innerHTML="",C.forEach(({node:v,type:X,listener:Z})=>{v.removeEventListener(X,Z)}),C=[],g=!1,y=!0,p?.call(l)})):y=!0;return}if(y&&S){h.appendChild(S),S=null,y=!1,g=!0,B(l,h,s,C),a?.call(l);return}return D(h,u),k(m,d,l,f),B(l,h,s,C),g&&O&&O.call(l,w),y=!1,u}function V(c,u){c?c.length?c.call(l,u):Promise.resolve(c.call(l)).then(u):u()}let R="";function m(c={}){return F=m,R=m._render(c),F=null,m}return m.toString=function(){return R?String(R):""},Object.assign(m,l),["el","props","state","setState"].forEach(c=>{Object.defineProperty(m,c,{get(){return l[c]},enumerable:!0,configurable:!1})}),m._render=z,m.render=l.render,m._id=ne++,m}function be(e,t,r=n=>n.id??n.key??n){return e.map((n,o)=>{let i=r(n,o),s=t(n,o);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(i).replace(/"/g,"&quot;")}"`):s}).join("")}function _e(){return F}export{ge as __VERSION__,P as context,Ce as createComponent,ee as createState,be as renderList,te as shared,_e as useCurrentComponent};
//# sourceMappingURL=magnumjs-micro-ui.esm.js.map
