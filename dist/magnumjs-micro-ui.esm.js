/*!
 * @magnumjs/micro-ui v1.7.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function z(e,t){if(!e)return!1;let o=document.createElement("div");if(o.innerHTML=t,o.children.length===0&&e.children.length===0&&o.textContent)return e.textContent!==o.textContent&&(e.textContent=o.textContent),!0;let n=Array.from(o.children),s=Array.from(e.children),c=new Map,r=new Map;for(let f of n){let a=f.dataset.key;a&&c.set(a,f)}for(let f of s){let a=f.dataset.key;a&&r.set(a,f)}let l=0;for(let f of n){let a=f.dataset.key,C=e.children[l];if(a&&r.has(a)){let A=r.get(a);A.hasAttribute("data-comp-root")||X(A,f),A!==C&&e.insertBefore(A,C||null),r.delete(a)}else e.insertBefore(f,C||null);l++}for(let f of r.values())f.hasAttribute("data-comp-root")||f.remove();for(;e.children.length>n.length;){let f=e.lastChild;if(f?.hasAttribute?.("data-comp-root"))break;f.remove()}return!0}function X(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}oe(e,t),!e.hasAttribute("data-comp-root")&&ie(e,t)}function oe(e,t){let o=e.attributes,n=t.attributes;for(let{name:s}of Array.from(o))t.hasAttribute(s)||e.removeAttribute(s);for(let{name:s,value:c}of Array.from(n))e.getAttribute(s)!==c&&e.setAttribute(s,c)}function ie(e,t){let o=Array.from(e.childNodes),n=Array.from(t.childNodes),s=Math.max(o.length,n.length);for(let c=0;c<s;c++){let r=o[c],l=n[c];if(!l&&r){if(r.nodeType===1&&r.hasAttribute("data-comp-root"))continue;e.removeChild(r);continue}if(!r&&l){e.appendChild(l.cloneNode(!0));continue}se(r,l)}}function se(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?X(e,t):e.replaceWith(t.cloneNode(!0))}}function N(e,t,o,n){if(!t||!t.children[0]||!o)return;let s=t.children.length>1?t:t.children[0];function c(l,f){for(let a=l;a&&a!==f.parentNode;a=a.parentElement)if(!(!a||!a.hasAttributes||!a.hasAttributes())){for(let C of a.attributes)if(C.name==="data-action"||C.name.startsWith("data-action-"))return a}return null}function r(l,f=!1){if(l&&!(!f&&l.hasAttribute&&l.hasAttribute("data-comp-root"))){Object.entries(o).forEach(([a,C])=>{let A=a.includes(":"),[H,j]=A?a.split(":"):a.split(" "),m=H==="*";(m?["click","input","change","keydown","submit"]:[H]).forEach(h=>{let T=S=>{let _=c(S.target,s),v="",x="";if(_){let g=`data-action-${S.type}`,q=`data-args-${S.type}`;v=_.getAttribute(g)??_.getAttribute("data-action")??"",x=_.getAttribute(q)??_.getAttribute("data-args")??""}let M=v.split(":"),U=M[0],w=[];if(x)try{let g=JSON.parse(x);w=Array.isArray(g)?g:[g]}catch{console.warn("Invalid JSON in data-args:",x)}else w=M.slice(1);let I={...S.target.dataset,event:S,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:U,args:w};if(A&&_&&(j==="*"||j===U)&&(m||S.type===H))return C.call(e,I);if(!A){let g=S.target.closest(j||"*");return g&&s.contains(g)?C.call(e,I):void 0}},B=`__microBound_${h}_${a}`;s[B]||(s.addEventListener(h,T),s[B]=!0,n.push({node:s,type:h,listener:T}))})});for(let a of l.children)r(a,!1)}}r(t,!0)}function F(){let e=new Map;return{subscribe(t,o){e.has(t)||e.set(t,new Set);let n=e.get(t);return n.add(o),()=>n.delete(o)},emit(t,o){let n=e.get(t);if(n)for(let s of n)s(o)},clear(){e.clear()}}}function ce(e){let t=e,o=new Set;function n(r){typeof t=="object"&&t!==null&&typeof r=="object"&&r!==null&&!Array.isArray(t)&&!Array.isArray(r)?t={...t,...r}:t=typeof r=="function"?r(t):r,o.forEach(l=>l(t))}function s(r){return o.add(r),r(t),()=>o.delete(r)}function c(){return t}return{get:c,setState:n,getState:c,subscribe:s}}var L=F(),O=new Map;function le(e,t={}){if(!O.has(e)){let o=ce(t),n={...o,emit(s,c){o.setState(c),L.emit(`${e}::${s}`,o.getState())},on(s,c){return L.subscribe(`${e}::${s}`,c)}};O.set(e,n)}return O.get(e)}le.clear=()=>O.clear();var Z=new WeakMap;function k(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let o=Z.get(e);if(o||(o={},Z.set(e,o)),o[t]){let c=o[t];if(c.isConnected&&e.contains(c))return c;delete o[t]}let n=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function s(c,r){if(c===r)return!0;let l=c.closest("[data-comp-root]");return!l||l===r}for(let c of n){let r=null;try{let l=e.querySelectorAll(c);for(let f of l)if(s(f,e)){r=f;break}}catch{throw new Error(`ref() invalid selector: '${c}' for ref name '${t}'`)}if(r)return o[t]=r,r}return null}var V=new WeakMap;function G(e,t,o){if(!e||t===null||V.has(e)&&V.get(e).value===t)return;let n=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&n&&typeof n=="object"&&"default"in n&&(n=n.default),Array.isArray(n)){let s=document.createDocumentFragment();n.forEach(c=>{let r=typeof c=="function"?c():c;if(r&&typeof r.mount=="function"){let l=document.createElement("div");if(r.isMounted())r.update(),r.el instanceof HTMLElement&&s.appendChild(r.el);else for(r.mount(l),o._mountedChildren.includes(r)||o._mountedChildren.push(r);l.firstChild;)s.appendChild(l.firstChild)}else if(r?.el instanceof HTMLElement)s.appendChild(r.el);else if(r instanceof Node)s.appendChild(r);else if(typeof r=="string"){let l=document.createElement("div");for(l.innerHTML=r;l.firstChild;)s.appendChild(l.firstChild)}}),e.replaceWith(s),V.set(e,{value:t});return}if(n&&typeof n.mount=="function"){if(n.isMounted())n.update(),n.el!==e&&e.replaceWith(n.el);else{let s=document.createElement("div");e.replaceWith(s),n.mount(s),n.el===e&&(n.el=s)}o._mountedChildren.includes(n)||o._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let s=document.createElement("div");s.innerHTML=n;let c=document.createDocumentFragment();for(;s.firstChild;)c.appendChild(s.firstChild);e.replaceWith(c)}else e.replaceWith(document.createTextNode(""));V.set(e,{value:t})}function J(e,t,o,n){let c={...typeof n=="function"?n.call(o,t):typeof n=="object"?n:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(c={default:t.slots}),t.children!==void 0?c.default=t.children:c.default||(c.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(l=>{let f=l.getAttribute("data-comp");if(!f)return;let a=Q(+f);a&&(l.setAttribute("data-ref",f),c[f]||(a._fromSlotHydration=!0,c[f]=a({...a._prevProps,...l.dataset}),a._fromSlotHydration=!1))}),Object.entries(c).forEach(([l,f])=>{let a;if(l==="default"||l==="children"?a=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):a=k(e.el,l),!a||f==null)return;let C=a.querySelector("[data-comp-root='"+e._id+"']");!C&&f&&typeof f.mount=="function"&&(C=document.createElement("div"),C.setAttribute("data-comp-root",e._id),a.innerHTML="",a.appendChild(C));let A=C||a;f._id&&(f._fromSlotHydration=!0),G(A,f,o),f._id&&(f._fromSlotHydration=!1)})}function K(e,t){if(!t)return;t.querySelectorAll("*").forEach(n=>{Array.from(n.attributes).forEach(s=>{if(!s.name.startsWith("data-action-"))return;let c=s.name.slice(12),r=s.value;if(!r)return;let l=`${c}:${r}`;if(typeof e.on[l]!="function"){if(typeof e.on[r]=="function"){e.on[l]=e.on[r].bind(e);return}typeof e[r]=="function"&&(e.on[l]=e[r].bind(e))}})})}function P(e,t,o=!0,n){for(let s of e)try{s.call(n,t)}catch(c){console.error(c)}o&&(e.length=0)}function D(e,t,o){if(Array.isArray(e)){let s=function(){if(n<e.length){let c=e[n++];try{c.length?c.call(o,s):Promise.resolve(c.call(o)).then(s).catch(r=>{console.error(r),s()})}catch(r){console.error(r),s()}}else t()},n=0;s()}else if(e)try{e.length?e.call(o,t):Promise.resolve(e.call(o)).then(t).catch(n=>{console.error(n),t()})}catch(n){console.error(n),t()}else t()}function Y(e,t){for(let o of Object.keys(e))o in t||Object.defineProperty(t,o,{get(){return e[o]},enumerable:!0})}function ae(e,t,o=n=>n.id??n.key??n){return e.map((n,s)=>{let c=o(n,s),r=t(n,s);return typeof r=="string"?r.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(c).replace(/"/g,"&quot;")}"`):r}).join("")}var ue=1,ke="1.7.0",R=new Map;function fe(e){e._id&&R.set(e._id,e)}function de(e){e._id&&R.delete(e._id)}function Q(e){return R.get(e)}var $=null;function pe(e,t={}){let o=e._frozenTemplate,n=he(o.renderFn,o.options);return n._initialProps=t,n._templateSource=e,n}function he(e,t={}){let o,n={},s=typeof e;s==="object"&&s!=="function"&&e!==null&&!Array.isArray(e)?(o=e.render,n={...e},delete n.render):(o=e,n=t||{});let{state:c={},on:r={},slots:l={},onMount:f,onUnmount:a,onBeforeMount:C,onBeforeUnmount:A,onUpdate:H,...j}=n,m=null,E=!1,h={},T={},B=null,S=!1,_=[],v=c,x=null,M=!1,U={...c},w=!1,I=[],g=F(),q=i=>{v=typeof i=="function"?i(v):{...v,...i},w||(w=!0,B={...h},queueMicrotask(()=>{w=!1,p(B),B=null}))},d={refs:{},on:r,setState:q,props:h,_childCallCache:{},_childCallIndex:0,isMounted:()=>E,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],onMount(i){typeof i=="function"&&this._mountCbs.push(i)},onUnmount(i){typeof i=="function"&&this._unmountCbs.push(i)},onBeforeMount(i){typeof i=="function"&&this._beforeMountCbs.push(i)},onBeforeUnmount(i){typeof i=="function"&&this._beforeUnmountCbs.push(i)},onUpdate(i){typeof i=="function"&&this._updateCbs.push(i)},emit(i,u){g.emit(i,u)},onEmit(i,u){let b=g.subscribe(i,u);return this.onUnmount(b),b},emitGlobal(i,u){L.emit(i,u)},onEmitGlobal(i,u){let b=L.subscribe(i,u);return this.onUnmount(b),b},addEvent(i,u){r[i]=u},mount(i,u={}){if(E||S)return;let b=typeof i=="string"?document.querySelector(i):i;if(!b)throw new Error(`No element matches: ${i}`);let y=()=>{S=!0,m=b,m.setAttribute("data-comp-root",p._id+"-"+(o.name||"")),h={...h,...u},T={...h},d.props=h,h.key&&m.setAttribute("data-key",h.key),p(h),M||(E=!0,P(d._mountCbs,void 0,!1,p),ee())};D(d._beforeMountCbs,y,p)},update(i={}){if(!E)return;let u=i.props?i.props:i,b=u.on;b&&b!==r&&(r=b);let y={...h,...u};T={...h},h=y,d.props=h,h.key!==T.key&&m.setAttribute("data-key",h.key),p(h)},render(i={}){h={...h,...i},d.props=h;let u=typeof o=="function"?o.call(d,{state:v,setState:q,props:h,refs:d.refs}):o;return u&&(u=new String(u),u._id=p._id),Y(d,p),u},_resetInternal:()=>{d._mountedChildren.forEach(i=>{i&&typeof i.unmount=="function"&&i.unmount()}),d._mountedChildren=[],x=null,M=!1,m=null,E=!1,S=!1,_=[],h={},T={},v={...U}},unmount(){if(!E||!m)return;let i=()=>{m.firstChild&&(x=m.firstChild.cloneNode(!0),m.removeChild(m.firstChild)),P(d._unmountCbs,void 0,!0,p),g.clear(),_.forEach(({node:u,type:b,listener:y})=>{u.removeEventListener(b,y)}),_=[],I.forEach(u=>u()),I=[],E=!1,S=!1,M=!0,de(p),d._resetInternal&&d._resetInternal()};D(d._beforeUnmountCbs,i,d)},get renderFn(){return o},get el(){return m},get state(){return v}};f&&d.onMount(f),a&&d.onUnmount(a),C&&d.onBeforeMount(C),A&&d.onBeforeUnmount(A),H&&d.onUpdate(H),d.ref=function(i){return k(this.el,i)},d.refs=new Proxy({},{get(i,u){return d.ref(u)}});function ee(){I=[],Object.entries(r).forEach(([i,u])=>{if(i.includes("::")){let b=u.bind(d),y=L.subscribe(i,b);I.push(y)}})}function te(i){h={...d.props,...i},d.props=h,!m||m.isConnected;let u=d.render(h);if(u===null||u===""){!M&&m&&m.firstChild?(x=m.firstChild.cloneNode(!0),D(d._beforeUnmountCbs,()=>{m.innerHTML="",_.forEach(({node:y,type:ne,listener:re})=>{y.removeEventListener(ne,re)}),_=[],E=!1,M=!0,P(d._unmountCbs,void 0,!0,p)},d)):M=!0;return}if(M&&x){m.appendChild(x),x=null,M=!1,E=!0,N(d,m,r,_),P(d._mountCbs,void 0,!1,p);return}return z(m,u),J(p,h,d,l),K(p,m),N(d,m,r,_),E&&P(d._updateCbs,T,!1,p),M=!1,u}let W="";function p(i={}){if(!p._fromSlotHydration&&$&&$!==p){let u=$;u._childCallIndex==null&&(u._childCallIndex=0),u._childCallCache||(u._childCallCache={});let b=u._childCallIndex++,y=u._childCallCache[b];return!y||y._templateSource!==p?(y=pe(p,i),y._prevProps={...i},y.toString=()=>`<div data-comp="${y._id}"></div>`,u._childCallCache[b]=y):(y._prevProps={...i},y.update(i)),y}return $=p,p._renderIndex=0,p._childCallIndex=0,p._prevProps=i,W=p._render(i),$=null,p}return p.toString=function(){return!W||String(W)===""&&!p.isMounted()&&$?p._id:W?String(W):""},Object.assign(p,d,j),["el","props","state","setState"].forEach(i=>{Object.defineProperty(p,i,{get(){return d[i]},enumerable:!0,configurable:!1})}),p._render=te,p.render=d.render,p._id=ue++,p.getId=()=>p._id,fe(p),p._frozenTemplate=Object.freeze({renderFn:o,options:{...n,state:{...U}}}),p}function Ne(){return $}export{ke as __VERSION__,he as createComponent,Q as getComponentById,R as globalComponentRegistry,fe as registerComponent,ae as renderList,de as unregisterComponent,Ne as useCurrentComponent};
//# sourceMappingURL=magnumjs-micro-ui.esm.js.map
