/*!
 * @magnumjs/micro-ui v1.10.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function O(e,t){if(!e)return!1;let i=document.createElement("div");if(i.innerHTML=t,i.children.length===0&&e.children.length===0&&i.textContent)return e.textContent!==i.textContent&&(e.textContent=i.textContent),!0;let n=Array.from(i.children),s=Array.from(e.children),d=new Map,f=new Map;for(let r of n){let l=r.dataset.key;l&&d.set(l,r)}for(let r of s){let l=r.dataset.key;l&&f.set(l,r)}let c=0;for(let r of n){let l=r.dataset.key,y=e.children[c];if(l&&f.has(l)){let _=f.get(l);_.hasAttribute("data-comp-root")||F(_,r),_!==y&&e.insertBefore(_,y||null),f.delete(l)}else e.insertBefore(r,y||null);c++}for(let r of f.values())r.hasAttribute("data-comp-root")||r.remove();for(;e.children.length>n.length;){let r=e.lastChild;if(r?.hasAttribute?.("data-comp-root"))break;r.remove()}return!0}function F(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}R(e,t),!e.hasAttribute("data-comp-root")&&Y(e,t)}function R(e,t){let i=e.attributes,n=t.attributes;for(let{name:s}of Array.from(i))t.hasAttribute(s)||e.removeAttribute(s);for(let{name:s,value:d}of Array.from(n))e.getAttribute(s)!==d&&e.setAttribute(s,d)}function Y(e,t){let i=Array.from(e.childNodes),n=Array.from(t.childNodes),s=Math.max(i.length,n.length);for(let d=0;d<s;d++){let f=i[d],c=n[d];if(!c&&f){if(f.nodeType===1&&f.hasAttribute("data-comp-root"))continue;e.removeChild(f);continue}if(!f&&c){e.appendChild(c.cloneNode(!0));continue}ee(f,c)}}function ee(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?F(e,t):e.replaceWith(t.cloneNode(!0))}}function W(e,t,i,n){if(!t||!t.children[0]||!i)return;let s=t.children.length>1?t:t.children[0];function d(c,r){for(let l=c;l&&l!==r.parentNode;l=l.parentElement)if(!(!l||!l.hasAttributes||!l.hasAttributes())){for(let y of l.attributes)if(y.name==="data-action"||y.name.startsWith("data-action-"))return l}return null}function f(c,r=!1){if(c&&!(!r&&c.hasAttribute&&c.hasAttribute("data-comp-root"))){Object.entries(i).forEach(([l,y])=>{let _=l.includes(":"),[k,H]=_?l.split(":"):l.split(" "),m=k==="*";(m?["click","input","change","keydown","submit"]:[k]).forEach(p=>{let x=A=>{let b=d(A.target,s),M="",E="";if(b){let a=`data-action-${A.type}`,N=`data-args-${A.type}`;M=b.getAttribute(a)??b.getAttribute("data-action")??"",E=b.getAttribute(N)??b.getAttribute("data-args")??""}let S=M.split(":"),B=S[0],I=[];if(E)try{let a=JSON.parse(E);I=Array.isArray(a)?a:[a]}catch{console.warn("Invalid JSON in data-args:",E)}else I=S.slice(1);let P={...A.target.dataset,event:A,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:B,args:I};if(_&&b&&(H==="*"||H===B)&&(m||A.type===k))return y.call(e,P);if(!_){let a=A.target.closest(H||"*");return a&&s.contains(a)?y.call(e,P):void 0}},w=`__microBound_${p}_${l}`;s[w]||(s.addEventListener(p,x),s[w]=!0,n.push({node:s,type:p,listener:x}))})});for(let l of c.children)f(l,!1)}}f(t,!0)}var J=new WeakMap;function j(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let i=J.get(e);if(i||(i={},J.set(e,i)),i[t]){let f=i[t];if(f.isConnected&&e.contains(f))return f;delete i[t]}let n=e.querySelector(`[data-key="${t}"]`);if(n&&n._componentInstance)return i[t]=n._componentInstance,n._componentInstance;let s=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function d(f,c){if(f===c)return!0;let r=f.closest("[data-comp-root]");return!r||r===c}for(let f of s){let c=null;try{let r=e.querySelectorAll(f);for(let l of r)if(d(l,e)){c=l;break}}catch{throw new Error(`ref() invalid selector: '${f}' for ref name '${t}'`)}if(c)return i[t]=c,c}return null}var U=new WeakMap;function V(e,t,i){if(!e||t===null||U.has(e)&&U.get(e).value===t)return;let n=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&n&&typeof n=="object"&&"default"in n&&(n=n.default),Array.isArray(n)){let s=e.parentNode;if(!s)return;let d={};Array.from(s.children).forEach(c=>{let r=c.getAttribute&&c.getAttribute("data-key");r!=null&&(d[r]=c)});let f=[];n.forEach(c=>{let r=typeof c=="function"?c():c,l=null,y=r?.props?.key??(r?.el?.getAttribute&&r.el.getAttribute("data-key"));if(y!=null&&d[y])l=d[y],r&&typeof r.update=="function"&&r.update();else if(r&&typeof r.mount=="function"){let _=document.createElement("div");r.mount(_),l=r.el instanceof HTMLElement?r.el:_,i._mountedChildren.includes(r)||i._mountedChildren.push(r)}else if(r?.el instanceof HTMLElement)l=r.el;else if(r instanceof Node)l=r;else if(typeof r=="string"){let _=document.createElement("div");_.innerHTML=r,l=_.firstChild}l&&f.push(l)}),s.contains(e)&&s.removeChild(e),f.forEach((c,r)=>{s.children[r]!==c&&s.insertBefore(c,s.children[r]||null)}),Array.from(s.children).forEach(c=>{f.includes(c)||s.removeChild(c)}),U.set(e,{value:t});return}if(n&&typeof n.mount=="function"){if(n.isMounted())n.update(),n.el!==e&&e.replaceWith(n.el);else{let s=document.createElement("div");e.replaceWith(s),n.mount(s),n.el===e&&(n.el=s)}i._mountedChildren.includes(n)||i._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let s=document.createElement("div");s.innerHTML=n;let d=document.createDocumentFragment();for(;s.firstChild;)d.appendChild(s.firstChild);e.replaceWith(d)}else e.replaceWith(document.createTextNode(""));U.set(e,{value:t})}function z(e,t,i,n){let d={...typeof n=="function"?n.call(i,t):typeof n=="object"?n:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(d={default:t.slots}),t.children!==void 0?d.default=t.children:d.default||(d.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(c=>{let r=c.getAttribute("data-comp");if(!r)return;let l=X(+r);l&&(c.setAttribute("data-ref",r),d[r]||(l._fromSlotHydration=!0,d[r]=l({...l._prevProps,...c.dataset}),l._fromSlotHydration=!1))}),Object.entries(d).forEach(([c,r])=>{let l;if(c==="default"||c==="children"?l=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):l=j(e.el,c),!l||r==null)return;let y=l.querySelector("[data-comp-root='"+e._id+"']");!y&&r&&typeof r.mount=="function"&&(y=document.createElement("div"),y.setAttribute("data-comp-root",e._id),l.innerHTML="",l.appendChild(y));let _=y||l;r._id&&(r._fromSlotHydration=!0),V(_,r,i),r._id&&(r._fromSlotHydration=!1)})}function D(e,t){if(!t)return;t.querySelectorAll("*").forEach(n=>{Array.from(n.attributes).forEach(s=>{if(!s.name.startsWith("data-action-"))return;let d=s.name.slice(12),f=s.value;if(!f)return;let c=`${d}:${f}`;if(typeof e.on[c]!="function"){if(typeof e.on[f]=="function"){e.on[c]=e.on[f].bind(e);return}typeof e[f]=="function"&&(e.on[c]=e[f].bind(e))}})})}function $(e,t,i=!0,n){for(let s of e)try{s.call(n,t)}catch(d){console.error(d)}i&&(e.length=0)}function q(e,t,i){if(Array.isArray(e)){let s=function(){if(n<e.length){let d=e[n++];try{d.length?d.call(i,s):Promise.resolve(d.call(i)).then(s).catch(f=>{console.error(f),s()})}catch(f){console.error(f),s()}}else t()},n=0;s()}else if(e)try{e.length?e.call(i,t):Promise.resolve(e.call(i)).then(t).catch(n=>{console.error(n),t()})}catch(n){console.error(n),t()}else t()}function Z(e,t){for(let i of Object.keys(e))i in t||Object.defineProperty(t,i,{get(){return e[i]},enumerable:!0})}function te(e,t,i=n=>n.id??n.key??n){return e.map((n,s)=>{let d=i(n,s),f=t(n,s);return typeof f=="string"?f.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(d).replace(/"/g,"&quot;")}"`):f}).join("")}var ne=1,Ie="1.10.0",K=new Map;function re(e){e._id&&K.set(e._id,e)}function oe(e){e._id&&K.delete(e._id)}function X(e){return K.get(e)}var T=null;function ie(e,t={}){let i=e._frozenTemplate,n=se(i.renderFn,i.options);return n._initialProps=t,n._templateSource=e,n}function se(e,t={}){let i,n={},s=typeof e;s==="object"&&s!=="function"&&e!==null&&!Array.isArray(e)?(i=e.render,n={...e},delete n.render):(i=e,n=t||{});let{state:d={},on:f={},slots:c={},onMount:r,onUnmount:l,onBeforeMount:y,onBeforeUnmount:_,onUpdate:k,...H}=n,m=null,v=!1,p={},x={},w=null,A=!1,b=[],M=d,E=null,S=!1,B={...d},I=!1,P=o=>{M=typeof o=="function"?o(M):{...M,...o},I||(I=!0,w={...p},queueMicrotask(()=>{I=!1,u(w),w=null}))},a={refs:{},on:function(o,h){if(o&&h){let g=`h${u._renderIndex++}`;return u.addEvent(`${o} [data-ref=${g}]`,h),`data-ref="${g}"`}},setState:P,props:p,_childCallCache:{},_childCallIndex:0,isMounted:()=>v,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],onMount(o){typeof o=="function"&&this._mountCbs.push(o)},onUnmount(o){typeof o=="function"&&this._unmountCbs.push(o)},onBeforeMount(o){typeof o=="function"&&this._beforeMountCbs.push(o)},onBeforeUnmount(o){typeof o=="function"&&this._beforeUnmountCbs.push(o)},onUpdate(o){typeof o=="function"&&this._updateCbs.push(o)},addEvent(o,h){a.on[o]||(a.on[o]=h)},mount(o,h={}){if(v||A)return;let g=typeof o=="string"?document.querySelector(o):o;if(!g)throw new Error(`No element matches: ${o}`);let C=()=>{A=!0,m=g,m.setAttribute("data-comp-root",u._id+"-"+(i.name||"")),p={...p,...h},x={...p},a.props=p,m._componentInstance=u,p.key&&m.setAttribute("data-key",p.key),u(p),S||(v=!0,$(a._mountCbs,void 0,!1,u))};q(a._beforeMountCbs,C,u)},update(o={}){if(!v)return;let h=o.props?o.props:o,g=h.on;g&&Object.assign(a.on,g);let C={...p,...h};x={...p},p=C,a.props=p,p.key!==x.key&&m.setAttribute("data-key",p.key),u(p)},render(o={}){p={...p,...o},a.props=p;let h=typeof i=="function"?i.call(a,{state:M,setState:P,props:p,refs:a.refs}):i;return h&&(h=new String(h),h._id=u._id),Z(a,u),h},_resetInternal:()=>{a._mountedChildren.forEach(o=>{o&&typeof o.unmount=="function"&&o.unmount()}),a._mountedChildren=[],E=null,S=!1,m=null,v=!1,A=!1,b=[],p={},x={},M={...B}},unmount(){if(!v||!m)return;let o=()=>{m.firstChild&&(E=m.firstChild.cloneNode(!0),m.removeChild(m.firstChild)),$(a._unmountCbs,void 0,!0,u),b.forEach(({node:h,type:g,listener:C})=>{h.removeEventListener(g,C)}),b=[],v=!1,A=!1,S=!0,oe(u),a._resetInternal&&a._resetInternal()};q(a._beforeUnmountCbs,o,a)},get renderFn(){return i},get el(){return m},get state(){return M}};r&&a.onMount(r),l&&a.onUnmount(l),y&&a.onBeforeMount(y),_&&a.onBeforeUnmount(_),k&&a.onUpdate(k),Object.assign(a.on,f),a.ref=function(o){return j(this.el,o)},a.refs=new Proxy({},{get(o,h){return a.ref(h)}});function N(o){p={...a.props,...o},a.props=p,!m||m.isConnected;let h=a.render(p);if(h===null||h===""){!S&&m&&m.firstChild?(E=m.firstChild.cloneNode(!0),q(a._beforeUnmountCbs,()=>{m.innerHTML="",b.forEach(({node:C,type:G,listener:Q})=>{C.removeEventListener(G,Q)}),b=[],v=!1,S=!0,$(a._unmountCbs,void 0,!0,u)},a)):S=!0;return}if(S&&E){m.appendChild(E),E=null,S=!1,v=!0,W(u,m,u.on,b),$(a._mountCbs,void 0,!1,u);return}return O(m,h),z(u,p,a,c),D(u,m),W(u,m,u.on,b),v&&$(a._updateCbs,x,!1,u),S=!1,h}let L="";function u(o={}){if(!u._fromSlotHydration&&T&&T!==u){let h=T;h._childCallIndex==null&&(h._childCallIndex=0),h._childCallCache||(h._childCallCache={});let g=o.key!=null?o.key:h._childCallIndex++,C=h._childCallCache[g];return!C||C._templateSource!==u?(C=ie(u,o),C._prevProps={...o},C.toString=()=>`<div data-comp="${C._id}"></div>`,h._childCallCache[g]=C):(C._prevProps={...o},C.update(o)),C}return T=u,u._renderIndex=0,u._childCallIndex=0,u._prevProps=o,L=u._render(o),T=null,u}return u.toString=function(){return!L||String(L)===""&&!u.isMounted()&&T!==null&&T._id!==u._id?String(u._id):L?String(L):""},Object.assign(u,a,H),["el","props","state","setState"].forEach(o=>{Object.defineProperty(u,o,{get(){return a[o]},enumerable:!0,configurable:!1})}),u._render=N,u.render=a.render,u._id=ne++,u.getId=()=>u._id,re(u),u._frozenTemplate=Object.freeze({renderFn:i,options:{...n,state:{...B}}}),u}function we(){return T}export{Ie as __VERSION__,se as createComponent,X as getComponentById,K as globalComponentRegistry,re as registerComponent,te as renderList,oe as unregisterComponent,we as useCurrentComponent};
//# sourceMappingURL=magnumjs-micro-ui.esm.js.map
