/*!
 * @magnumjs/micro-ui v1.1.2
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function V(e,t){if(!e)return!1;let o=document.createElement("div");if(o.innerHTML=t,o.children.length===0&&o.textContent)return e.textContent=o.textContent,!0;let r=Array.from(o.children),i=Array.from(e.children),c=new Map,n=new Map;for(let u of r){let h=u.dataset.key;h&&c.set(h,u)}for(let u of i){let h=u.dataset.key;h&&n.set(h,u)}let a=0;for(let u of r){let h=u.dataset.key,_=e.children[a];if(h&&n.has(h)){let E=n.get(h);J(E,u),E!==_&&e.insertBefore(E,_||null),n.delete(h)}else e.insertBefore(u,_||null);a++}for(let u of n.values())u.remove();for(;e.children.length>r.length;)e.lastChild.remove();return!0}function J(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}R(e,t),Y(e,t)}function R(e,t){let o=e.attributes,r=t.attributes;for(let{name:i}of Array.from(o))t.hasAttribute(i)||e.removeAttribute(i);for(let{name:i,value:c}of Array.from(r))e.getAttribute(i)!==c&&e.setAttribute(i,c)}function Y(e,t){let o=Array.from(e.childNodes),r=Array.from(t.childNodes),i=Math.max(o.length,r.length);for(let c=0;c<i;c++){let n=o[c],a=r[c];if(!a&&n){e.removeChild(n);continue}if(!n&&a){e.appendChild(a.cloneNode(!0));continue}ee(n,a)}}function ee(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?J(e,t):e.replaceWith(t.cloneNode(!0))}}function H(e,t,o,r){if(!t||!o)return;let i=t.firstElementChild;if(!i)return;function c(n,a=!1){if(n&&!(!a&&n.hasAttribute&&n.hasAttribute("data-comp-root"))){Object.entries(o).forEach(([u,h])=>{let _=u.includes(":"),[E,L]=_?u.split(":"):u.split(" "),p=E==="*";(p?["click","input","change","keydown","submit"]:[E]).forEach(d=>{let T=w=>{let A=w.target.closest("[data-action]"),M=A?.dataset.action||"",S=A?.dataset.args,C=M.split(":"),B=C[0],j=[];if(S)try{let b=JSON.parse(S);j=Array.isArray(b)?b:[b]}catch{console.warn("Invalid JSON in data-args:",S)}else j=C.slice(1);let x={event:w,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:B,args:j};if(_&&A&&(L==="*"||L===B)&&(p||w.type===E))return h.call(e,x);if(!_){let b=w.target.closest(L||"*");if(b&&i.contains(b))return h.call(e,x)}},$=`__microBound_${d}_${u}`;i[$]||(i.addEventListener(d,T),i[$]=!0,r.push({node:i,type:d,listener:T}))})});for(let u of n.children)c(u,!1)}}c(t,!0)}function k(){let e=new Map;return{subscribe(t,o){e.has(t)||e.set(t,new Set);let r=e.get(t);return r.add(o),()=>r.delete(o)},emit(t,o){let r=e.get(t);if(r)for(let i of r)i(o)},clear(){e.clear()}}}function te(e){let t=e,o=new Set;function r(n){typeof t=="object"&&t!==null&&typeof n=="object"&&n!==null&&!Array.isArray(t)&&!Array.isArray(n)?t={...t,...n}:t=typeof n=="function"?n(t):n,o.forEach(a=>a(t))}function i(n){return o.add(n),n(t),()=>o.delete(n)}function c(){return t}return{get:c,setState:r,getState:c,subscribe:i}}var O=k(),P=new Map;function ne(e,t={}){if(!P.has(e)){let o=te(t),r={...o,emit(i,c){o.setState(c),O.emit(`${e}::${i}`,o.getState())},on(i,c){return O.subscribe(`${e}::${i}`,c)}};P.set(e,r)}return P.get(e)}ne.clear=()=>P.clear();var K=new WeakMap;function W(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let o=K.get(e);if(o||(o={},K.set(e,o)),o[t]){let c=o[t];if(c.isConnected&&e.contains(c))return c;delete o[t]}let r=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function i(c,n){if(c===n)return!0;let a=c.closest("[data-comp-root]");return!a||a===n}for(let c of r){let n=null;try{let a=e.querySelectorAll(c);for(let u of a)if(i(u,e)){n=u;break}}catch{throw new Error(`ref() invalid selector: '${c}' for ref name '${t}'`)}if(n)return o[t]=n,n}return null}var I=new WeakMap;function D(e,t,o){if(!e||t===null||I.has(e)&&I.get(e).value===t)return;let r=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&r&&typeof r=="object"&&"default"in r&&(r=r.default),Array.isArray(r)){let i=document.createDocumentFragment();r.forEach(c=>{let n=typeof c=="function"?c():c;if(n&&typeof n.mount=="function"){let a=document.createElement("div");if(n.isMounted())n.update(),n.el instanceof HTMLElement&&i.appendChild(n.el);else for(n.mount(a),o._mountedChildren.includes(n)||o._mountedChildren.push(n);a.firstChild;)i.appendChild(a.firstChild)}else if(n?.el instanceof HTMLElement)i.appendChild(n.el);else if(n instanceof Node)i.appendChild(n);else if(typeof n=="string"){let a=document.createElement("div");for(a.innerHTML=n;a.firstChild;)i.appendChild(a.firstChild)}}),e.replaceWith(i),I.set(e,{value:t});return}if(r&&typeof r.mount=="function"){if(r.isMounted())r.update(),r.el!==e&&e.replaceWith(r.el);else{let i=document.createElement("div");e.replaceWith(i),r.mount(i),r.el===e&&(r.el=i)}o._mountedChildren.includes(r)||o._mountedChildren.push(r)}else if(r?.el instanceof HTMLElement)e.replaceWith(r.el);else if(r instanceof Node)e.replaceWith(r);else if(typeof r=="string"){let i=document.createElement("div");i.innerHTML=r;let c=document.createDocumentFragment();for(;i.firstChild;)c.appendChild(i.firstChild);e.replaceWith(c)}else e.replaceWith(document.createTextNode(""));I.set(e,{value:t})}function N(e,t,o,r){let c={...typeof r=="function"?r.call(o,t):typeof r=="object"?r:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(c={default:t.slots}),t.children!==void 0?c.default=t.children:c.default||(c.default=null),Object.entries(c).forEach(([n,a])=>{let u;if(n==="default"||n==="children"?u=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):u=W(e.el,n),!u||a==null)return;let h=u.querySelector("[data-comp-root='"+e._id+"']");!h&&a&&typeof a.mount=="function"&&(h=document.createElement("div"),h.setAttribute("data-comp-root",e._id),u.innerHTML="",u.appendChild(h)),D(h||u,a,o)})}var re=1,be="1.1.2";function oe(e,t){for(let o of Object.keys(e))o in t||Object.defineProperty(t,o,{get(){return e[o]},enumerable:!0})}var F=null;function ge(e,t={}){let o,r={},i=typeof e;i==="object"&&i!=="funcion"&&e!==null&&!Array.isArray(e)?(o=e.render,r={...e},delete r.render):(o=e,r=t||{});let{state:c={},on:n={},slots:a={},onMount:u,onUnmount:h,onBeforeMount:_,onBeforeUnmount:E,onUpdate:L}=r,p=null,g=!1,d={},T={},$=null,w=!1,A=[],M=c,S=null,C=!1,B={...c},j=!1,x=[],b=k(),G=s=>{M=typeof s=="function"?s(M):{...M,...s},j||(j=!0,$={...d},queueMicrotask(()=>{j=!1,m($),$=null}))},f={refs:{},setState:G,props:d,isMounted:()=>g,_mountedChildren:[],_unmountCbs:[],onUnmount(s){typeof s=="function"&&this._unmountCbs.push(s)},emit(s,l){b.emit(s,l)},onEmit(s,l){let y=b.subscribe(s,l);return this.onUnmount(y),y},emitGlobal(s,l){O.emit(s,l)},onEmitGlobal(s,l){let y=O.subscribe(s,l);return this.onUnmount(y),y},mount(s,l={}){if(g||w)return;let y=typeof s=="string"?document.querySelector(s):s;if(!y)throw new Error(`No element matches: ${s}`);q(_,()=>{w=!0,p=y,p.setAttribute("data-comp-root",m._id+"-"+(m.name||o.name||"")),d={...d,...l},T={...d},f.props=d,m(d),C||(g=!0,u?.call(m),z())})},update(s={}){if(!g)return;let l=s.props?s.props:s,y=l.on;y&&y!==n&&(n=y);let v={...d,...l};T={...d},d=v,f.props=d,m(d)},render(s={}){d={...d,...s},f.props=d;let l=typeof o=="function"?o.call(f,{state:M,setState:G,props:d,refs:f.refs}):o;return l&&(l=new String(l),l._id=m._id),oe(f,m),l},_resetInternal:()=>{f._mountedChildren.forEach(s=>{s&&typeof s.unmount=="function"&&s.unmount()}),f._mountedChildren=[],S=null,C=!1,p=null,g=!1,w=!1,A=[],d={},T={},M={...B}},unmount(){if(!g||!p)return;q(E,()=>{p.firstChild&&(S=p.firstChild.cloneNode(!0),p.removeChild(p.firstChild));for(let l of this._unmountCbs)try{l()}catch(y){console.error(y)}this._unmountCbs=[],b.clear(),A.forEach(({node:l,type:y,listener:v})=>{l.removeEventListener(y,v)}),A=[],x.forEach(l=>l()),x=[],g=!1,w=!1,C=!0,h?.call(f),f._resetInternal&&f._resetInternal()})},get renderFn(){return o},get el(){return p},get state(){return M}};f.ref=function(s){return W(this.el,s)},f.refs=new Proxy({},{get(s,l){return f.ref(l)}}),f.action=function(s){return s.target.closest("[data-action]")?.dataset.action||null};function z(){x=[],Object.entries(n).forEach(([s,l])=>{if(s.includes("::")){let y=l.bind(f),v=O.subscribe(s,y);x.push(v)}})}function X(s){d={...f.props,...s},f.props=d,!p||p.isConnected;let l=f.render(d);if(l===null||l===""){!C&&p&&p.firstChild?(S=p.firstChild.cloneNode(!0),q(E,()=>{p.innerHTML="",A.forEach(({node:v,type:Z,listener:Q})=>{v.removeEventListener(Z,Q)}),A=[],g=!1,C=!0,h?.call(f)})):C=!0;return}if(C&&S){p.appendChild(S),S=null,C=!1,g=!0,H(f,p,n,A),u?.call(f);return}return V(p,l),N(m,d,f,a),H(f,p,n,A),g&&L&&L.call(f,T),C=!1,l}function q(s,l){s?s.length?s.call(f,l):Promise.resolve(s.call(f)).then(l):l()}let U="";function m(s={}){return F=m,U=m._render(s),F=null,m}return m.toString=function(){return U?String(U):""},Object.assign(m,f),["el","props","state","setState"].forEach(s=>{Object.defineProperty(m,s,{get(){return f[s]},enumerable:!0,configurable:!1})}),m._render=X,m.render=f.render,m._id=re++,m}function Ae(e,t,o=r=>r.id??r.key??r){return e.map((r,i)=>{let c=o(r,i),n=t(r,i);return typeof n=="string"?n.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(c).replace(/"/g,"&quot;")}"`):n}).join("")}function _e(){return F}export{be as __VERSION__,ge as createComponent,Ae as renderList,_e as useCurrentComponent};
//# sourceMappingURL=magnumjs-micro-ui.esm.js.map
