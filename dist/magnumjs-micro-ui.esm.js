/*!
 * @magnumjs/micro-ui v1.9.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function D(e,t){if(!e)return!1;let o=document.createElement("div");if(o.innerHTML=t,o.children.length===0&&e.children.length===0&&o.textContent)return e.textContent!==o.textContent&&(e.textContent=o.textContent),!0;let n=Array.from(o.children),s=Array.from(e.children),u=new Map,c=new Map;for(let i of n){let l=i.dataset.key;l&&u.set(l,i)}for(let i of s){let l=i.dataset.key;l&&c.set(l,i)}let a=0;for(let i of n){let l=i.dataset.key,b=e.children[a];if(l&&c.has(l)){let _=c.get(l);_.hasAttribute("data-comp-root")||Z(_,i),_!==b&&e.insertBefore(_,b||null),c.delete(l)}else e.insertBefore(i,b||null);a++}for(let i of c.values())i.hasAttribute("data-comp-root")||i.remove();for(;e.children.length>n.length;){let i=e.lastChild;if(i?.hasAttribute?.("data-comp-root"))break;i.remove()}return!0}function Z(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}oe(e,t),!e.hasAttribute("data-comp-root")&&ie(e,t)}function oe(e,t){let o=e.attributes,n=t.attributes;for(let{name:s}of Array.from(o))t.hasAttribute(s)||e.removeAttribute(s);for(let{name:s,value:u}of Array.from(n))e.getAttribute(s)!==u&&e.setAttribute(s,u)}function ie(e,t){let o=Array.from(e.childNodes),n=Array.from(t.childNodes),s=Math.max(o.length,n.length);for(let u=0;u<s;u++){let c=o[u],a=n[u];if(!a&&c){if(c.nodeType===1&&c.hasAttribute("data-comp-root"))continue;e.removeChild(c);continue}if(!c&&a){e.appendChild(a.cloneNode(!0));continue}se(c,a)}}function se(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?Z(e,t):e.replaceWith(t.cloneNode(!0))}}function O(e,t,o,n){if(!t||!t.children[0]||!o)return;let s=t.children.length>1?t:t.children[0];function u(a,i){for(let l=a;l&&l!==i.parentNode;l=l.parentElement)if(!(!l||!l.hasAttributes||!l.hasAttributes())){for(let b of l.attributes)if(b.name==="data-action"||b.name.startsWith("data-action-"))return l}return null}function c(a,i=!1){if(a&&!(!i&&a.hasAttribute&&a.hasAttribute("data-comp-root"))){Object.entries(o).forEach(([l,b])=>{let _=l.includes(":"),[$,L]=_?l.split(":"):l.split(" "),m=$==="*";(m?["click","input","change","keydown","submit"]:[$]).forEach(h=>{let T=S=>{let g=u(S.target,s),v="",x="";if(g){let A=`data-action-${S.type}`,q=`data-args-${S.type}`;v=g.getAttribute(A)??g.getAttribute("data-action")??"",x=g.getAttribute(q)??g.getAttribute("data-args")??""}let E=v.split(":"),P=E[0],I=[];if(x)try{let A=JSON.parse(x);I=Array.isArray(A)?A:[A]}catch{console.warn("Invalid JSON in data-args:",x)}else I=E.slice(1);let H={...S.target.dataset,event:S,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:P,args:I};if(_&&g&&(L==="*"||L===P)&&(m||S.type===$))return b.call(e,H);if(!_){let A=S.target.closest(L||"*");return A&&s.contains(A)?b.call(e,H):void 0}},B=`__microBound_${h}_${l}`;s[B]||(s.addEventListener(h,T),s[B]=!0,n.push({node:s,type:h,listener:T}))})});for(let l of a.children)c(l,!1)}}c(t,!0)}function G(){let e=new Map;return{subscribe(t,o){e.has(t)||e.set(t,new Set);let n=e.get(t);return n.add(o),()=>n.delete(o)},emit(t,o){let n=e.get(t);if(n)for(let s of n)s(o)},clear(){e.clear()}}}function ce(e){let t=e,o=new Set;function n(c){typeof t=="object"&&t!==null&&typeof c=="object"&&c!==null&&!Array.isArray(t)&&!Array.isArray(c)?t={...t,...c}:t=typeof c=="function"?c(t):c,o.forEach(a=>a(t))}function s(c){return o.add(c),c(t),()=>o.delete(c)}function u(){return t}return{get:u,setState:n,getState:u,subscribe:s}}var U=G(),N=new Map;function le(e,t={}){if(!N.has(e)){let o=ce(t),n={...o,emit(s,u){o.setState(u),U.emit(`${e}::${s}`,o.getState())},on(s,u){return U.subscribe(`${e}::${s}`,u)}};N.set(e,n)}return N.get(e)}le.clear=()=>N.clear();var Q=new WeakMap;function W(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let o=Q.get(e);if(o||(o={},Q.set(e,o)),o[t]){let c=o[t];if(c.isConnected&&e.contains(c))return c;delete o[t]}let n=e.querySelector(`[data-key="${t}"]`);if(n&&n._componentInstance)return o[t]=n._componentInstance,n._componentInstance;let s=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function u(c,a){if(c===a)return!0;let i=c.closest("[data-comp-root]");return!i||i===a}for(let c of s){let a=null;try{let i=e.querySelectorAll(c);for(let l of i)if(u(l,e)){a=l;break}}catch{throw new Error(`ref() invalid selector: '${c}' for ref name '${t}'`)}if(a)return o[t]=a,a}return null}var V=new WeakMap;function K(e,t,o){if(!e||t===null||V.has(e)&&V.get(e).value===t)return;let n=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&n&&typeof n=="object"&&"default"in n&&(n=n.default),Array.isArray(n)){let s=e.parentNode;if(!s)return;let u={};Array.from(s.children).forEach(a=>{let i=a.getAttribute&&a.getAttribute("data-key");i!=null&&(u[i]=a)});let c=[];n.forEach(a=>{let i=typeof a=="function"?a():a,l=null,b=i?.props?.key??(i?.el?.getAttribute&&i.el.getAttribute("data-key"));if(b!=null&&u[b])l=u[b],i&&typeof i.update=="function"&&i.update();else if(i&&typeof i.mount=="function"){let _=document.createElement("div");i.mount(_),l=i.el instanceof HTMLElement?i.el:_,o._mountedChildren.includes(i)||o._mountedChildren.push(i)}else if(i?.el instanceof HTMLElement)l=i.el;else if(i instanceof Node)l=i;else if(typeof i=="string"){let _=document.createElement("div");_.innerHTML=i,l=_.firstChild}l&&c.push(l)}),s.contains(e)&&s.removeChild(e),c.forEach((a,i)=>{s.children[i]!==a&&s.insertBefore(a,s.children[i]||null)}),Array.from(s.children).forEach(a=>{c.includes(a)||s.removeChild(a)}),V.set(e,{value:t});return}if(n&&typeof n.mount=="function"){if(n.isMounted())n.update(),n.el!==e&&e.replaceWith(n.el);else{let s=document.createElement("div");e.replaceWith(s),n.mount(s),n.el===e&&(n.el=s)}o._mountedChildren.includes(n)||o._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let s=document.createElement("div");s.innerHTML=n;let u=document.createDocumentFragment();for(;s.firstChild;)u.appendChild(s.firstChild);e.replaceWith(u)}else e.replaceWith(document.createTextNode(""));V.set(e,{value:t})}function F(e,t,o,n){let u={...typeof n=="function"?n.call(o,t):typeof n=="object"?n:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(u={default:t.slots}),t.children!==void 0?u.default=t.children:u.default||(u.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(a=>{let i=a.getAttribute("data-comp");if(!i)return;let l=R(+i);l&&(a.setAttribute("data-ref",i),u[i]||(l._fromSlotHydration=!0,u[i]=l({...l._prevProps,...a.dataset}),l._fromSlotHydration=!1))}),Object.entries(u).forEach(([a,i])=>{let l;if(a==="default"||a==="children"?l=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):l=W(e.el,a),!l||i==null)return;let b=l.querySelector("[data-comp-root='"+e._id+"']");!b&&i&&typeof i.mount=="function"&&(b=document.createElement("div"),b.setAttribute("data-comp-root",e._id),l.innerHTML="",l.appendChild(b));let _=b||l;i._id&&(i._fromSlotHydration=!0),K(_,i,o),i._id&&(i._fromSlotHydration=!1)})}function J(e,t){if(!t)return;t.querySelectorAll("*").forEach(n=>{Array.from(n.attributes).forEach(s=>{if(!s.name.startsWith("data-action-"))return;let u=s.name.slice(12),c=s.value;if(!c)return;let a=`${u}:${c}`;if(typeof e.on[a]!="function"){if(typeof e.on[c]=="function"){e.on[a]=e.on[c].bind(e);return}typeof e[c]=="function"&&(e.on[a]=e[c].bind(e))}})})}function j(e,t,o=!0,n){for(let s of e)try{s.call(n,t)}catch(u){console.error(u)}o&&(e.length=0)}function z(e,t,o){if(Array.isArray(e)){let s=function(){if(n<e.length){let u=e[n++];try{u.length?u.call(o,s):Promise.resolve(u.call(o)).then(s).catch(c=>{console.error(c),s()})}catch(c){console.error(c),s()}}else t()},n=0;s()}else if(e)try{e.length?e.call(o,t):Promise.resolve(e.call(o)).then(t).catch(n=>{console.error(n),t()})}catch(n){console.error(n),t()}else t()}function Y(e,t){for(let o of Object.keys(e))o in t||Object.defineProperty(t,o,{get(){return e[o]},enumerable:!0})}function ae(e,t,o=n=>n.id??n.key??n){return e.map((n,s)=>{let u=o(n,s),c=t(n,s);return typeof c=="string"?c.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(u).replace(/"/g,"&quot;")}"`):c}).join("")}var ue=1,We="1.9.0",X=new Map;function fe(e){e._id&&X.set(e._id,e)}function de(e){e._id&&X.delete(e._id)}function R(e){return X.get(e)}var w=null;function pe(e,t={}){let o=e._frozenTemplate,n=he(o.renderFn,o.options);return n._initialProps=t,n._templateSource=e,n}function he(e,t={}){let o,n={},s=typeof e;s==="object"&&s!=="function"&&e!==null&&!Array.isArray(e)?(o=e.render,n={...e},delete n.render):(o=e,n=t||{});let{state:u={},on:c={},slots:a={},onMount:i,onUnmount:l,onBeforeMount:b,onBeforeUnmount:_,onUpdate:$,...L}=n,m=null,M=!1,h={},T={},B=null,S=!1,g=[],v=u,x=null,E=!1,P={...u},I=!1,H=[],A=G(),q=r=>{v=typeof r=="function"?r(v):{...v,...r},I||(I=!0,B={...h},queueMicrotask(()=>{I=!1,p(B),B=null}))},f={refs:{},on:function(r,d){if(r&&d){let y=`h${p._renderIndex++}`;return p.addEvent(`${r} [data-ref=${y}]`,d),`data-ref="${y}"`}},setState:q,props:h,_childCallCache:{},_childCallIndex:0,isMounted:()=>M,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],onMount(r){typeof r=="function"&&this._mountCbs.push(r)},onUnmount(r){typeof r=="function"&&this._unmountCbs.push(r)},onBeforeMount(r){typeof r=="function"&&this._beforeMountCbs.push(r)},onBeforeUnmount(r){typeof r=="function"&&this._beforeUnmountCbs.push(r)},onUpdate(r){typeof r=="function"&&this._updateCbs.push(r)},emit(r,d){A.emit(r,d)},onEmit(r,d){let y=A.subscribe(r,d);return this.onUnmount(y),y},emitGlobal(r,d){U.emit(r,d)},onEmitGlobal(r,d){let y=U.subscribe(r,d);return this.onUnmount(y),y},addEvent(r,d){f.on[r]||(f.on[r]=d)},mount(r,d={}){if(M||S)return;let y=typeof r=="string"?document.querySelector(r):r;if(!y)throw new Error(`No element matches: ${r}`);let C=()=>{S=!0,m=y,m.setAttribute("data-comp-root",p._id+"-"+(o.name||"")),h={...h,...d},T={...h},f.props=h,m._componentInstance=p,h.key&&m.setAttribute("data-key",h.key),p(h),E||(M=!0,j(f._mountCbs,void 0,!1,p),ee())};z(f._beforeMountCbs,C,p)},update(r={}){if(!M)return;let d=r.props?r.props:r,y=d.on;y&&Object.assign(f.on,y);let C={...h,...d};T={...h},h=C,f.props=h,h.key!==T.key&&m.setAttribute("data-key",h.key),p(h)},render(r={}){h={...h,...r},f.props=h;let d=typeof o=="function"?o.call(f,{state:v,setState:q,props:h,refs:f.refs}):o;return d&&(d=new String(d),d._id=p._id),Y(f,p),d},_resetInternal:()=>{f._mountedChildren.forEach(r=>{r&&typeof r.unmount=="function"&&r.unmount()}),f._mountedChildren=[],x=null,E=!1,m=null,M=!1,S=!1,g=[],h={},T={},v={...P}},unmount(){if(!M||!m)return;let r=()=>{m.firstChild&&(x=m.firstChild.cloneNode(!0),m.removeChild(m.firstChild)),j(f._unmountCbs,void 0,!0,p),A.clear(),g.forEach(({node:d,type:y,listener:C})=>{d.removeEventListener(y,C)}),g=[],H.forEach(d=>d()),H=[],M=!1,S=!1,E=!0,de(p),f._resetInternal&&f._resetInternal()};z(f._beforeUnmountCbs,r,f)},get renderFn(){return o},get el(){return m},get state(){return v}};i&&f.onMount(i),l&&f.onUnmount(l),b&&f.onBeforeMount(b),_&&f.onBeforeUnmount(_),$&&f.onUpdate($),Object.assign(f.on,c),f.ref=function(r){return W(this.el,r)},f.refs=new Proxy({},{get(r,d){return f.ref(d)}});function ee(){H=[],Object.entries(f.on).forEach(([r,d])=>{r.includes("::")?p.onEmitGlobal(r,d.bind(f)):!r.includes(" ")&&!r.includes("*")&&!r.includes(":")&&p.onEmit(r,d.bind(f))})}function te(r){h={...f.props,...r},f.props=h,!m||m.isConnected;let d=f.render(h);if(d===null||d===""){!E&&m&&m.firstChild?(x=m.firstChild.cloneNode(!0),z(f._beforeUnmountCbs,()=>{m.innerHTML="",g.forEach(({node:C,type:ne,listener:re})=>{C.removeEventListener(ne,re)}),g=[],M=!1,E=!0,j(f._unmountCbs,void 0,!0,p)},f)):E=!0;return}if(E&&x){m.appendChild(x),x=null,E=!1,M=!0,O(f,m,f.on,g),j(f._mountCbs,void 0,!1,p);return}return D(m,d),F(p,h,f,a),J(p,m),O(f,m,f.on,g),M&&j(f._updateCbs,T,!1,p),E=!1,d}let k="";function p(r={}){if(!p._fromSlotHydration&&w&&w!==p){let d=w;d._childCallIndex==null&&(d._childCallIndex=0),d._childCallCache||(d._childCallCache={});let y=r.key!=null?r.key:d._childCallIndex++,C=d._childCallCache[y];return!C||C._templateSource!==p?(C=pe(p,r),C._prevProps={...r},C.toString=()=>`<div data-comp="${C._id}"></div>`,d._childCallCache[y]=C):(C._prevProps={...r},C.update(r)),C}return w=p,p._renderIndex=0,p._childCallIndex=0,p._prevProps=r,k=p._render(r),w=null,p}return p.toString=function(){return!k||String(k)===""&&!p.isMounted()&&w!==null&&w._id!==p._id?String(p._id):k?String(k):""},Object.assign(p,f,L),["el","props","state","setState"].forEach(r=>{Object.defineProperty(p,r,{get(){return f[r]},enumerable:!0,configurable:!1})}),p._render=te,p.render=f.render,p._id=ue++,p.getId=()=>p._id,fe(p),p._frozenTemplate=Object.freeze({renderFn:o,options:{...n,state:{...P}}}),p}function Oe(){return w}export{We as __VERSION__,he as createComponent,R as getComponentById,X as globalComponentRegistry,fe as registerComponent,ae as renderList,de as unregisterComponent,Oe as useCurrentComponent};
//# sourceMappingURL=magnumjs-micro-ui.esm.js.map
