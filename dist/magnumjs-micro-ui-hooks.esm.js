/*!
 * @magnumjs/micro-ui v1.10.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var m=null;function u(){return m}function E(n,t={}){let e=u();if(!e)throw new Error("useFetch must be called inside a component render or lifecycle");(!e.state||e.state.data===void 0&&e.state.loading===void 0&&e.state.error===void 0)&&e.setState({data:null,loading:!0,error:null});async function o(){e.setState(r=>({...r,loading:!0}));try{let s=await(await fetch(n,t)).json();e.setState({data:s,error:null,loading:!1}),e.emit&&e.emit("fetch::done",{url:n,data:s})}catch(r){e.setState({data:null,error:r,loading:!1}),e.emit&&e.emit("fetch::error",{url:n,error:r})}}return e.onMount(o),e.onEmit&&e.onEmit("fetch::refresh",o),{get:()=>({...e.state}),subscribe:r=>(e.onUpdate(()=>r({...e.state})),()=>{}),refresh:o}}var c={};function x(n,t={}){let e=u();if(!e)throw new Error("useContext() must be inside render()");c[n]||(c[n]={value:t,subs:new Set});let o=c[n];o.subs.add(e),e.onUnmount(()=>o.subs.delete(e));let r=s=>{o.value=typeof s=="function"?s(o.value):s,o.subs.forEach(i=>i.update())};return[o.value,r]}function U(n){let t=u();if(!t)throw new Error("useState must be inside render()");t._hasStateSetters||(t.state&&Object.keys(t.state).forEach(r=>{let s="set"+r.charAt(0).toUpperCase()+r.slice(1);t[s]||(t[s]=i=>{let f=t.state[r],p=typeof i=="function"?i(f):i;p!==f&&(t.state[r]=p,t.update())})}),t._hasStateSetters=!0);let e=t._renderIndex++;t._hooks||(t._hooks=[]),t._hooks[e]===void 0&&(t._hooks[e]=typeof n=="function"?n():n);let o=r=>{let s=t._hooks[e],i=typeof r=="function"?r(s):r;i!==s&&(t._hooks[e]=i,t.update())};return[t._hooks[e],o]}function A(n,t=[]){let e=u();if(!e)throw new Error("useEffect must be inside render()");let o=e._renderIndex++;e._hooks=e._hooks||[];let r=e._hooks[o]||[];if(t.length===0||t.some((i,f)=>i!==r[f])){let i;e.onUnmount(()=>i&&i()),i=n(),e._hooks[o]=t}}function d(){let n=new Map;return{subscribe(t,e){n.has(t)||n.set(t,new Set);let o=n.get(t);return o.add(e),()=>o.delete(e)},emit(t,e){let o=n.get(t);if(o)for(let r of o)r(e)},clear(){n.clear()}}}function h(n){let t=n,e=new Set;function o(i){typeof t=="object"&&t!==null&&typeof i=="object"&&i!==null&&!Array.isArray(t)&&!Array.isArray(i)?t={...t,...i}:t=typeof i=="function"?i(t):i,e.forEach(f=>f(t))}function r(i){return e.add(i),i(t),()=>e.delete(i)}function s(){return t}return{get:s,setState:o,getState:s,subscribe:r}}var l=d(),a=new Map;function _(n,t={}){if(!a.has(n)){let e=h(t),o={...e,emit(r,s){e.setState(s),l.emit(`${n}::${r}`,e.getState())},on(r,s){return l.subscribe(`${n}::${r}`,s)}};a.set(n,o)}return a.get(n)}_.clear=()=>a.clear();function $(){let n=u();if(!n)throw new Error("useEmits must be inside render()");if(n._hasEmits)return n._emitsApi;n._hasEmits=!0;let t=d(),e={emit:(o,r)=>t.emit(o,r),onEmit:(o,r)=>{let s=t.subscribe(o,r);return n.onUnmount(s),s},emitGlobal:(o,r)=>l.emit(o,r),onEmitGlobal:(o,r)=>{let s=l.subscribe(o,r);return n.onUnmount(s),s}};return Object.assign(n,e),n._emitsApi=e,b(n,n.on),n.onUnmount(()=>{t.clear()}),e}function b(n,t={}){let e=[];console.log("Context listeners registered:",Object.entries(t)),Object.entries(t).forEach(([o,r])=>{if(console.log(KeyboardEvent,r),o.includes("::")){let s=r.bind(n),i=l.subscribe(o,s);e.push(i)}else!o.includes(" ")&&!o.includes("*")&&!o.includes(":")&&n.onEmit(o,r.bind(n))}),n.onUnmount(()=>{e.forEach(o=>o()),e=[]})}export{x as useContext,A as useEffect,$ as useEmits,E as useFetch,U as useState};
//# sourceMappingURL=magnumjs-micro-ui-hooks.esm.js.map
