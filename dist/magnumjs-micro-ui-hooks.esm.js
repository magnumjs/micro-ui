/*!
 * @magnumjs/micro-ui v1.10.1
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var b=null;function f(){return b}function x(t,n={}){let e=f();if(!e)throw new Error("useFetch must be called inside a component render or lifecycle");(!e.state||e.state.data===void 0&&e.state.loading===void 0&&e.state.error===void 0)&&e.setState({data:null,loading:!0,error:null});async function o(){e.setState(r=>({...r,loading:!0}));try{let u=await(await fetch(t,n)).json();e.setState({data:u,error:null,loading:!1}),e.emit&&e.emit("fetch::done",{url:t,data:u})}catch(r){e.setState({data:null,error:r,loading:!1}),e.emit&&e.emit("fetch::error",{url:t,error:r})}}return e.onMount(o),e.onEmit&&e.onEmit("fetch::refresh",o),{get:()=>({...e.state}),subscribe:r=>(e.onUpdate(()=>r({...e.state})),()=>{}),refresh:o}}var d={};function I(t,n={}){let e=f();if(!e)throw new Error("useContext() must be inside render()");d[t]||(d[t]={value:n,subs:new Set});let o=d[t];o.subs.add(e),e.onUnmount(()=>o.subs.delete(e));let r=u=>{o.value=typeof u=="function"?u(o.value):u,o.subs.forEach(s=>s.update())};return[o.value,r]}function M(t){let n=f();if(!n)throw new Error("useState must be inside render()");n._hasStateSetters||(n.state&&Object.keys(n.state).forEach(r=>{let u="set"+r.charAt(0).toUpperCase()+r.slice(1);n[u]||(n[u]=s=>{let i=n.state[r],a=typeof s=="function"?s(i):s;a!==i&&(n.state[r]=a,n.update())})}),n._hasStateSetters=!0);let e=n._renderIndex++;n._hooks||(n._hooks=[]),n._hooks[e]===void 0&&(n._hooks[e]=typeof t=="function"?t():t);let o=r=>{let u=n._hooks[e],s=typeof r=="function"?r(u):r;s!==u&&(n._hooks[e]=s,n.update())};return[n._hooks[e],o]}function B(t,n=[]){let e=f();if(!e)throw new Error("useEffect must be inside render()");let o=e._renderIndex++;e._hooks=e._hooks||[];let r=e._hooks[o]||[];if(n.length===0||n.some((s,i)=>s!==r[i])){let s;e.onUnmount(()=>s&&s()),s=t(),e._hooks[o]=n}}function p(){let t=new Map;return{subscribe(n,e){t.has(n)||t.set(n,new Set);let o=t.get(n);return o.add(e),()=>o.delete(e)},emit(n,e){let o=t.get(n);if(o)for(let r of o)r(e)},clear(){t.clear()}}}function C(t){let n=t,e=new Set;function o(s){typeof n=="object"&&n!==null&&typeof s=="object"&&s!==null&&!Array.isArray(n)&&!Array.isArray(s)?n={...n,...s}:n=typeof s=="function"?s(n):s,e.forEach(i=>i(n))}function r(s){return e.add(s),s(n),()=>e.delete(s)}function u(){return n}return{get:u,setState:o,getState:u,subscribe:r}}var c=p(),l=new Map;function g(t,n={}){if(!l.has(t)){let e=C(n),o={...e,emit(r,u){e.setState(u),c.emit(`${t}::${r}`,e.getState())},on(r,u){return c.subscribe(`${t}::${r}`,u)}};l.set(t,o)}return l.get(t)}g.clear=()=>l.clear();function F(){let t=f();if(!t)throw new Error("useEmit must be inside render()");if(t._hasEmits)return t._emitsApi;t._hasEmits=!0;let n=p(),e={emit:(o,r)=>n.emit(o,r),onEmit:(o,r)=>{let u=n.subscribe(o,r);return t.onUnmount(u),u},emitGlobal:(o,r)=>c.emit(o,r),onEmitGlobal:(o,r)=>{let u=c.subscribe(o,r);return t.onUnmount(u),u}};return Object.assign(t,e),t._emitsApi=e,t.onBeforeRender(function(){E(t,t.on)}),t.onUnmount(()=>{n.clear()}),e}function E(t,n={}){let e=[];Object.entries(n).forEach(([o,r])=>{if(o.includes("::")){let u=r.bind(t),s=c.subscribe(o,u);e.push(s)}else!o.includes(" ")&&!o.includes("*")&&!o.includes(":")&&t.onEmit(o,r.bind(t))}),t.onUnmount(()=>{e.forEach(o=>o()),e=[]})}function T(){let t=f();if(!t)throw new Error("useEvent must be inside render()");t._eventApi&&t._eventApi;function n(u){let s={on(i,a){return t.addEvent(`${i} [data-ref=${u}]`,a),s},onClick(i){return this.on("click",i)},onBlur(i){return this.on("blur",i)},onInput(i){return this.on("input",i)},onChange(i){return this.on("change",i)},onFocus(i){return this.on("focus",i)},onSubmit(i){return this.on("submit",i)},toString(){return`data-ref="${u}"`}};return s}function e(u){return s=>{let i=`h${t._renderIndex++}`;return t.addEvent(`${u} [data-ref=${i}]`,s),n(i)}}let o={onClick:e("click"),onBlur:e("blur"),onInput:e("input"),onChange:e("change"),onFocus:e("focus"),onSubmit:e("submit"),on:(u,s)=>e(u)(s)},r={...t.on};return t.prototype.on=o.on,Object.assign(t.on,r),t._eventApi=o,o}function z(){let t=f();if(!t)throw new Error("useEvent must be inside render()");if(t._events)return;function n(r){return r.replace(/<([a-zA-Z0-9-]+)([^>]*?)>/gs,(u,s,i)=>{let a=[...i.matchAll(/data-ref="([^"]+)"/g)].map(_=>_[1]);if(a.length<=1)return u;let m=`data-ref="${a.join(" ")}"`,h=i.replace(/\s*data-ref="[^"]*"/g,"");return`<${s} ${m}${h}>`})}t.onBeforeRender(n);let e={...t.on};t.on=function(u,s){u&&s&&t.addEvent(u,s)},Object.assign(t.on,e),t._events=1;function o(r){return u=>{let s=`h${t._renderIndex++}`;return t.addEvent(`${r} [data-ref~=${s}]`,u),`data-ref="${s}"`}}return{onClick:o("click")}}export{I as useContext,B as useEffect,F as useEmit,T as useEvent,z as useEvents,x as useFetch,M as useState};
//# sourceMappingURL=magnumjs-micro-ui-hooks.esm.js.map
