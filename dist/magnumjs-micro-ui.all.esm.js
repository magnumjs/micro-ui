/*!
 * @magnumjs/micro-ui v1.10.1
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function D(e,t){if(!e)return!1;let n=document.createElement("div");if(n.innerHTML=t,n.children.length===0&&e.children.length===0&&n.textContent)return e.textContent!==n.textContent&&(e.textContent=n.textContent),!0;let r=Array.from(n.children),o=Array.from(e.children),i=new Map,s=new Map;for(let u of r){let l=u.dataset.key;l&&i.set(l,u)}for(let u of o){let l=u.dataset.key;l&&s.set(l,u)}let c=0;for(let u of r){let l=u.dataset.key,h=e.children[c];if(l&&s.has(l)){let _=s.get(l);_.hasAttribute("data-comp-root")||X(_,u),_!==h&&e.insertBefore(_,h||null),s.delete(l)}else e.insertBefore(u,h||null);c++}for(let u of s.values())u.hasAttribute("data-comp-root")||u.remove();for(;e.children.length>r.length;){let u=e.lastChild;if(u?.hasAttribute?.("data-comp-root"))break;u.remove()}return!0}function X(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}oe(e,t),!e.hasAttribute("data-comp-root")&&se(e,t)}function oe(e,t){let n=e.attributes,r=t.attributes;for(let{name:o}of Array.from(n))t.hasAttribute(o)||e.removeAttribute(o);for(let{name:o,value:i}of Array.from(r))e.getAttribute(o)!==i&&e.setAttribute(o,i)}function se(e,t){let n=Array.from(e.childNodes),r=Array.from(t.childNodes),o=Math.max(n.length,r.length);for(let i=0;i<o;i++){let s=n[i],c=r[i];if(!c&&s){if(s.nodeType===1&&s.hasAttribute("data-comp-root"))continue;e.removeChild(s);continue}if(!s&&c){e.appendChild(c.cloneNode(!0));continue}ie(s,c)}}function ie(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?X(e,t):e.replaceWith(t.cloneNode(!0))}}function q(e,t,n,r){if(!t||!t.children[0]||!n)return;let o=t.children.length>1?t:t.children[0];function i(c,u){for(let l=c;l&&l!==u.parentNode;l=l.parentElement)if(!(!l||!l.hasAttributes||!l.hasAttributes())){for(let h of l.attributes)if(h.name==="data-action"||h.name.startsWith("data-action-"))return l}return null}function s(c,u=!1){if(c&&!(!u&&c.hasAttribute&&c.hasAttribute("data-comp-root"))){Object.entries(n).forEach(([l,h])=>{let _=l.includes(":"),[B,j]=_?l.split(":"):l.split(" "),O=B==="*";(O?["click","input","change","keydown","submit"]:[B]).forEach(y=>{let p=v=>{let w=i(v.target,o),M="",x="";if(w){let E=`data-action-${v.type}`,d=`data-args-${v.type}`;M=w.getAttribute(E)??w.getAttribute("data-action")??"",x=w.getAttribute(d)??w.getAttribute("data-args")??""}let k=M.split(":"),S=k[0],U=[];if(x)try{let E=JSON.parse(x);U=Array.isArray(E)?E:[E]}catch{console.warn("Invalid JSON in data-args:",x)}else U=k.slice(1);let H={...v.target.dataset,event:v,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:S,args:U};if(_&&w&&(j==="*"||j===S)&&(O||v.type===B))return h.call(e,H);if(!_){let E=v.target.closest(j||"*");return E&&o.contains(E)?h.call(e,H):void 0}},I=`__microBound_${y}_${l}`;o[I]||(o.addEventListener(y,p),o[I]=!0,r.push({node:o,type:y,listener:p}))})});for(let l of c.children)s(l,!1)}}s(t,!0)}var Q=new WeakMap;function W(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let n=Q.get(e);if(n||(n={},Q.set(e,n)),n[t]){let s=n[t];if(s.isConnected&&e.contains(s))return s;delete n[t]}let r=e.querySelector(`[data-key="${t}"]`);if(r&&r._componentInstance)return n[t]=r._componentInstance,r._componentInstance;let o=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function i(s,c){if(s===c)return!0;let u=s.closest("[data-comp-root]");return!u||u===c}for(let s of o){let c=null;try{let u=e.querySelectorAll(s);for(let l of u)if(i(l,e)){c=l;break}}catch{console.warn(`ref() invalid selector: ${s} for ref name ${t}`)}if(c)return n[t]=c,c}return null}var V=new WeakMap;function F(e,t,n){if(!e||t===null||V.has(e)&&V.get(e).value===t)return;let r=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&r&&typeof r=="object"&&"default"in r&&(r=r.default),Array.isArray(r)){let o=e.parentNode;if(!o)return;let i={};Array.from(o.children).forEach(c=>{let u=c.getAttribute&&c.getAttribute("data-key");u!=null&&(i[u]=c)});let s=[];r.forEach(c=>{let u=typeof c=="function"?c():c,l=null,h=u?.props?.key??(u?.el?.getAttribute&&u.el.getAttribute("data-key"));if(h!=null&&i[h])l=i[h],u&&typeof u.update=="function"&&u.update();else if(u&&typeof u.mount=="function"){let _=document.createElement("div");u.mount(_),l=u.el instanceof HTMLElement?u.el:_,n._mountedChildren.includes(u)||n._mountedChildren.push(u)}else if(u?.el instanceof HTMLElement)l=u.el;else if(u instanceof Node)l=u;else if(typeof u=="string"){let _=document.createElement("div");_.innerHTML=u,l=_.firstChild}l&&s.push(l)}),o.contains(e)&&o.removeChild(e),s.forEach((c,u)=>{o.children[u]!==c&&o.insertBefore(c,o.children[u]||null)}),Array.from(o.children).forEach(c=>{s.includes(c)||o.removeChild(c)}),V.set(e,{value:t});return}if(r&&typeof r.mount=="function"){if(r.isMounted())r.update(),r.el!==e&&e.replaceWith(r.el);else{let o=document.createElement("div");e.replaceWith(o),r.mount(o),r.el===e&&(r.el=o)}n._mountedChildren.includes(r)||n._mountedChildren.push(r)}else if(r?.el instanceof HTMLElement)e.replaceWith(r.el);else if(r instanceof Node)e.replaceWith(r);else if(typeof r=="string"){let o=document.createElement("div");o.innerHTML=r;let i=document.createDocumentFragment();for(;o.firstChild;)i.appendChild(o.firstChild);e.replaceWith(i)}else e.replaceWith(document.createTextNode(""));V.set(e,{value:t})}function z(e,t,n,r){let i={...typeof r=="function"?r.call(n,t):typeof r=="object"?r:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(i={default:t.slots}),t.children!==void 0?i.default=t.children:i.default||(i.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(c=>{let u=c.getAttribute("data-comp");if(!u)return;let l=Y(+u);l&&(c.setAttribute("data-ref",u),i[u]||(l._fromSlotHydration=!0,i[u]=l({...l._prevProps,...c.dataset}),l._fromSlotHydration=!1))}),Object.entries(i).forEach(([c,u])=>{let l;if(c==="default"||c==="children"?l=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):l=W(e.el,c),!l||u==null)return;let h=l.querySelector("[data-comp-root='"+e._id+"']");!h&&u&&typeof u.mount=="function"&&(h=document.createElement("div"),h.setAttribute("data-comp-root",e._id),l.innerHTML="",l.appendChild(h));let _=h||l;u._id&&(u._fromSlotHydration=!0),F(_,u,n),u._id&&(u._fromSlotHydration=!1)})}function K(e,t){if(!t)return;t.querySelectorAll("*").forEach(r=>{Array.from(r.attributes).forEach(o=>{if(!o.name.startsWith("data-action-"))return;let i=o.name.slice(12),s=o.value;if(!s)return;let c=`${i}:${s}`;if(typeof e.on[c]!="function"){if(typeof e.on[s]=="function"){e.on[c]=e.on[s].bind(e);return}typeof e[s]=="function"&&(e.on[c]=e[s].bind(e))}})})}function T(e,t,n=!0,r){let o=t;for(let i of e)try{let s=i.call(r,o);s!==void 0&&(o=s)}catch(s){console.error(s)}return n&&(e.length=0),o}function N(e,t,n){if(Array.isArray(e)){let o=function(){if(r<e.length){let i=e[r++];try{i.length?i.call(n,o):Promise.resolve(i.call(n)).then(o).catch(s=>{console.error(s),o()})}catch(s){console.error(s),o()}}else t()},r=0;o()}else if(e)try{e.length?e.call(n,t):Promise.resolve(e.call(n)).then(t).catch(r=>{console.error(r),t()})}catch(r){console.error(r),t()}else t()}function ee(e,t){for(let n of Object.keys(e))n in t||Object.defineProperty(t,n,{get(){return e[n]},enumerable:!0})}var ce=1,He="1.10.1",G=new Map;function ue(e){e._id&&G.set(e._id,e)}function ae(e){e._id&&G.delete(e._id)}function Y(e){return G.get(e)}var $=null;function le(e,t={}){let n=e._frozenTemplate,r=fe(n.renderFn,n.options);return r._initialProps=t,r._templateSource=e,r}function fe(e,t={}){let n,r={},o=typeof e;o==="object"&&o!=="function"&&e!==null&&!Array.isArray(e)?(n=e.render,r={...e},delete r.render):(n=e,r=t||{});let{state:i={},on:s={},slots:c={},onMount:u,onUnmount:l,onBeforeMount:h,onBeforeUnmount:_,onUpdate:B,onBeforeRender:j,...O}=r,b=null,y=!1,p={},I={},v=null,w=!1,M=[],x=i,k=null,S=!1,U={...i},H=!1,E=a=>{x=typeof a=="function"?a(x):{...x,...a},H||(H=!0,v={...p},queueMicrotask(()=>{H=!1,f(v),v=null}))},d={refs:{},on(){},setState:E,props:p,_childCallCache:{},_childCallIndex:0,isMounted:()=>y,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],_beforeRenderCbs:[],onMount(a){typeof a=="function"&&this._mountCbs.push(a)},onUnmount(a){typeof a=="function"&&this._unmountCbs.push(a)},onBeforeMount(a){typeof a=="function"&&this._beforeMountCbs.push(a)},onBeforeUnmount(a){typeof a=="function"&&this._beforeUnmountCbs.push(a)},onUpdate(a){typeof a=="function"&&this._updateCbs.push(a)},onBeforeRender(a){typeof a=="function"&&this._beforeRenderCbs.push(a)},addEvent(a,m){this.on[a]||(this.on[a]=m)},mount(a,m={}){if(y||w)return;let g=typeof a=="string"?document.querySelector(a):a;if(!g)throw new Error(`No element matches: ${a}`);let C=()=>{w=!0,b=g,b.setAttribute("data-comp-root",f._id+"-"+(n.name||"")),p={...p,...m},I={...p},d.props=p,b._componentInstance=f,p.key&&b.setAttribute("data-key",p.key),f(p),S||(y=!0,T(d._mountCbs,void 0,!1,f))};N(d._beforeMountCbs,C,f)},update(a={}){if(!y)return;let m=a.props?a.props:a,g=m.on;g&&Object.assign(d.on,g);let C={...p,...m};I={...p},p=C,d.props=p,p.key!==I.key&&b.setAttribute("data-key",p.key),f(p)},render(a={}){p={...p,...a},d.props=p;let m=typeof n=="function"?n.call(f,{state:x,setState:E,props:p,refs:d.refs}):n,g=T(d._beforeRenderCbs,m,!1,f);return g&&(g=new String(g),g._id=f._id),ee(d,f),g},_resetInternal:()=>{d._mountedChildren.forEach(a=>{a&&typeof a.unmount=="function"&&a.unmount()}),d._mountedChildren=[],k=null,S=!1,b=null,y=!1,w=!1,M=[],p={},I={},x={...U}},unmount(){if(!y||!b)return;let a=()=>{b.firstChild&&(k=b.firstChild.cloneNode(!0),b.removeChild(b.firstChild)),T(d._unmountCbs,void 0,!0,f),M.forEach(({node:m,type:g,listener:C})=>{m.removeEventListener(g,C)}),M=[],y=!1,w=!1,S=!0,ae(f),d._resetInternal&&d._resetInternal()};N(d._beforeUnmountCbs,a,d)},get renderFn(){return n},get el(){return b},get state(){return x}};u&&d.onMount(u),l&&d.onUnmount(l),h&&d.onBeforeMount(h),_&&d.onBeforeUnmount(_),B&&d.onUpdate(B),j&&d.onBeforeRender(j),Object.assign(d.on,s),d.ref=function(a){return W(this.el,a)},d.refs=new Proxy({},{get(a,m){return d.ref(m)}});function te(a){p={...d.props,...a},d.props=p,!b||b.isConnected;let m=d.render(p);if(m===null||m===""){!S&&b&&b.firstChild?(k=b.firstChild.cloneNode(!0),N(d._beforeUnmountCbs,()=>{b.innerHTML="",M.forEach(({node:C,type:ne,listener:re})=>{C.removeEventListener(ne,re)}),M=[],y=!1,S=!0,T(d._unmountCbs,void 0,!0,f)},d)):S=!0;return}if(S&&k){b.appendChild(k),k=null,S=!1,y=!0,q(f,b,f.on,M),T(d._mountCbs,void 0,!1,f);return}return D(b,m),z(f,p,d,c),K(f,b),q(f,b,f.on,M),y&&T(d._updateCbs,I,!1,f),S=!1,m}let L="";function f(a={}){if(!f._fromSlotHydration&&$&&$!==f){let m=$;m._childCallIndex==null&&(m._childCallIndex=0),m._childCallCache||(m._childCallCache={});let g=a.key!=null?a.key:m._childCallIndex++,C=m._childCallCache[g];return!C||C._templateSource!==f?(C=le(f,a),C._prevProps={...a},C.toString=()=>`<div data-comp="${C._id}"></div>`,m._childCallCache[g]=C):(C._prevProps={...a},C.update(a)),C}return $=f,f._renderIndex=0,f._childCallIndex=0,f._prevProps=a,L=f._render(a),$=null,f}return f.toString=function(){return!L||String(L)===""&&!f.isMounted()&&$!==null&&$._id!==f._id?String(f._id):L?String(L):""},Object.assign(f,d,O),["el","props","state","setState"].forEach(a=>{Object.defineProperty(f,a,{get(){return d[a]},enumerable:!0,configurable:!1})}),f._render=te,f.render=d.render,f._id=ce++,f.getId=()=>f._id,ue(f),f._frozenTemplate=Object.freeze({renderFn:n,options:{...r,state:{...U}}}),f}function A(){return $}function We(e,t={}){let n=A();if(!n)throw new Error("useFetch must be called inside a component render or lifecycle");(!n.state||n.state.data===void 0&&n.state.loading===void 0&&n.state.error===void 0)&&n.setState({data:null,loading:!0,error:null});async function r(){n.setState(o=>({...o,loading:!0}));try{let i=await(await fetch(e,t)).json();n.setState({data:i,error:null,loading:!1}),n.emit&&n.emit("fetch::done",{url:e,data:i})}catch(o){n.setState({data:null,error:o,loading:!1}),n.emit&&n.emit("fetch::error",{url:e,error:o})}}return n.onMount(r),n.onEmit&&n.onEmit("fetch::refresh",r),{get:()=>({...n.state}),subscribe:o=>(n.onUpdate(()=>o({...n.state})),()=>{}),refresh:r}}var J={};function Ve(e,t={}){let n=A();if(!n)throw new Error("useContext() must be inside render()");J[e]||(J[e]={value:t,subs:new Set});let r=J[e];r.subs.add(n),n.onUnmount(()=>r.subs.delete(n));let o=i=>{r.value=typeof i=="function"?i(r.value):i,r.subs.forEach(s=>s.update())};return[r.value,o]}function De(e){let t=A();if(!t)throw new Error("useState must be inside render()");t._hasStateSetters||(t.state&&Object.keys(t.state).forEach(o=>{let i="set"+o.charAt(0).toUpperCase()+o.slice(1);t[i]||(t[i]=s=>{let c=t.state[o],u=typeof s=="function"?s(c):s;u!==c&&(t.state[o]=u,t.update())})}),t._hasStateSetters=!0);let n=t._renderIndex++;t._hooks||(t._hooks=[]),t._hooks[n]===void 0&&(t._hooks[n]=typeof e=="function"?e():e);let r=o=>{let i=t._hooks[n],s=typeof o=="function"?o(i):o;s!==i&&(t._hooks[n]=s,t.update())};return[t._hooks[n],r]}function Ke(e,t=[]){let n=A();if(!n)throw new Error("useEffect must be inside render()");let r=n._renderIndex++;n._hooks=n._hooks||[];let o=n._hooks[r]||[];if(t.length===0||t.some((s,c)=>s!==o[c])){let s;n.onUnmount(()=>s&&s()),s=e(),n._hooks[r]=t}}function Z(){let e=new Map;return{subscribe(t,n){e.has(t)||e.set(t,new Set);let r=e.get(t);return r.add(n),()=>r.delete(n)},emit(t,n){let r=e.get(t);if(r)for(let o of r)o(n)},clear(){e.clear()}}}function de(e){let t=e,n=new Set;function r(s){typeof t=="object"&&t!==null&&typeof s=="object"&&s!==null&&!Array.isArray(t)&&!Array.isArray(s)?t={...t,...s}:t=typeof s=="function"?s(t):s,n.forEach(c=>c(t))}function o(s){return n.add(s),s(t),()=>n.delete(s)}function i(){return t}return{get:i,setState:r,getState:i,subscribe:o}}var P=Z(),R=new Map;function pe(e,t={}){if(!R.has(e)){let n=de(t),r={...n,emit(o,i){n.setState(i),P.emit(`${e}::${o}`,n.getState())},on(o,i){return P.subscribe(`${e}::${o}`,i)}};R.set(e,r)}return R.get(e)}pe.clear=()=>R.clear();function Qe(){let e=A();if(!e)throw new Error("useEmit must be inside render()");if(e._hasEmits)return e._emitsApi;e._hasEmits=!0;let t=Z(),n={emit:(r,o)=>t.emit(r,o),onEmit:(r,o)=>{let i=t.subscribe(r,o);return e.onUnmount(i),i},emitGlobal:(r,o)=>P.emit(r,o),onEmitGlobal:(r,o)=>{let i=P.subscribe(r,o);return e.onUnmount(i),i}};return Object.assign(e,n),e._emitsApi=n,e.onBeforeRender(function(){me(e,e.on)}),e.onUnmount(()=>{t.clear()}),n}function me(e,t={}){let n=[];Object.entries(t).forEach(([r,o])=>{if(r.includes("::")){let i=o.bind(e),s=P.subscribe(r,i);n.push(s)}else!r.includes(" ")&&!r.includes("*")&&!r.includes(":")&&e.onEmit(r,o.bind(e))}),e.onUnmount(()=>{n.forEach(r=>r()),n=[]})}function tt(){let e=A();if(!e)throw new Error("useEvent must be inside render()");e._eventApi&&e._eventApi;function t(i){let s={on(c,u){return e.addEvent(`${c} [data-ref=${i}]`,u),s},onClick(c){return this.on("click",c)},onBlur(c){return this.on("blur",c)},onInput(c){return this.on("input",c)},onChange(c){return this.on("change",c)},onFocus(c){return this.on("focus",c)},onSubmit(c){return this.on("submit",c)},toString(){return`data-ref="${i}"`}};return s}function n(i){return s=>{let c=`h${e._renderIndex++}`;return e.addEvent(`${i} [data-ref=${c}]`,s),t(c)}}let r={onClick:n("click"),onBlur:n("blur"),onInput:n("input"),onChange:n("change"),onFocus:n("focus"),onSubmit:n("submit"),on:(i,s)=>n(i)(s)},o={...e.on};return e.prototype.on=r.on,Object.assign(e.on,o),e._eventApi=r,r}function ot(){let e=A();if(!e)throw new Error("useEvent must be inside render()");if(e._events)return;function t(o){return o.replace(/<([a-zA-Z0-9-]+)([^>]*?)>/gs,(i,s,c)=>{let u=[...c.matchAll(/data-ref="([^"]+)"/g)].map(_=>_[1]);if(u.length<=1)return i;let l=`data-ref="${u.join(" ")}"`,h=c.replace(/\s*data-ref="[^"]*"/g,"");return`<${s} ${l}${h}>`})}e.onBeforeRender(t);let n={...e.on};e.on=function(i,s){i&&s&&e.addEvent(i,s)},Object.assign(e.on,n),e._events=1;function r(o){return i=>{let s=`h${e._renderIndex++}`;return e.addEvent(`${o} [data-ref~=${s}]`,i),`data-ref="${s}"`}}return{onClick:r("click")}}function it(e,t,n=r=>r.id??r.key??r){return e.map((r,o)=>{let i=n(r,o),s=t(r,o);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(i).replace(/"/g,"&quot;")}"`):s}).join("")}export{He as __VERSION__,P as context,Z as createChannelMap,fe as createComponent,de as createState,Y as getComponentById,G as globalComponentRegistry,ue as registerComponent,it as renderList,pe as shared,ae as unregisterComponent,Ve as useContext,A as useCurrentComponent,Ke as useEffect,Qe as useEmit,tt as useEvent,ot as useEvents,We as useFetch,De as useState};
//# sourceMappingURL=magnumjs-micro-ui.all.esm.js.map
