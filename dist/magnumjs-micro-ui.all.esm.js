/*!
 * @magnumjs/micro-ui v1.7.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
function J(t,e){if(!t)return!1;let n=document.createElement("div");if(n.innerHTML=e,n.children.length===0&&t.children.length===0&&n.textContent)return t.textContent!==n.textContent&&(t.textContent=n.textContent),!0;let r=Array.from(n.children),s=Array.from(t.children),i=new Map,o=new Map;for(let f of r){let l=f.dataset.key;l&&i.set(l,f)}for(let f of s){let l=f.dataset.key;l&&o.set(l,f)}let u=0;for(let f of r){let l=f.dataset.key,y=t.children[u];if(l&&o.has(l)){let A=o.get(l);A.hasAttribute("data-comp-root")||tt(A,f),A!==y&&t.insertBefore(A,y||null),o.delete(l)}else t.insertBefore(f,y||null);u++}for(let f of o.values())f.hasAttribute("data-comp-root")||f.remove();for(;t.children.length>r.length;){let f=t.lastChild;if(f?.hasAttribute?.("data-comp-root"))break;f.remove()}return!0}function tt(t,e){if(t.tagName!==e.tagName){t.replaceWith(e.cloneNode(!0));return}lt(t,e),!t.hasAttribute("data-comp-root")&&at(t,e)}function lt(t,e){let n=t.attributes,r=e.attributes;for(let{name:s}of Array.from(n))e.hasAttribute(s)||t.removeAttribute(s);for(let{name:s,value:i}of Array.from(r))t.getAttribute(s)!==i&&t.setAttribute(s,i)}function at(t,e){let n=Array.from(t.childNodes),r=Array.from(e.childNodes),s=Math.max(n.length,r.length);for(let i=0;i<s;i++){let o=n[i],u=r[i];if(!u&&o){if(o.nodeType===1&&o.hasAttribute("data-comp-root"))continue;t.removeChild(o);continue}if(!o&&u){t.appendChild(u.cloneNode(!0));continue}ft(o,u)}}function ft(t,e){if(!t.isEqualNode(e)){if(t.nodeType!==e.nodeType){t.replaceWith(e.cloneNode(!0));return}t.nodeType===Node.TEXT_NODE?t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue):t.nodeType===Node.ELEMENT_NODE&&t.tagName===e.tagName?tt(t,e):t.replaceWith(e.cloneNode(!0))}}function O(t,e,n,r){if(!e||!e.children[0]||!n)return;let s=e.children.length>1?e:e.children[0];function i(u,f){for(let l=u;l&&l!==f.parentNode;l=l.parentElement)if(!(!l||!l.hasAttributes||!l.hasAttributes())){for(let y of l.attributes)if(y.name==="data-action"||y.name.startsWith("data-action-"))return l}return null}function o(u,f=!1){if(u&&!(!f&&u.hasAttribute&&u.hasAttribute("data-comp-root"))){Object.entries(n).forEach(([l,y])=>{let A=l.includes(":"),[$,P]=A?l.split(":"):l.split(" "),m=$==="*";(m?["click","input","change","keydown","submit"]:[$]).forEach(h=>{let T=E=>{let C=i(E.target,s),M="",v="";if(C){let g=`data-action-${E.type}`,N=`data-args-${E.type}`;M=C.getAttribute(g)??C.getAttribute("data-action")??"",v=C.getAttribute(N)??C.getAttribute("data-args")??""}let w=M.split(":"),W=w[0],I=[];if(v)try{let g=JSON.parse(v);I=Array.isArray(g)?g:[g]}catch{console.warn("Invalid JSON in data-args:",v)}else I=w.slice(1);let j={...E.target.dataset,event:E,state:t.state,setState:t.setState,props:t.props,refs:t.refs,action:W,args:I};if(A&&C&&(P==="*"||P===W)&&(m||E.type===$))return y.call(t,j);if(!A){let g=E.target.closest(P||"*");return g&&s.contains(g)?y.call(t,j):void 0}},B=`__microBound_${h}_${l}`;s[B]||(s.addEventListener(h,T),s[B]=!0,r.push({node:s,type:h,listener:T}))})});for(let l of u.children)o(l,!1)}}o(e,!0)}function K(){let t=new Map;return{subscribe(e,n){t.has(e)||t.set(e,new Set);let r=t.get(e);return r.add(n),()=>r.delete(n)},emit(e,n){let r=t.get(e);if(r)for(let s of r)s(n)},clear(){t.clear()}}}function q(t){let e=t,n=new Set;function r(o){typeof e=="object"&&e!==null&&typeof o=="object"&&o!==null&&!Array.isArray(e)&&!Array.isArray(o)?e={...e,...o}:e=typeof o=="function"?o(e):o,n.forEach(u=>u(e))}function s(o){return n.add(o),o(e),()=>n.delete(o)}function i(){return e}return{get:i,setState:r,getState:i,subscribe:s}}var H=K(),V=new Map;function R(t,e={}){if(!V.has(t)){let n=q(e),r={...n,emit(s,i){n.setState(i),H.emit(`${t}::${s}`,n.getState())},on(s,i){return H.subscribe(`${t}::${s}`,i)}};V.set(t,r)}return V.get(t)}R.clear=()=>V.clear();var et=new WeakMap;function D(t,e){if(!t)return null;if(!t.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let n=et.get(t);if(n||(n={},et.set(t,n)),n[e]){let i=n[e];if(i.isConnected&&t.contains(i))return i;delete n[e]}let r=[`[data-ref="${e}"]`,`[data-slot="${e}"]`,`slot[name="${e}"]`,"slot:not([name])",`${e}`,`#${e}`];function s(i,o){if(i===o)return!0;let u=i.closest("[data-comp-root]");return!u||u===o}for(let i of r){let o=null;try{let u=t.querySelectorAll(i);for(let f of u)if(s(f,t)){o=f;break}}catch{throw new Error(`ref() invalid selector: '${i}' for ref name '${e}'`)}if(o)return n[e]=o,o}return null}var z=new WeakMap;function X(t,e,n){if(!t||e===null||z.has(t)&&z.get(t).value===e)return;let r=typeof e=="function"?e():e;if(t.nodeName==="SLOT"&&!t.hasAttribute("name")&&r&&typeof r=="object"&&"default"in r&&(r=r.default),Array.isArray(r)){let s=document.createDocumentFragment();r.forEach(i=>{let o=typeof i=="function"?i():i;if(o&&typeof o.mount=="function"){let u=document.createElement("div");if(o.isMounted())o.update(),o.el instanceof HTMLElement&&s.appendChild(o.el);else for(o.mount(u),n._mountedChildren.includes(o)||n._mountedChildren.push(o);u.firstChild;)s.appendChild(u.firstChild)}else if(o?.el instanceof HTMLElement)s.appendChild(o.el);else if(o instanceof Node)s.appendChild(o);else if(typeof o=="string"){let u=document.createElement("div");for(u.innerHTML=o;u.firstChild;)s.appendChild(u.firstChild)}}),t.replaceWith(s),z.set(t,{value:e});return}if(r&&typeof r.mount=="function"){if(r.isMounted())r.update(),r.el!==t&&t.replaceWith(r.el);else{let s=document.createElement("div");t.replaceWith(s),r.mount(s),r.el===t&&(r.el=s)}n._mountedChildren.includes(r)||n._mountedChildren.push(r)}else if(r?.el instanceof HTMLElement)t.replaceWith(r.el);else if(r instanceof Node)t.replaceWith(r);else if(typeof r=="string"){let s=document.createElement("div");s.innerHTML=r;let i=document.createDocumentFragment();for(;s.firstChild;)i.appendChild(s.firstChild);t.replaceWith(i)}else t.replaceWith(document.createTextNode(""));z.set(t,{value:e})}function Z(t,e,n,r){let i={...typeof r=="function"?r.call(n,e):typeof r=="object"?r:{},...e.slots||{}};(typeof e.slots=="function"||Array.isArray(e.slots))&&(i={default:e.slots}),e.children!==void 0?i.default=e.children:i.default||(i.default=null),(t.el?.querySelectorAll("[data-comp]")||[]).forEach(u=>{let f=u.getAttribute("data-comp");if(!f)return;let l=nt(+f);l&&(u.setAttribute("data-ref",f),i[f]||(l._fromSlotHydration=!0,i[f]=l({...l._prevProps,...u.dataset}),l._fromSlotHydration=!1))}),Object.entries(i).forEach(([u,f])=>{let l;if(u==="default"||u==="children"?l=t.el?.querySelector('[data-ref="children"]')||t.el?.querySelector("slot:not([name])"):l=D(t.el,u),!l||f==null)return;let y=l.querySelector("[data-comp-root='"+t._id+"']");!y&&f&&typeof f.mount=="function"&&(y=document.createElement("div"),y.setAttribute("data-comp-root",t._id),l.innerHTML="",l.appendChild(y));let A=y||l;f._id&&(f._fromSlotHydration=!0),X(A,f,n),f._id&&(f._fromSlotHydration=!1)})}function Q(t,e){if(!e)return;e.querySelectorAll("*").forEach(r=>{Array.from(r.attributes).forEach(s=>{if(!s.name.startsWith("data-action-"))return;let i=s.name.slice(12),o=s.value;if(!o)return;let u=`${i}:${o}`;if(typeof t.on[u]!="function"){if(typeof t.on[o]=="function"){t.on[u]=t.on[o].bind(t);return}typeof t[o]=="function"&&(t.on[u]=t[o].bind(t))}})})}function L(t,e,n=!0,r){for(let s of t)try{s.call(r,e)}catch(i){console.error(i)}n&&(t.length=0)}function F(t,e,n){if(Array.isArray(t)){let s=function(){if(r<t.length){let i=t[r++];try{i.length?i.call(n,s):Promise.resolve(i.call(n)).then(s).catch(o=>{console.error(o),s()})}catch(o){console.error(o),s()}}else e()},r=0;s()}else if(t)try{t.length?t.call(n,e):Promise.resolve(t.call(n)).then(e).catch(r=>{console.error(r),e()})}catch(r){console.error(r),e()}else e()}function rt(t,e){for(let n of Object.keys(t))n in e||Object.defineProperty(e,n,{get(){return t[n]},enumerable:!0})}function dt(t,e,n=r=>r.id??r.key??r){return t.map((r,s)=>{let i=n(r,s),o=e(r,s);return typeof o=="string"?o.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(i).replace(/"/g,"&quot;")}"`):o}).join("")}var pt=1,Gt="1.7.0",Y=new Map;function ht(t){t._id&&Y.set(t._id,t)}function mt(t){t._id&&Y.delete(t._id)}function nt(t){return Y.get(t)}var U=null;function bt(t,e={}){let n=t._frozenTemplate,r=_t(n.renderFn,n.options);return r._initialProps=e,r._templateSource=t,r}function _t(t,e={}){let n,r={},s=typeof t;s==="object"&&s!=="function"&&t!==null&&!Array.isArray(t)?(n=t.render,r={...t},delete r.render):(n=t,r=e||{});let{state:i={},on:o={},slots:u={},onMount:f,onUnmount:l,onBeforeMount:y,onBeforeUnmount:A,onUpdate:$,...P}=r,m=null,x=!1,h={},T={},B=null,E=!1,C=[],M=i,v=null,w=!1,W={...i},I=!1,j=[],g=K(),N=c=>{M=typeof c=="function"?c(M):{...M,...c},I||(I=!0,B={...h},queueMicrotask(()=>{I=!1,p(B),B=null}))},d={refs:{},on:o,setState:N,props:h,_childCallCache:{},_childCallIndex:0,isMounted:()=>x,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],onMount(c){typeof c=="function"&&this._mountCbs.push(c)},onUnmount(c){typeof c=="function"&&this._unmountCbs.push(c)},onBeforeMount(c){typeof c=="function"&&this._beforeMountCbs.push(c)},onBeforeUnmount(c){typeof c=="function"&&this._beforeUnmountCbs.push(c)},onUpdate(c){typeof c=="function"&&this._updateCbs.push(c)},emit(c,a){g.emit(c,a)},onEmit(c,a){let b=g.subscribe(c,a);return this.onUnmount(b),b},emitGlobal(c,a){H.emit(c,a)},onEmitGlobal(c,a){let b=H.subscribe(c,a);return this.onUnmount(b),b},addEvent(c,a){o[c]=a},mount(c,a={}){if(x||E)return;let b=typeof c=="string"?document.querySelector(c):c;if(!b)throw new Error(`No element matches: ${c}`);let _=()=>{E=!0,m=b,m.setAttribute("data-comp-root",p._id+"-"+(n.name||"")),h={...h,...a},T={...h},d.props=h,h.key&&m.setAttribute("data-key",h.key),p(h),w||(x=!0,L(d._mountCbs,void 0,!1,p),st())};F(d._beforeMountCbs,_,p)},update(c={}){if(!x)return;let a=c.props?c.props:c,b=a.on;b&&b!==o&&(o=b);let _={...h,...a};T={...h},h=_,d.props=h,h.key!==T.key&&m.setAttribute("data-key",h.key),p(h)},render(c={}){h={...h,...c},d.props=h;let a=typeof n=="function"?n.call(d,{state:M,setState:N,props:h,refs:d.refs}):n;return a&&(a=new String(a),a._id=p._id),rt(d,p),a},_resetInternal:()=>{d._mountedChildren.forEach(c=>{c&&typeof c.unmount=="function"&&c.unmount()}),d._mountedChildren=[],v=null,w=!1,m=null,x=!1,E=!1,C=[],h={},T={},M={...W}},unmount(){if(!x||!m)return;let c=()=>{m.firstChild&&(v=m.firstChild.cloneNode(!0),m.removeChild(m.firstChild)),L(d._unmountCbs,void 0,!0,p),g.clear(),C.forEach(({node:a,type:b,listener:_})=>{a.removeEventListener(b,_)}),C=[],j.forEach(a=>a()),j=[],x=!1,E=!1,w=!0,mt(p),d._resetInternal&&d._resetInternal()};F(d._beforeUnmountCbs,c,d)},get renderFn(){return n},get el(){return m},get state(){return M}};f&&d.onMount(f),l&&d.onUnmount(l),y&&d.onBeforeMount(y),A&&d.onBeforeUnmount(A),$&&d.onUpdate($),d.ref=function(c){return D(this.el,c)},d.refs=new Proxy({},{get(c,a){return d.ref(a)}});function st(){j=[],Object.entries(o).forEach(([c,a])=>{if(c.includes("::")){let b=a.bind(d),_=H.subscribe(c,b);j.push(_)}})}function it(c){h={...d.props,...c},d.props=h,!m||m.isConnected;let a=d.render(h);if(a===null||a===""){!w&&m&&m.firstChild?(v=m.firstChild.cloneNode(!0),F(d._beforeUnmountCbs,()=>{m.innerHTML="",C.forEach(({node:_,type:ct,listener:ut})=>{_.removeEventListener(ct,ut)}),C=[],x=!1,w=!0,L(d._unmountCbs,void 0,!0,p)},d)):w=!0;return}if(w&&v){m.appendChild(v),v=null,w=!1,x=!0,O(d,m,o,C),L(d._mountCbs,void 0,!1,p);return}return J(m,a),Z(p,h,d,u),Q(p,m),O(d,m,o,C),x&&L(d._updateCbs,T,!1,p),w=!1,a}let k="";function p(c={}){if(!p._fromSlotHydration&&U&&U!==p){let a=U;a._childCallIndex==null&&(a._childCallIndex=0),a._childCallCache||(a._childCallCache={});let b=a._childCallIndex++,_=a._childCallCache[b];return!_||_._templateSource!==p?(_=bt(p,c),_._prevProps={...c},_.toString=()=>`<div data-comp="${_._id}"></div>`,a._childCallCache[b]=_):(_._prevProps={...c},_.update(c)),_}return U=p,p._renderIndex=0,p._childCallIndex=0,p._prevProps=c,k=p._render(c),U=null,p}return p.toString=function(){return!k||String(k)===""&&!p.isMounted()&&U?p._id:k?String(k):""},Object.assign(p,d,P),["el","props","state","setState"].forEach(c=>{Object.defineProperty(p,c,{get(){return d[c]},enumerable:!0,configurable:!1})}),p._render=it,p.render=d.render,p._id=pt++,p.getId=()=>p._id,ht(p),p._frozenTemplate=Object.freeze({renderFn:n,options:{...r,state:{...W}}}),p}function S(){return U}function yt(t){let e=q(t),n=()=>e.get(),r=i=>e.setState(i),s=S();if(s){let i=e.subscribe(()=>s.update());s.onUnmount(i)}return[n,r,e.subscribe]}function Ct(t,e={}){let n=R(t,e),r=S();if(r){let s=n.subscribe(()=>r.update());r.onUnmount(s)}return n}function te(t,e={}){let n=S(),r=q({data:null,loading:!0,error:null});async function s(){r.setState(i=>({...i,loading:!0}));try{let o=await(await fetch(t,e)).json();r.setState({data:o,error:null,loading:!1}),n?.emit("fetch::done",{url:t,data:o})}catch(i){r.setState({data:null,error:i,loading:!1}),n?.emit("fetch::error",{url:t,error:i})}}return n&&(n.onMount(s),n.onEmit("fetch::refresh",s)),{get:r.get,subscribe:r.subscribe,refresh:s}}function ie(t,e=[]){let n=S();if(!n)throw new Error("effect() must be called inside a component");n._effects||(n._effects=[]);let r=Array.isArray(e)&&e.length>0,s=n._effects.length,i={cb:t,deps:e,cleanup:null,lastDeps:r?[]:null};n._effects.push(i),gt(n,i,r),n.onUnmount(()=>{n._effects.forEach(o=>o.cleanup&&o.cleanup())})}function gt(t,e,n){(n?!At(e.lastDeps,e.deps):e.lastDeps===null)&&(e.cleanup&&e.cleanup(),e.cleanup=e.cb(),e.lastDeps=n?e.deps.slice():[])}function At(t,e){return t.length===e.length&&t.every((n,r)=>Object.is(n,e[r]))}function le(t){let e=S();if(!e)throw new Error("slot() must be called inside a component");e._slots=e._slots||[];let n=e._renderIndex++;if(e._slots[n])return e._slots[n];let r=t,o=[()=>r,u=>{r=typeof u=="function"?u(r):u,e.update()}];return e._slots[n]=o,o}function de(t,e){let n=S();if(!n)throw new Error("event() must be called inside a component");if(typeof t=="string"&&typeof e=="function")n.addEvent(t,e);else if(typeof t=="object")for(let[r,s]of Object.entries(t))typeof s=="function"&&n.addEvent(r,s);else throw new Error("Invalid arguments passed to event()")}function St(t={}){let e=t,n=new Set;function r(o){queueMicrotask(()=>{typeof e=="object"&&e!==null&&typeof o=="object"&&o!==null&&!Array.isArray(e)&&!Array.isArray(o)?e={...e,...o}:e=typeof o=="function"?o(e):o,n.forEach(u=>u(e))})}function s(o){return n.add(o),o(e),()=>n.delete(o)}function i(){return e}return{get:i,setState:r,subscribe:s}}var G=new Map;function me(t,e){let n=S();if(!n)throw new Error("useSharedState() must be called inside a component");return ot(t,e,n)}function ot(t,e,n){if(!G.has(t)){let s=St(e),i=new Map,o={get:s.get,set:s.setState,subscribe:s.subscribe,_subscribers:i};G.set(t,o)}let r=G.get(t);if(n&&!r._subscribers.has(n._id)){let s=r.subscribe(()=>{n.update()});r._subscribers.set(n._id,s),n.onUnmount(()=>{let i=r._subscribers.get(n._id);i&&i(),r._subscribers.delete(n._id)})}return[r.get,r.set,r.subscribe]}ot.clear=()=>G.clear();export{Gt as __VERSION__,_t as createComponent,ie as effect,de as event,nt as getComponentById,Y as globalComponentRegistry,ht as registerComponent,dt as renderList,ot as shared,le as slot,mt as unregisterComponent,Ct as useContext,S as useCurrentComponent,te as useFetch,me as useSharedState,yt as useState};
//# sourceMappingURL=magnumjs-micro-ui.all.esm.js.map
