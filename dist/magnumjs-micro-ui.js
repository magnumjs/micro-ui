/*!
 * @magnumjs/micro-ui v1.0.19
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var q=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var n in t)q(e,n,{get:t[n],enumerable:!0})},Y=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of F(t))!G.call(e,o)&&o!==n&&q(e,o,{get:()=>t[o],enumerable:!(r=k(t,o))||r.enumerable});return e};var U=e=>Y(q({},"__esModule",{value:!0}),e);var ie={};Q(ie,{context:()=>j,createComponent:()=>oe,createState:()=>K,renderList:()=>se,shared:()=>X});function B(e,t={}){if(typeof e!="string")return"";let{children:n={},slots:r={}}=t;function o(i,s){let f;if(i)f=n?.[i]??r?.[i]??s;else if(n&&typeof n=="object"&&n.default!=null)f=n.default;else if(r&&typeof r=="object"&&r.default!=null)f=r.default;else if(typeof n=="string")f=n;else return s;if(typeof f=="function"&&(f=f()),f?.el instanceof HTMLElement)return f.el.outerHTML;if(f instanceof Node){let c=document.createElement("div");return c.appendChild(f.cloneNode(!0)),c.innerHTML}return f??s}return e=e.replace(/<slot(?:\s+name="([^"]+)")?>([\s\S]*?)<\/slot>/gis,(i,s,f)=>o(s,f)),e=e.replace(/<([a-z]+)([^>]*)\sdata-slot="([^"]+)"([^>]*)>([\s\S]*?)<\/\1>/gis,(i,s,f,c,p,l)=>{let m=o(c,l);return`<${s}${f}${p}>${m}</${s}>`}),e}function V(e,t){if(!e)return!1;let n=document.createElement("div");if(n.innerHTML=t,n.children.length===0&&n.textContent)return e.textContent=n.textContent,!0;let r=Array.from(n.children),o=Array.from(e.children),i=new Map,s=new Map;for(let c of r){let p=c.dataset.key;p&&i.set(p,c)}for(let c of o){let p=c.dataset.key;p&&s.set(p,c)}let f=0;for(let c of r){let p=c.dataset.key,l=e.children[f];if(p&&s.has(p)){let m=s.get(p);J(m,c),m!==l&&e.insertBefore(m,l||null),s.delete(p)}else e.insertBefore(c,l||null);f++}for(let c of s.values())c.remove();for(;e.children.length>r.length;)e.lastChild.remove();return!0}function J(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}ee(e,t),te(e,t)}function ee(e,t){let n=e.attributes,r=t.attributes;for(let{name:o}of Array.from(n))t.hasAttribute(o)||e.removeAttribute(o);for(let{name:o,value:i}of Array.from(r))e.getAttribute(o)!==i&&e.setAttribute(o,i)}function te(e,t){let n=Array.from(e.childNodes),r=Array.from(t.childNodes),o=Math.max(n.length,r.length);for(let i=0;i<o;i++){let s=n[i],f=r[i];if(!f&&s){e.removeChild(s);continue}if(!s&&f){e.appendChild(f.cloneNode(!0));continue}ne(s,f)}}function ne(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?J(e,t):e.replaceWith(t.cloneNode(!0))}}function $(e,t,n,r){if(!t||!n)return;let o=t.firstElementChild;o&&Object.entries(n).forEach(([i,s])=>{let f=i.includes(":"),[c,p]=f?i.split(":"):i.split(" "),l=c==="*";(l?["click","input","change","keydown","submit"]:[c]).forEach(T=>{let A=y=>{let b=y.target.closest("[data-action]"),C=b?.dataset.action||"",L=b?.dataset.args,_=C.split(":"),x=_[0],w=[];if(L)try{let v=JSON.parse(L);w=Array.isArray(v)?v:[v]}catch{console.warn("Invalid JSON in data-args:",L)}else w=_.slice(1);let u={event:y,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:x,args:w};if(f&&b&&(p==="*"||p===x)&&(l||y.type===c))return s.call(e,u);if(!f){let v=y.target.closest(p||"*");if(v&&o.contains(v))return s.call(e,u)}},g=`__microBound_${T}_${i}`;o[g]||(o.addEventListener(T,A),o[g]=!0,r.push({node:o,type:T,listener:A}))})})}function K(e){let t=e,n=new Set;function r(s){t=typeof s=="function"?s(t):{...t,...s},n.forEach(f=>f(t))}function o(s){return n.add(s),s(t),()=>n.delete(s)}function i(){return t}return{get:i,setState:r,getState:i,subscribe:o}}var H=new Map,j={subscribe(e,t){H.has(e)||H.set(e,new Set);let n=H.get(e);return n.add(t),()=>n.delete(t)},emit(e,t){let n=H.get(e);if(n)for(let r of n)r(t)},clear(){H.clear()}},O=new Map;function X(e,t={}){if(!O.has(e)){let n=K(t),r={...n,emit(o,i){n.setState(i),j.emit(`${e}::${o}`,n.getState())},on(o,i){return j.subscribe(`${e}::${o}`,i)}};O.set(e,r)}return O.get(e)}X.clear=()=>O.clear();function D(e,t){if(!e||t==null)return;let n=typeof t=="function"?t():t;if(Array.isArray(n)){let r=document.createDocumentFragment();n.forEach(o=>{let i=typeof o=="function"?o():o;if(i&&typeof i.mount=="function"){let s=document.createElement("div");i.mount(s),s.firstElementChild&&r.appendChild(s.firstElementChild)}else if(i?.el instanceof HTMLElement)r.appendChild(i.el);else if(i instanceof Node)r.appendChild(i);else if(typeof i=="string"){let s=document.createElement("div");s.innerHTML=i,s.firstElementChild&&r.appendChild(s.firstElementChild)}}),e.replaceWith(r);return}if(n&&typeof n.mount=="function"){let r=document.createElement("div");e.replaceWith(r),n.mount(r)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let r=document.createElement("div");r.innerHTML=n,r.firstElementChild&&e.replaceWith(r.firstElementChild)}else e.replaceWith(document.createTextNode(""))}var N={};function I(e,t){if(!e)return null;if(N[t]){let r=N[t];if(r.isConnected){if(e.contains(r)||e.parentNode&&e.parentNode!==document.body&&e.parentNode.contains(r))return r;delete N[t]}else delete N[t]}let n=[`[data-ref="${t}"]`,`slot[name="${t}"]`,t];for(let r of n){let o=e.querySelector(r);if(o||e.parentNode&&(o=e.parentNode.querySelector(r),o))return N[t]=o,o}return null}var re=0;function oe(e,{state:t={},on:n={},onMount:r,onUnmount:o,onBeforeMount:i,onBeforeUnmount:s,onUpdate:f}={}){let c=null,p=!1,l={},m={},T=null,A=!1,g=[],y=t,b=null,C=!1,L={...t},_=!1,x=[],w=a=>{y=typeof a=="function"?a(y):{...y,...a},_||(_=!0,T={...l},queueMicrotask(()=>{_=!1,h(T),T=null}))},u={refs:{},setState:w,props:l,mount(a,d={}){if(p||A)return;let E=typeof a=="string"?document.querySelector(a):a;if(!E)throw new Error(`No element matches: ${a}`);W(i,()=>{A=!0,c=E,l={...l,...d},m={...l},u.props=l,h(l);let M={...l.slots||{}};typeof l.children=="function"&&l.children.mount?M.children=l.children:M={...M,...l.children||{}},Object.entries(M).forEach(([P,R])=>{let z=h.refs[P];!z||R==null||D(z,R)}),$(u,c,n,g),C||(p=!0,r?.call(h),v())})},update(a={}){if(!p)return;let d=a.props?a.props:a,E=d.on;E&&E!==n&&(n=E);let S={...l,...d};m={...l},l=S,u.props=l,h(l)},render(a={}){l={...l,...a},u.props=l;let d=typeof e=="function"?e.call(u,{state:y,setState:w,props:l,refs:u.refs}):e;return p&&(d=B(d,l)),d&&(d=new String(d),d._id=h._id),d},_resetInternal:()=>{b=null,C=!1,c=null,p=!1,A=!1,g=[],l={},m={},y={...L}},unmount(){if(!p||!c)return;W(s,()=>{c.firstChild&&(b=c.firstChild.cloneNode(!0),c.removeChild(c.firstChild)),g.forEach(({node:d,type:E,listener:S})=>{d.removeEventListener(E,S)}),g=[],x.forEach(d=>d()),x=[],p=!1,A=!1,C=!0,o?.call(u),u._resetInternal&&u._resetInternal()})},get renderFn(){return e},get el(){return c},get state(){return y}};u.ref=function(a){return I(this.el,a)},u.refs=new Proxy({},{get(a,d){return u.ref(d)}}),u.action=function(a){return a.target.closest("[data-action]")?.dataset.action||null};function v(){x=[],Object.entries(n).forEach(([a,d])=>{if(a.includes("::")){let E=d.bind(u),S=j.subscribe(a,E);x.push(S)}})}function Z(a){l=a,u.props=l;let d=u.render(l);if(d===null||d===""){!C&&c&&c.firstChild?(b=c.firstChild.cloneNode(!0),W(s,()=>{c.innerHTML="",g.forEach(({node:S,type:M,listener:P})=>{S.removeEventListener(M,P)}),g=[],p=!1,C=!0,o?.call(u)})):C=!0;return}if(C&&b){c.appendChild(b),b=null,C=!1,p=!0,$(u,c,n,g),r?.call(u);return}C=!1,V(c,d),$(u,c,n,g),p&&f&&f.call(u,m)}function W(a,d){a?a.length?a.call(u,d):Promise.resolve(a.call(u)).then(d):d()}function h(a={}){return h._render(a),h}return Object.assign(h,u),["el","props","state","setState"].forEach(a=>{Object.defineProperty(h,a,{get(){return u[a]},enumerable:!0})}),h._render=Z,h.render=u.render,h._id=re++,h}function se(e,t,n=r=>r.id??r.key??r){return e.map((r,o)=>{let i=n(r,o),s=t(r,o);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(i).replace(/"/g,"&quot;")}"`):s}).join("")}return U(ie);})();
//# sourceMappingURL=magnumjs-micro-ui.js.map
