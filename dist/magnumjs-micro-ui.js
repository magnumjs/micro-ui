/*!
 * @magnumjs/micro-ui v1.0.20
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var q=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var o in t)q(e,o,{get:t[o],enumerable:!0})},Y=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of F(t))!G.call(e,n)&&n!==o&&q(e,n,{get:()=>t[n],enumerable:!(r=k(t,n))||r.enumerable});return e};var U=e=>Y(q({},"__esModule",{value:!0}),e);var ie={};Q(ie,{context:()=>j,createComponent:()=>oe,createState:()=>K,renderList:()=>se,shared:()=>X});function B(e,t={}){if(typeof e!="string")return"";let{children:o={},slots:r={}}=t;function n(a,s){let i;if(a)i=o?.[a]??r?.[a]??s;else if(o&&typeof o=="object"&&o.default!=null)i=o.default;else if(r&&typeof r=="object"&&r.default!=null)i=r.default;else if(typeof o=="string")i=o;else return s;if(typeof i=="function"&&(i=i()),i?.el instanceof HTMLElement)return i.el.outerHTML;if(i instanceof Node){let l=document.createElement("div");return l.appendChild(i.cloneNode(!0)),l.innerHTML}return i??s}return e=e.replace(/<slot(?:\s+name="([^"]+)")?>([\s\S]*?)<\/slot>/gis,(a,s,i)=>n(s,i)),e=e.replace(/<([a-z]+)([^>]*)\sdata-slot="([^"]+)"([^>]*)>([\s\S]*?)<\/\1>/gis,(a,s,i,l,p,f)=>{let m=n(l,f);return`<${s}${i}${p}>${m}</${s}>`}),e}function V(e,t){if(!e)return!1;let o=document.createElement("div");if(o.innerHTML=t,o.children.length===0&&o.textContent)return e.textContent=o.textContent,!0;let r=Array.from(o.children),n=Array.from(e.children),a=new Map,s=new Map;for(let l of r){let p=l.dataset.key;p&&a.set(p,l)}for(let l of n){let p=l.dataset.key;p&&s.set(p,l)}let i=0;for(let l of r){let p=l.dataset.key,f=e.children[i];if(p&&s.has(p)){let m=s.get(p);J(m,l),m!==f&&e.insertBefore(m,f||null),s.delete(p)}else e.insertBefore(l,f||null);i++}for(let l of s.values())l.remove();for(;e.children.length>r.length;)e.lastChild.remove();return!0}function J(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}ee(e,t),te(e,t)}function ee(e,t){let o=e.attributes,r=t.attributes;for(let{name:n}of Array.from(o))t.hasAttribute(n)||e.removeAttribute(n);for(let{name:n,value:a}of Array.from(r))e.getAttribute(n)!==a&&e.setAttribute(n,a)}function te(e,t){let o=Array.from(e.childNodes),r=Array.from(t.childNodes),n=Math.max(o.length,r.length);for(let a=0;a<n;a++){let s=o[a],i=r[a];if(!i&&s){e.removeChild(s);continue}if(!s&&i){e.appendChild(i.cloneNode(!0));continue}ne(s,i)}}function ne(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?J(e,t):e.replaceWith(t.cloneNode(!0))}}function $(e,t,o,r){if(!t||!o)return;let n=t.firstElementChild;n&&Object.entries(o).forEach(([a,s])=>{let i=a.includes(":"),[l,p]=i?a.split(":"):a.split(" "),f=l==="*";(f?["click","input","change","keydown","submit"]:[l]).forEach(S=>{let T=y=>{let b=y.target.closest("[data-action]"),C=b?.dataset.action||"",L=b?.dataset.args,x=C.split(":"),A=x[0],w=[];if(L)try{let v=JSON.parse(L);w=Array.isArray(v)?v:[v]}catch{console.warn("Invalid JSON in data-args:",L)}else w=x.slice(1);let u={event:y,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:A,args:w};if(i&&b&&(p==="*"||p===A)&&(f||y.type===l))return s.call(e,u);if(!i){let v=y.target.closest(p||"*");if(v&&n.contains(v))return s.call(e,u)}},g=`__microBound_${S}_${a}`;n[g]||(n.addEventListener(S,T),n[g]=!0,r.push({node:n,type:S,listener:T}))})})}function K(e){let t=e,o=new Set;function r(s){t=typeof s=="function"?s(t):{...t,...s},o.forEach(i=>i(t))}function n(s){return o.add(s),s(t),()=>o.delete(s)}function a(){return t}return{get:a,setState:r,getState:a,subscribe:n}}var H=new Map,j={subscribe(e,t){H.has(e)||H.set(e,new Set);let o=H.get(e);return o.add(t),()=>o.delete(t)},emit(e,t){let o=H.get(e);if(o)for(let r of o)r(t)},clear(){H.clear()}},O=new Map;function X(e,t={}){if(!O.has(e)){let o=K(t),r={...o,emit(n,a){o.setState(a),j.emit(`${e}::${n}`,o.getState())},on(n,a){return j.subscribe(`${e}::${n}`,a)}};O.set(e,r)}return O.get(e)}X.clear=()=>O.clear();function D(e,t,o){if(!e||t==null)return;let r=typeof t=="function"?t():t;if(Array.isArray(r)){let n=document.createDocumentFragment();r.forEach(a=>{let s=typeof a=="function"?a():a;if(s&&typeof s.mount=="function"){let i=document.createElement("div");s.mount(i),o._mountedChildren.push(s),i.firstElementChild&&n.appendChild(i.firstElementChild)}else if(s?.el instanceof HTMLElement)n.appendChild(s.el);else if(s instanceof Node)n.appendChild(s);else if(typeof s=="string"){let i=document.createElement("div");i.innerHTML=s,i.firstElementChild&&n.appendChild(i.firstElementChild)}}),e.replaceWith(n);return}if(r&&typeof r.mount=="function"){let n=document.createElement("div");e.replaceWith(n),console.log(r.props,"resolved"),r.mount(n),o._mountedChildren.push(r)}else if(r?.el instanceof HTMLElement)e.replaceWith(r.el);else if(r instanceof Node)e.replaceWith(r);else if(typeof r=="string"){let n=document.createElement("div");n.innerHTML=r,n.firstElementChild&&e.replaceWith(n.firstElementChild)}else e.replaceWith(document.createTextNode(""))}var N={};function I(e,t){if(!e)return null;if(N[t]){let r=N[t];if(r.isConnected){if(e.contains(r)||e.parentNode&&e.parentNode!==document.body&&e.parentNode.contains(r))return r;delete N[t]}else delete N[t]}let o=[`[data-ref="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",t];for(let r of o){let n=e.querySelector(r);if(n||e.parentNode&&(n=e.parentNode.querySelector(r),n))return N[t]=n,n}return null}var re=0;function oe(e,{state:t={},on:o={},onMount:r,onUnmount:n,onBeforeMount:a,onBeforeUnmount:s,onUpdate:i}={}){let l=null,p=!1,f={},m={},S=null,T=!1,g=[],y=t,b=null,C=!1,L={...t},x=!1,A=[],w=c=>{y=typeof c=="function"?c(y):{...y,...c},x||(x=!0,S={...f},queueMicrotask(()=>{x=!1,h(S),S=null}))},u={refs:{},setState:w,props:f,_mountedChildren:[],mount(c,d={}){if(p||T)return;let E=typeof c=="string"?document.querySelector(c):c;if(!E)throw new Error(`No element matches: ${c}`);W(a,()=>{T=!0,l=E,f={...f,...d},m={...f},u.props=f,h(f);let M={...f.slots||{}};typeof f.children=="function"&&f.children.mount?M.children=f.children:M={...M,...f.children||{}},Object.entries(M).forEach(([P,R])=>{let z=h.refs[P];!z||R==null||D(z,R,u)}),$(u,l,o,g),C||(p=!0,r?.call(h),v())})},update(c={}){if(!p)return;let d=c.props?c.props:c,E=d.on;E&&E!==o&&(o=E);let _={...f,...d};m={...f},f=_,u.props=f,h(f)},render(c={}){f={...f,...c},u.props=f;let d=typeof e=="function"?e.call(u,{state:y,setState:w,props:f,refs:u.refs}):e;return p&&(d=B(d,f)),d&&(d=new String(d),d._id=h._id),d},_resetInternal:()=>{u._mountedChildren.forEach(c=>{c&&typeof c.unmount=="function"&&c.unmount()}),u._mountedChildren=[],b=null,C=!1,l=null,p=!1,T=!1,g=[],f={},m={},y={...L}},unmount(){if(!p||!l)return;W(s,()=>{l.firstChild&&(b=l.firstChild.cloneNode(!0),l.removeChild(l.firstChild)),g.forEach(({node:d,type:E,listener:_})=>{d.removeEventListener(E,_)}),g=[],A.forEach(d=>d()),A=[],p=!1,T=!1,C=!0,n?.call(u),u._resetInternal&&u._resetInternal()})},get renderFn(){return e},get el(){return l},get state(){return y}};u.ref=function(c){return I(this.el,c)},u.refs=new Proxy({},{get(c,d){return u.ref(d)}}),u.action=function(c){return c.target.closest("[data-action]")?.dataset.action||null};function v(){A=[],Object.entries(o).forEach(([c,d])=>{if(c.includes("::")){let E=d.bind(u),_=j.subscribe(c,E);A.push(_)}})}function Z(c){f={...u.props,...c},u.props=f;let d=u.render(f);if(d===null||d===""){!C&&l&&l.firstChild?(b=l.firstChild.cloneNode(!0),W(s,()=>{l.innerHTML="",g.forEach(({node:_,type:M,listener:P})=>{_.removeEventListener(M,P)}),g=[],p=!1,C=!0,n?.call(u)})):C=!0;return}if(C&&b){l.appendChild(b),b=null,C=!1,p=!0,$(u,l,o,g),r?.call(u);return}C=!1,V(l,d),$(u,l,o,g),p&&i&&i.call(u,m)}function W(c,d){c?c.length?c.call(u,d):Promise.resolve(c.call(u)).then(d):d()}function h(c={}){return h._render(c),h}return Object.assign(h,u),["el","props","state","setState"].forEach(c=>{Object.defineProperty(h,c,{get(){return u[c]},enumerable:!0})}),h._render=Z,h.render=u.render,h._id=re++,h}function se(e,t,o=r=>r.id??r.key??r){return e.map((r,n)=>{let a=o(r,n),s=t(r,n);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(a).replace(/"/g,"&quot;")}"`):s}).join("")}return U(ie);})();
//# sourceMappingURL=magnumjs-micro-ui.js.map
