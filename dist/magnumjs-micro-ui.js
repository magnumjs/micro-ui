/*!
 * @magnumjs/micro-ui v1.0.22
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var V=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var te=(e,t)=>{for(var o in t)V(e,o,{get:t[o],enumerable:!0})},ne=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Y(t))!ee.call(e,r)&&r!==o&&V(e,r,{get:()=>t[r],enumerable:!(n=Q(t,r))||n.enumerable});return e};var re=e=>ne(V({},"__esModule",{value:!0}),e);var fe={};te(fe,{context:()=>W,createComponent:()=>le,createState:()=>K,renderList:()=>ae,shared:()=>k});function R(e,t){if(!e)return!1;let o=document.createElement("div");if(o.innerHTML=t,o.children.length===0&&o.textContent)return e.textContent=o.textContent,!0;let n=Array.from(o.children),r=Array.from(e.children),i=new Map,s=new Map;for(let l of n){let p=l.dataset.key;p&&i.set(p,l)}for(let l of r){let p=l.dataset.key;p&&s.set(p,l)}let f=0;for(let l of n){let p=l.dataset.key,A=e.children[f];if(p&&s.has(p)){let S=s.get(p);J(S,l),S!==A&&e.insertBefore(S,A||null),s.delete(p)}else e.insertBefore(l,A||null);f++}for(let l of s.values())l.remove();for(;e.children.length>n.length;)e.lastChild.remove();return!0}function J(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}oe(e,t),se(e,t)}function oe(e,t){let o=e.attributes,n=t.attributes;for(let{name:r}of Array.from(o))t.hasAttribute(r)||e.removeAttribute(r);for(let{name:r,value:i}of Array.from(n))e.getAttribute(r)!==i&&e.setAttribute(r,i)}function se(e,t){let o=Array.from(e.childNodes),n=Array.from(t.childNodes),r=Math.max(o.length,n.length);for(let i=0;i<r;i++){let s=o[i],f=n[i];if(!f&&s){e.removeChild(s);continue}if(!s&&f){e.appendChild(f.cloneNode(!0));continue}ie(s,f)}}function ie(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?J(e,t):e.replaceWith(t.cloneNode(!0))}}function O(e,t,o,n){if(!t||!o)return;let r=t.firstElementChild;if(!r)return;function i(s,f=!1){if(s){!f&&s.hasAttribute&&s.hasAttribute("data-comp-root"),Object.entries(o).forEach(([l,p])=>{let A=l.includes(":"),[S,N]=A?l.split(":"):l.split(" "),h=S==="*";(h?["click","input","change","keydown","submit"]:[S]).forEach(d=>{let w=M=>{let C=M.target.closest("[data-action]"),v=C?.dataset.action||"",_=C?.dataset.args,y=v.split(":"),q=y[0],x=[];if(_)try{let b=JSON.parse(_);x=Array.isArray(b)?b:[b]}catch{console.warn("Invalid JSON in data-args:",_)}else x=y.slice(1);let L={event:M,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:q,args:x};if(A&&C&&(N==="*"||N===q)&&(h||M.type===S))return p.call(e,L);if(!A){let b=M.target.closest(N||"*");if(b&&r.contains(b))return p.call(e,L)}},$=`__microBound_${d}_${l}`;r[$]||(r.addEventListener(d,w),r[$]=!0,n.push({node:r,type:d,listener:w}))})});for(let l of s.children)i(l,!1)}}i(t,!0)}function K(e){let t=e,o=new Set;function n(s){t=typeof s=="function"?s(t):{...t,...s},o.forEach(f=>f(t))}function r(s){return o.add(s),s(t),()=>o.delete(s)}function i(){return t}return{get:i,setState:n,getState:i,subscribe:r}}var B=new Map,W={subscribe(e,t){B.has(e)||B.set(e,new Set);let o=B.get(e);return o.add(t),()=>o.delete(t)},emit(e,t){let o=B.get(e);if(o)for(let n of o)n(t)},clear(){B.clear()}},I=new Map;function k(e,t={}){if(!I.has(e)){let o=K(t),n={...o,emit(r,i){o.setState(i),W.emit(`${e}::${r}`,o.getState())},on(r,i){return W.subscribe(`${e}::${r}`,i)}};I.set(e,n)}return I.get(e)}k.clear=()=>I.clear();var j={};function H(e,t){if(!e)return null;if(j[t]){let r=j[t];if(r.isConnected){if(e.contains(r)||e.parentNode&&e.parentNode!==document.body&&e.parentNode.contains(r))return r;delete j[t]}else delete j[t]}let o=document.getElementById(t);if(o&&(e.contains(o)||e.parentNode&&e.parentNode.contains(o)))return j[t]=o,o;let n=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",t];for(let r of n){let i=e.querySelector(r);if(i||e.parentNode&&(i=e.parentNode.querySelector(r),i))return j[t]=i,i}return null}var P=new WeakMap;function U(e,t,o){if(!e||t===null||P.has(e)&&P.get(e).value===t)return;let n=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&n&&typeof n=="object"&&"default"in n&&(n=n.default),Array.isArray(n)){let r=document.createDocumentFragment();n.forEach(i=>{let s=typeof i=="function"?i():i;if(s&&typeof s.mount=="function"){let f=document.createElement("div");s.isMounted()&&s.unmount(),s.mount(f),o._mountedChildren.push(s),f.firstElementChild&&r.appendChild(f.firstElementChild)}else if(s?.el instanceof HTMLElement)r.appendChild(s.el);else if(s instanceof Node)r.appendChild(s);else if(typeof s=="string"){let f=document.createElement("div");f.innerHTML=s,f.firstElementChild&&r.appendChild(f.firstElementChild)}}),e.replaceWith(r),P.set(e,{value:t});return}if(n&&typeof n.mount=="function"){let r=document.createElement("div");e.replaceWith(r),n.isMounted()&&n.unmount(),n.mount(r),n.el===e&&(n.el=r),o._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let r=document.createElement("div");r.innerHTML=n;let i=document.createDocumentFragment();for(;r.firstChild;)i.appendChild(r.firstChild);e.replaceWith(i)}else e.replaceWith(document.createTextNode(""));P.set(e,{value:t})}function F(e,t,o,n){let i={...typeof n=="function"?n.call(o,t):typeof n=="object"?n:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(i={default:t.slots}),t.children!==void 0?i.default=t.children:i.default||(i.default=null),Object.entries(i).forEach(([s,f])=>{let l;if(s==="default"||s==="children"?l=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):l=H(e.el,s),!l||f==null)return;let p=l.querySelector("[data-comp-root='"+e._id+"']");!p&&f&&typeof f.mount=="function"&&(p=document.createElement("div"),p.setAttribute("data-comp-root",e._id),l.innerHTML="",l.appendChild(p)),U(p||l,f,o)})}var ce=1;function le(e,t={}){let o,n={},r=typeof e;r==="object"&&r!=="funcion"&&e!==null&&!Array.isArray(e)?(o=e.render,n={...e},delete n.render):(o=e,n=t||{});let{state:i={},on:s={},slots:f={},onMount:l,onUnmount:p,onBeforeMount:A,onBeforeUnmount:S,onUpdate:N}=n,h=null,g=!1,d={},w={},$=null,M=!1,C=[],v=i,_=null,y=!1,q={...i},x=!1,L=[],b=c=>{v=typeof c=="function"?c(v):{...v,...c},x||(x=!0,$={...d},queueMicrotask(()=>{x=!1,m($),$=null}))},a={refs:{},setState:b,props:d,isMounted:()=>g,_mountedChildren:[],mount(c,u={}){if(g||M)return;let E=typeof c=="string"?document.querySelector(c):c;if(!E)throw new Error(`No element matches: ${c}`);D(A,()=>{M=!0,h=E,h.setAttribute("data-comp-root",m._id),d={...d,...u},w={...d},a.props=d,m(d),y||(g=!0,l?.call(m),z())})},update(c={}){if(!g)return;let u=c.props?c.props:c,E=u.on;E&&E!==s&&(s=E);let T={...d,...u};w={...d},d=T,a.props=d,m(d)},render(c={}){d={...d,...c},a.props=d;let u=typeof o=="function"?o.call(a,{state:v,setState:b,props:d,refs:a.refs}):o;return u&&(u=new String(u),u._id=m._id),u},_resetInternal:()=>{a._mountedChildren.forEach(c=>{c&&typeof c.unmount=="function"&&c.unmount()}),a._mountedChildren=[],_=null,y=!1,h=null,g=!1,M=!1,C=[],d={},w={},v={...q}},unmount(){if(!g||!h)return;D(S,()=>{h.firstChild&&(_=h.firstChild.cloneNode(!0),h.removeChild(h.firstChild)),C.forEach(({node:u,type:E,listener:T})=>{u.removeEventListener(E,T)}),C=[],L.forEach(u=>u()),L=[],g=!1,M=!1,y=!0,p?.call(a),a._resetInternal&&a._resetInternal()})},get renderFn(){return o},get el(){return h},get state(){return v}};a.ref=function(c){return H(this.el,c)},a.refs=new Proxy({},{get(c,u){return a.ref(u)}}),a.action=function(c){return c.target.closest("[data-action]")?.dataset.action||null};function z(){L=[],Object.entries(s).forEach(([c,u])=>{if(c.includes("::")){let E=u.bind(a),T=W.subscribe(c,E);L.push(T)}})}function X(c){d={...a.props,...c},a.props=d,!h||h.isConnected;let u=a.render(d);if(u===null||u===""){!y&&h&&h.firstChild?(_=h.firstChild.cloneNode(!0),D(S,()=>{h.innerHTML="",C.forEach(({node:T,type:Z,listener:G})=>{T.removeEventListener(Z,G)}),C=[],g=!1,y=!0,p?.call(a)})):y=!0;return}if(y&&_){h.appendChild(_),_=null,y=!1,g=!0,O(a,h,s,C),l?.call(a);return}R(h,u),F(m,d,a,f),O(a,h,s,C),g&&N&&N.call(a,w),y=!1}function D(c,u){c?c.length?c.call(a,u):Promise.resolve(c.call(a)).then(u):u()}function m(c={}){return m._render(c),m}return Object.assign(m,a),["el","props","state","setState"].forEach(c=>{Object.defineProperty(m,c,{get(){return a[c]},enumerable:!0})}),m._render=X,m.render=a.render,m._id=ce++,m}function ae(e,t,o=n=>n.id??n.key??n){return e.map((n,r)=>{let i=o(n,r),s=t(n,r);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(i).replace(/"/g,"&quot;")}"`):s}).join("")}return re(fe);})();
//# sourceMappingURL=magnumjs-micro-ui.js.map
