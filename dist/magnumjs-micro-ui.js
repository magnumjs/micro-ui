/*!
 * @magnumjs/micro-ui v1.1.2
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var V=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var ne=(e,t)=>{for(var o in t)V(e,o,{get:t[o],enumerable:!0})},re=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ee(t))!te.call(e,s)&&s!==o&&V(e,s,{get:()=>t[s],enumerable:!(n=Y(t,s))||n.enumerable});return e};var oe=e=>re(V({},"__esModule",{value:!0}),e);var ye={};ne(ye,{__VERSION__:()=>fe,createComponent:()=>he,renderList:()=>pe,useCurrentComponent:()=>me});function k(e,t){if(!e)return!1;let o=document.createElement("div");if(o.innerHTML=t,o.children.length===0&&o.textContent)return e.textContent=o.textContent,!0;let n=Array.from(o.children),s=Array.from(e.children),c=new Map,r=new Map;for(let u of n){let h=u.dataset.key;h&&c.set(h,u)}for(let u of s){let h=u.dataset.key;h&&r.set(h,u)}let a=0;for(let u of n){let h=u.dataset.key,_=e.children[a];if(h&&r.has(h)){let E=r.get(h);K(E,u),E!==_&&e.insertBefore(E,_||null),r.delete(h)}else e.insertBefore(u,_||null);a++}for(let u of r.values())u.remove();for(;e.children.length>n.length;)e.lastChild.remove();return!0}function K(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}se(e,t),ie(e,t)}function se(e,t){let o=e.attributes,n=t.attributes;for(let{name:s}of Array.from(o))t.hasAttribute(s)||e.removeAttribute(s);for(let{name:s,value:c}of Array.from(n))e.getAttribute(s)!==c&&e.setAttribute(s,c)}function ie(e,t){let o=Array.from(e.childNodes),n=Array.from(t.childNodes),s=Math.max(o.length,n.length);for(let c=0;c<s;c++){let r=o[c],a=n[c];if(!a&&r){e.removeChild(r);continue}if(!r&&a){e.appendChild(a.cloneNode(!0));continue}ce(r,a)}}function ce(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?K(e,t):e.replaceWith(t.cloneNode(!0))}}function H(e,t,o,n){if(!t||!o)return;let s=t.firstElementChild;if(!s)return;function c(r,a=!1){if(r&&!(!a&&r.hasAttribute&&r.hasAttribute("data-comp-root"))){Object.entries(o).forEach(([u,h])=>{let _=u.includes(":"),[E,L]=_?u.split(":"):u.split(" "),p=E==="*";(p?["click","input","change","keydown","submit"]:[E]).forEach(d=>{let T=w=>{let A=w.target.closest("[data-action]"),M=A?.dataset.action||"",S=A?.dataset.args,C=M.split(":"),B=C[0],j=[];if(S)try{let b=JSON.parse(S);j=Array.isArray(b)?b:[b]}catch{console.warn("Invalid JSON in data-args:",S)}else j=C.slice(1);let x={event:w,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:B,args:j};if(_&&A&&(L==="*"||L===B)&&(p||w.type===E))return h.call(e,x);if(!_){let b=w.target.closest(L||"*");if(b&&s.contains(b))return h.call(e,x)}},$=`__microBound_${d}_${u}`;s[$]||(s.addEventListener(d,T),s[$]=!0,n.push({node:s,type:d,listener:T}))})});for(let u of r.children)c(u,!1)}}c(t,!0)}function D(){let e=new Map;return{subscribe(t,o){e.has(t)||e.set(t,new Set);let n=e.get(t);return n.add(o),()=>n.delete(o)},emit(t,o){let n=e.get(t);if(n)for(let s of n)s(o)},clear(){e.clear()}}}function le(e){let t=e,o=new Set;function n(r){typeof t=="object"&&t!==null&&typeof r=="object"&&r!==null&&!Array.isArray(t)&&!Array.isArray(r)?t={...t,...r}:t=typeof r=="function"?r(t):r,o.forEach(a=>a(t))}function s(r){return o.add(r),r(t),()=>o.delete(r)}function c(){return t}return{get:c,setState:n,getState:c,subscribe:s}}var O=D(),P=new Map;function ae(e,t={}){if(!P.has(e)){let o=le(t),n={...o,emit(s,c){o.setState(c),O.emit(`${e}::${s}`,o.getState())},on(s,c){return O.subscribe(`${e}::${s}`,c)}};P.set(e,n)}return P.get(e)}ae.clear=()=>P.clear();var z=new WeakMap;function W(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let o=z.get(e);if(o||(o={},z.set(e,o)),o[t]){let c=o[t];if(c.isConnected&&e.contains(c))return c;delete o[t]}let n=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function s(c,r){if(c===r)return!0;let a=c.closest("[data-comp-root]");return!a||a===r}for(let c of n){let r=null;try{let a=e.querySelectorAll(c);for(let u of a)if(s(u,e)){r=u;break}}catch{throw new Error(`ref() invalid selector: '${c}' for ref name '${t}'`)}if(r)return o[t]=r,r}return null}var I=new WeakMap;function N(e,t,o){if(!e||t===null||I.has(e)&&I.get(e).value===t)return;let n=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&n&&typeof n=="object"&&"default"in n&&(n=n.default),Array.isArray(n)){let s=document.createDocumentFragment();n.forEach(c=>{let r=typeof c=="function"?c():c;if(r&&typeof r.mount=="function"){let a=document.createElement("div");if(r.isMounted())r.update(),r.el instanceof HTMLElement&&s.appendChild(r.el);else for(r.mount(a),o._mountedChildren.includes(r)||o._mountedChildren.push(r);a.firstChild;)s.appendChild(a.firstChild)}else if(r?.el instanceof HTMLElement)s.appendChild(r.el);else if(r instanceof Node)s.appendChild(r);else if(typeof r=="string"){let a=document.createElement("div");for(a.innerHTML=r;a.firstChild;)s.appendChild(a.firstChild)}}),e.replaceWith(s),I.set(e,{value:t});return}if(n&&typeof n.mount=="function"){if(n.isMounted())n.update(),n.el!==e&&e.replaceWith(n.el);else{let s=document.createElement("div");e.replaceWith(s),n.mount(s),n.el===e&&(n.el=s)}o._mountedChildren.includes(n)||o._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let s=document.createElement("div");s.innerHTML=n;let c=document.createDocumentFragment();for(;s.firstChild;)c.appendChild(s.firstChild);e.replaceWith(c)}else e.replaceWith(document.createTextNode(""));I.set(e,{value:t})}function F(e,t,o,n){let c={...typeof n=="function"?n.call(o,t):typeof n=="object"?n:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(c={default:t.slots}),t.children!==void 0?c.default=t.children:c.default||(c.default=null),Object.entries(c).forEach(([r,a])=>{let u;if(r==="default"||r==="children"?u=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):u=W(e.el,r),!u||a==null)return;let h=u.querySelector("[data-comp-root='"+e._id+"']");!h&&a&&typeof a.mount=="function"&&(h=document.createElement("div"),h.setAttribute("data-comp-root",e._id),u.innerHTML="",u.appendChild(h)),N(h||u,a,o)})}var ue=1,fe="1.1.2";function de(e,t){for(let o of Object.keys(e))o in t||Object.defineProperty(t,o,{get(){return e[o]},enumerable:!0})}var G=null;function he(e,t={}){let o,n={},s=typeof e;s==="object"&&s!=="funcion"&&e!==null&&!Array.isArray(e)?(o=e.render,n={...e},delete n.render):(o=e,n=t||{});let{state:c={},on:r={},slots:a={},onMount:u,onUnmount:h,onBeforeMount:_,onBeforeUnmount:E,onUpdate:L}=n,p=null,g=!1,d={},T={},$=null,w=!1,A=[],M=c,S=null,C=!1,B={...c},j=!1,x=[],b=D(),J=i=>{M=typeof i=="function"?i(M):{...M,...i},j||(j=!0,$={...d},queueMicrotask(()=>{j=!1,m($),$=null}))},f={refs:{},setState:J,props:d,isMounted:()=>g,_mountedChildren:[],_unmountCbs:[],onUnmount(i){typeof i=="function"&&this._unmountCbs.push(i)},emit(i,l){b.emit(i,l)},onEmit(i,l){let y=b.subscribe(i,l);return this.onUnmount(y),y},emitGlobal(i,l){O.emit(i,l)},onEmitGlobal(i,l){let y=O.subscribe(i,l);return this.onUnmount(y),y},mount(i,l={}){if(g||w)return;let y=typeof i=="string"?document.querySelector(i):i;if(!y)throw new Error(`No element matches: ${i}`);q(_,()=>{w=!0,p=y,p.setAttribute("data-comp-root",m._id+"-"+(m.name||o.name||"")),d={...d,...l},T={...d},f.props=d,m(d),C||(g=!0,u?.call(m),X())})},update(i={}){if(!g)return;let l=i.props?i.props:i,y=l.on;y&&y!==r&&(r=y);let v={...d,...l};T={...d},d=v,f.props=d,m(d)},render(i={}){d={...d,...i},f.props=d;let l=typeof o=="function"?o.call(f,{state:M,setState:J,props:d,refs:f.refs}):o;return l&&(l=new String(l),l._id=m._id),de(f,m),l},_resetInternal:()=>{f._mountedChildren.forEach(i=>{i&&typeof i.unmount=="function"&&i.unmount()}),f._mountedChildren=[],S=null,C=!1,p=null,g=!1,w=!1,A=[],d={},T={},M={...B}},unmount(){if(!g||!p)return;q(E,()=>{p.firstChild&&(S=p.firstChild.cloneNode(!0),p.removeChild(p.firstChild));for(let l of this._unmountCbs)try{l()}catch(y){console.error(y)}this._unmountCbs=[],b.clear(),A.forEach(({node:l,type:y,listener:v})=>{l.removeEventListener(y,v)}),A=[],x.forEach(l=>l()),x=[],g=!1,w=!1,C=!0,h?.call(f),f._resetInternal&&f._resetInternal()})},get renderFn(){return o},get el(){return p},get state(){return M}};f.ref=function(i){return W(this.el,i)},f.refs=new Proxy({},{get(i,l){return f.ref(l)}}),f.action=function(i){return i.target.closest("[data-action]")?.dataset.action||null};function X(){x=[],Object.entries(r).forEach(([i,l])=>{if(i.includes("::")){let y=l.bind(f),v=O.subscribe(i,y);x.push(v)}})}function Z(i){d={...f.props,...i},f.props=d,!p||p.isConnected;let l=f.render(d);if(l===null||l===""){!C&&p&&p.firstChild?(S=p.firstChild.cloneNode(!0),q(E,()=>{p.innerHTML="",A.forEach(({node:v,type:Q,listener:R})=>{v.removeEventListener(Q,R)}),A=[],g=!1,C=!0,h?.call(f)})):C=!0;return}if(C&&S){p.appendChild(S),S=null,C=!1,g=!0,H(f,p,r,A),u?.call(f);return}return k(p,l),F(m,d,f,a),H(f,p,r,A),g&&L&&L.call(f,T),C=!1,l}function q(i,l){i?i.length?i.call(f,l):Promise.resolve(i.call(f)).then(l):l()}let U="";function m(i={}){return G=m,U=m._render(i),G=null,m}return m.toString=function(){return U?String(U):""},Object.assign(m,f),["el","props","state","setState"].forEach(i=>{Object.defineProperty(m,i,{get(){return f[i]},enumerable:!0,configurable:!1})}),m._render=Z,m.render=f.render,m._id=ue++,m}function pe(e,t,o=n=>n.id??n.key??n){return e.map((n,s)=>{let c=o(n,s),r=t(n,s);return typeof r=="string"?r.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(c).replace(/"/g,"&quot;")}"`):r}).join("")}function me(){return G}return oe(ye);})();
//# sourceMappingURL=magnumjs-micro-ui.js.map
