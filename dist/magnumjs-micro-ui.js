/*!
 * @magnumjs/micro-ui v1.9.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var G=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var fe=Object.prototype.hasOwnProperty;var de=(e,t)=>{for(var r in t)G(e,r,{get:t[r],enumerable:!0})},pe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ue(t))!fe.call(e,i)&&i!==r&&G(e,i,{get:()=>t[i],enumerable:!(n=ae(t,i))||n.enumerable});return e};var he=e=>pe(G({},"__esModule",{value:!0}),e);var Me={};de(Me,{__VERSION__:()=>Ae,createComponent:()=>oe,getComponentById:()=>Z,globalComponentRegistry:()=>D,registerComponent:()=>ne,renderList:()=>te,unregisterComponent:()=>re,useCurrentComponent:()=>Ee});function K(e,t){if(!e)return!1;let r=document.createElement("div");if(r.innerHTML=t,r.children.length===0&&e.children.length===0&&r.textContent)return e.textContent!==r.textContent&&(e.textContent=r.textContent),!0;let n=Array.from(r.children),i=Array.from(e.children),u=new Map,c=new Map;for(let s of n){let l=s.dataset.key;l&&u.set(l,s)}for(let s of i){let l=s.dataset.key;l&&c.set(l,s)}let a=0;for(let s of n){let l=s.dataset.key,b=e.children[a];if(l&&c.has(l)){let _=c.get(l);_.hasAttribute("data-comp-root")||R(_,s),_!==b&&e.insertBefore(_,b||null),c.delete(l)}else e.insertBefore(s,b||null);a++}for(let s of c.values())s.hasAttribute("data-comp-root")||s.remove();for(;e.children.length>n.length;){let s=e.lastChild;if(s?.hasAttribute?.("data-comp-root"))break;s.remove()}return!0}function R(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}me(e,t),!e.hasAttribute("data-comp-root")&&be(e,t)}function me(e,t){let r=e.attributes,n=t.attributes;for(let{name:i}of Array.from(r))t.hasAttribute(i)||e.removeAttribute(i);for(let{name:i,value:u}of Array.from(n))e.getAttribute(i)!==u&&e.setAttribute(i,u)}function be(e,t){let r=Array.from(e.childNodes),n=Array.from(t.childNodes),i=Math.max(r.length,n.length);for(let u=0;u<i;u++){let c=r[u],a=n[u];if(!a&&c){if(c.nodeType===1&&c.hasAttribute("data-comp-root"))continue;e.removeChild(c);continue}if(!c&&a){e.appendChild(a.cloneNode(!0));continue}ye(c,a)}}function ye(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?R(e,t):e.replaceWith(t.cloneNode(!0))}}function O(e,t,r,n){if(!t||!t.children[0]||!r)return;let i=t.children.length>1?t:t.children[0];function u(a,s){for(let l=a;l&&l!==s.parentNode;l=l.parentElement)if(!(!l||!l.hasAttributes||!l.hasAttributes())){for(let b of l.attributes)if(b.name==="data-action"||b.name.startsWith("data-action-"))return l}return null}function c(a,s=!1){if(a&&!(!s&&a.hasAttribute&&a.hasAttribute("data-comp-root"))){Object.entries(r).forEach(([l,b])=>{let _=l.includes(":"),[$,L]=_?l.split(":"):l.split(" "),m=$==="*";(m?["click","input","change","keydown","submit"]:[$]).forEach(h=>{let T=S=>{let g=u(S.target,i),v="",x="";if(g){let A=`data-action-${S.type}`,q=`data-args-${S.type}`;v=g.getAttribute(A)??g.getAttribute("data-action")??"",x=g.getAttribute(q)??g.getAttribute("data-args")??""}let E=v.split(":"),P=E[0],I=[];if(x)try{let A=JSON.parse(x);I=Array.isArray(A)?A:[A]}catch{console.warn("Invalid JSON in data-args:",x)}else I=E.slice(1);let H={...S.target.dataset,event:S,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:P,args:I};if(_&&g&&(L==="*"||L===P)&&(m||S.type===$))return b.call(e,H);if(!_){let A=S.target.closest(L||"*");return A&&i.contains(A)?b.call(e,H):void 0}},B=`__microBound_${h}_${l}`;i[B]||(i.addEventListener(h,T),i[B]=!0,n.push({node:i,type:h,listener:T}))})});for(let l of a.children)c(l,!1)}}c(t,!0)}function F(){let e=new Map;return{subscribe(t,r){e.has(t)||e.set(t,new Set);let n=e.get(t);return n.add(r),()=>n.delete(r)},emit(t,r){let n=e.get(t);if(n)for(let i of n)i(r)},clear(){e.clear()}}}function _e(e){let t=e,r=new Set;function n(c){typeof t=="object"&&t!==null&&typeof c=="object"&&c!==null&&!Array.isArray(t)&&!Array.isArray(c)?t={...t,...c}:t=typeof c=="function"?c(t):c,r.forEach(a=>a(t))}function i(c){return r.add(c),c(t),()=>r.delete(c)}function u(){return t}return{get:u,setState:n,getState:u,subscribe:i}}var U=F(),N=new Map;function Ce(e,t={}){if(!N.has(e)){let r=_e(t),n={...r,emit(i,u){r.setState(u),U.emit(`${e}::${i}`,r.getState())},on(i,u){return U.subscribe(`${e}::${i}`,u)}};N.set(e,n)}return N.get(e)}Ce.clear=()=>N.clear();var Y=new WeakMap;function W(e,t){if(!e)return null;if(!e.hasAttribute("data-comp-root"))throw new Error("ref() must be called with a component root element");let r=Y.get(e);if(r||(r={},Y.set(e,r)),r[t]){let c=r[t];if(c.isConnected&&e.contains(c))return c;delete r[t]}let n=e.querySelector(`[data-key="${t}"]`);if(n&&n._componentInstance)return r[t]=n._componentInstance,n._componentInstance;let i=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",`${t}`,`#${t}`];function u(c,a){if(c===a)return!0;let s=c.closest("[data-comp-root]");return!s||s===a}for(let c of i){let a=null;try{let s=e.querySelectorAll(c);for(let l of s)if(u(l,e)){a=l;break}}catch{throw new Error(`ref() invalid selector: '${c}' for ref name '${t}'`)}if(a)return r[t]=a,a}return null}var V=new WeakMap;function J(e,t,r){if(!e||t===null||V.has(e)&&V.get(e).value===t)return;let n=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&n&&typeof n=="object"&&"default"in n&&(n=n.default),Array.isArray(n)){let i=e.parentNode;if(!i)return;let u={};Array.from(i.children).forEach(a=>{let s=a.getAttribute&&a.getAttribute("data-key");s!=null&&(u[s]=a)});let c=[];n.forEach(a=>{let s=typeof a=="function"?a():a,l=null,b=s?.props?.key??(s?.el?.getAttribute&&s.el.getAttribute("data-key"));if(b!=null&&u[b])l=u[b],s&&typeof s.update=="function"&&s.update();else if(s&&typeof s.mount=="function"){let _=document.createElement("div");s.mount(_),l=s.el instanceof HTMLElement?s.el:_,r._mountedChildren.includes(s)||r._mountedChildren.push(s)}else if(s?.el instanceof HTMLElement)l=s.el;else if(s instanceof Node)l=s;else if(typeof s=="string"){let _=document.createElement("div");_.innerHTML=s,l=_.firstChild}l&&c.push(l)}),i.contains(e)&&i.removeChild(e),c.forEach((a,s)=>{i.children[s]!==a&&i.insertBefore(a,i.children[s]||null)}),Array.from(i.children).forEach(a=>{c.includes(a)||i.removeChild(a)}),V.set(e,{value:t});return}if(n&&typeof n.mount=="function"){if(n.isMounted())n.update(),n.el!==e&&e.replaceWith(n.el);else{let i=document.createElement("div");e.replaceWith(i),n.mount(i),n.el===e&&(n.el=i)}r._mountedChildren.includes(n)||r._mountedChildren.push(n)}else if(n?.el instanceof HTMLElement)e.replaceWith(n.el);else if(n instanceof Node)e.replaceWith(n);else if(typeof n=="string"){let i=document.createElement("div");i.innerHTML=n;let u=document.createDocumentFragment();for(;i.firstChild;)u.appendChild(i.firstChild);e.replaceWith(u)}else e.replaceWith(document.createTextNode(""));V.set(e,{value:t})}function X(e,t,r,n){let u={...typeof n=="function"?n.call(r,t):typeof n=="object"?n:{},...t.slots||{}};(typeof t.slots=="function"||Array.isArray(t.slots))&&(u={default:t.slots}),t.children!==void 0?u.default=t.children:u.default||(u.default=null),(e.el?.querySelectorAll("[data-comp]")||[]).forEach(a=>{let s=a.getAttribute("data-comp");if(!s)return;let l=Z(+s);l&&(a.setAttribute("data-ref",s),u[s]||(l._fromSlotHydration=!0,u[s]=l({...l._prevProps,...a.dataset}),l._fromSlotHydration=!1))}),Object.entries(u).forEach(([a,s])=>{let l;if(a==="default"||a==="children"?l=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):l=W(e.el,a),!l||s==null)return;let b=l.querySelector("[data-comp-root='"+e._id+"']");!b&&s&&typeof s.mount=="function"&&(b=document.createElement("div"),b.setAttribute("data-comp-root",e._id),l.innerHTML="",l.appendChild(b));let _=b||l;s._id&&(s._fromSlotHydration=!0),J(_,s,r),s._id&&(s._fromSlotHydration=!1)})}function Q(e,t){if(!t)return;t.querySelectorAll("*").forEach(n=>{Array.from(n.attributes).forEach(i=>{if(!i.name.startsWith("data-action-"))return;let u=i.name.slice(12),c=i.value;if(!c)return;let a=`${u}:${c}`;if(typeof e.on[a]!="function"){if(typeof e.on[c]=="function"){e.on[a]=e.on[c].bind(e);return}typeof e[c]=="function"&&(e.on[a]=e[c].bind(e))}})})}function j(e,t,r=!0,n){for(let i of e)try{i.call(n,t)}catch(u){console.error(u)}r&&(e.length=0)}function z(e,t,r){if(Array.isArray(e)){let i=function(){if(n<e.length){let u=e[n++];try{u.length?u.call(r,i):Promise.resolve(u.call(r)).then(i).catch(c=>{console.error(c),i()})}catch(c){console.error(c),i()}}else t()},n=0;i()}else if(e)try{e.length?e.call(r,t):Promise.resolve(e.call(r)).then(t).catch(n=>{console.error(n),t()})}catch(n){console.error(n),t()}else t()}function ee(e,t){for(let r of Object.keys(e))r in t||Object.defineProperty(t,r,{get(){return e[r]},enumerable:!0})}function te(e,t,r=n=>n.id??n.key??n){return e.map((n,i)=>{let u=r(n,i),c=t(n,i);return typeof c=="string"?c.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(u).replace(/"/g,"&quot;")}"`):c}).join("")}var ge=1,Ae="1.9.0",D=new Map;function ne(e){e._id&&D.set(e._id,e)}function re(e){e._id&&D.delete(e._id)}function Z(e){return D.get(e)}var w=null;function Se(e,t={}){let r=e._frozenTemplate,n=oe(r.renderFn,r.options);return n._initialProps=t,n._templateSource=e,n}function oe(e,t={}){let r,n={},i=typeof e;i==="object"&&i!=="function"&&e!==null&&!Array.isArray(e)?(r=e.render,n={...e},delete n.render):(r=e,n=t||{});let{state:u={},on:c={},slots:a={},onMount:s,onUnmount:l,onBeforeMount:b,onBeforeUnmount:_,onUpdate:$,...L}=n,m=null,M=!1,h={},T={},B=null,S=!1,g=[],v=u,x=null,E=!1,P={...u},I=!1,H=[],A=F(),q=o=>{v=typeof o=="function"?o(v):{...v,...o},I||(I=!0,B={...h},queueMicrotask(()=>{I=!1,p(B),B=null}))},f={refs:{},on:function(o,d){if(o&&d){let y=`h${p._renderIndex++}`;return p.addEvent(`${o} [data-ref=${y}]`,d),`data-ref="${y}"`}},setState:q,props:h,_childCallCache:{},_childCallIndex:0,isMounted:()=>M,_renderIndex:0,_mountedChildren:[],_unmountCbs:[],_mountCbs:[],_beforeMountCbs:[],_updateCbs:[],_beforeUnmountCbs:[],onMount(o){typeof o=="function"&&this._mountCbs.push(o)},onUnmount(o){typeof o=="function"&&this._unmountCbs.push(o)},onBeforeMount(o){typeof o=="function"&&this._beforeMountCbs.push(o)},onBeforeUnmount(o){typeof o=="function"&&this._beforeUnmountCbs.push(o)},onUpdate(o){typeof o=="function"&&this._updateCbs.push(o)},emit(o,d){A.emit(o,d)},onEmit(o,d){let y=A.subscribe(o,d);return this.onUnmount(y),y},emitGlobal(o,d){U.emit(o,d)},onEmitGlobal(o,d){let y=U.subscribe(o,d);return this.onUnmount(y),y},addEvent(o,d){f.on[o]||(f.on[o]=d)},mount(o,d={}){if(M||S)return;let y=typeof o=="string"?document.querySelector(o):o;if(!y)throw new Error(`No element matches: ${o}`);let C=()=>{S=!0,m=y,m.setAttribute("data-comp-root",p._id+"-"+(r.name||"")),h={...h,...d},T={...h},f.props=h,m._componentInstance=p,h.key&&m.setAttribute("data-key",h.key),p(h),E||(M=!0,j(f._mountCbs,void 0,!1,p),ie())};z(f._beforeMountCbs,C,p)},update(o={}){if(!M)return;let d=o.props?o.props:o,y=d.on;y&&Object.assign(f.on,y);let C={...h,...d};T={...h},h=C,f.props=h,h.key!==T.key&&m.setAttribute("data-key",h.key),p(h)},render(o={}){h={...h,...o},f.props=h;let d=typeof r=="function"?r.call(f,{state:v,setState:q,props:h,refs:f.refs}):r;return d&&(d=new String(d),d._id=p._id),ee(f,p),d},_resetInternal:()=>{f._mountedChildren.forEach(o=>{o&&typeof o.unmount=="function"&&o.unmount()}),f._mountedChildren=[],x=null,E=!1,m=null,M=!1,S=!1,g=[],h={},T={},v={...P}},unmount(){if(!M||!m)return;let o=()=>{m.firstChild&&(x=m.firstChild.cloneNode(!0),m.removeChild(m.firstChild)),j(f._unmountCbs,void 0,!0,p),A.clear(),g.forEach(({node:d,type:y,listener:C})=>{d.removeEventListener(y,C)}),g=[],H.forEach(d=>d()),H=[],M=!1,S=!1,E=!0,re(p),f._resetInternal&&f._resetInternal()};z(f._beforeUnmountCbs,o,f)},get renderFn(){return r},get el(){return m},get state(){return v}};s&&f.onMount(s),l&&f.onUnmount(l),b&&f.onBeforeMount(b),_&&f.onBeforeUnmount(_),$&&f.onUpdate($),Object.assign(f.on,c),f.ref=function(o){return W(this.el,o)},f.refs=new Proxy({},{get(o,d){return f.ref(d)}});function ie(){H=[],Object.entries(f.on).forEach(([o,d])=>{o.includes("::")?p.onEmitGlobal(o,d.bind(f)):!o.includes(" ")&&!o.includes("*")&&!o.includes(":")&&p.onEmit(o,d.bind(f))})}function se(o){h={...f.props,...o},f.props=h,!m||m.isConnected;let d=f.render(h);if(d===null||d===""){!E&&m&&m.firstChild?(x=m.firstChild.cloneNode(!0),z(f._beforeUnmountCbs,()=>{m.innerHTML="",g.forEach(({node:C,type:ce,listener:le})=>{C.removeEventListener(ce,le)}),g=[],M=!1,E=!0,j(f._unmountCbs,void 0,!0,p)},f)):E=!0;return}if(E&&x){m.appendChild(x),x=null,E=!1,M=!0,O(f,m,f.on,g),j(f._mountCbs,void 0,!1,p);return}return K(m,d),X(p,h,f,a),Q(p,m),O(f,m,f.on,g),M&&j(f._updateCbs,T,!1,p),E=!1,d}let k="";function p(o={}){if(!p._fromSlotHydration&&w&&w!==p){let d=w;d._childCallIndex==null&&(d._childCallIndex=0),d._childCallCache||(d._childCallCache={});let y=o.key!=null?o.key:d._childCallIndex++,C=d._childCallCache[y];return!C||C._templateSource!==p?(C=Se(p,o),C._prevProps={...o},C.toString=()=>`<div data-comp="${C._id}"></div>`,d._childCallCache[y]=C):(C._prevProps={...o},C.update(o)),C}return w=p,p._renderIndex=0,p._childCallIndex=0,p._prevProps=o,k=p._render(o),w=null,p}return p.toString=function(){return!k||String(k)===""&&!p.isMounted()&&w!==null&&w._id!==p._id?String(p._id):k?String(k):""},Object.assign(p,f,L),["el","props","state","setState"].forEach(o=>{Object.defineProperty(p,o,{get(){return f[o]},enumerable:!0,configurable:!1})}),p._render=se,p.render=f.render,p._id=ge++,p.getId=()=>p._id,ne(p),p._frozenTemplate=Object.freeze({renderFn:r,options:{...n,state:{...P}}}),p}function Ee(){return w}return he(Me);})();
//# sourceMappingURL=magnumjs-micro-ui.js.map
