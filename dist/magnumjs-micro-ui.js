/*!
 * @magnumjs/micro-ui v1.0.21
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var V=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var te=(e,t)=>{for(var o in t)V(e,o,{get:t[o],enumerable:!0})},ne=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Y(t))!ee.call(e,n)&&n!==o&&V(e,n,{get:()=>t[n],enumerable:!(r=Q(t,n))||r.enumerable});return e};var re=e=>ne(V({},"__esModule",{value:!0}),e);var ue={};te(ue,{context:()=>H,createComponent:()=>le,createState:()=>J,renderList:()=>ae,shared:()=>K});function U(e,t){if(!e)return!1;let o=document.createElement("div");if(o.innerHTML=t,o.children.length===0&&o.textContent)return e.textContent=o.textContent,!0;let r=Array.from(o.children),n=Array.from(e.children),i=new Map,s=new Map;for(let a of r){let h=a.dataset.key;h&&i.set(h,a)}for(let a of n){let h=a.dataset.key;h&&s.set(h,a)}let d=0;for(let a of r){let h=a.dataset.key,v=e.children[d];if(h&&s.has(h)){let E=s.get(h);R(E,a),E!==v&&e.insertBefore(E,v||null),s.delete(h)}else e.insertBefore(a,v||null);d++}for(let a of s.values())a.remove();for(;e.children.length>r.length;)e.lastChild.remove();return!0}function R(e,t){if(e.tagName!==t.tagName){e.replaceWith(t.cloneNode(!0));return}oe(e,t),se(e,t)}function oe(e,t){let o=e.attributes,r=t.attributes;for(let{name:n}of Array.from(o))t.hasAttribute(n)||e.removeAttribute(n);for(let{name:n,value:i}of Array.from(r))e.getAttribute(n)!==i&&e.setAttribute(n,i)}function se(e,t){let o=Array.from(e.childNodes),r=Array.from(t.childNodes),n=Math.max(o.length,r.length);for(let i=0;i<n;i++){let s=o[i],d=r[i];if(!d&&s){e.removeChild(s);continue}if(!s&&d){e.appendChild(d.cloneNode(!0));continue}ie(s,d)}}function ie(e,t){if(!e.isEqualNode(t)){if(e.nodeType!==t.nodeType){e.replaceWith(t.cloneNode(!0));return}e.nodeType===Node.TEXT_NODE?e.nodeValue!==t.nodeValue&&(e.nodeValue=t.nodeValue):e.nodeType===Node.ELEMENT_NODE&&e.tagName===t.tagName?R(e,t):e.replaceWith(t.cloneNode(!0))}}function B(e,t,o,r){if(!t||!o)return;let n=t.firstElementChild;if(!n)return;function i(s,d=!1){if(s&&!(!d&&s.hasAttribute&&s.hasAttribute("data-component-root"))){Object.entries(o).forEach(([a,h])=>{let v=a.includes(":"),[E,$]=v?a.split(":"):a.split(" "),p=E==="*";(p?["click","input","change","keydown","submit"]:[E]).forEach(u=>{let M=_=>{let y=_.target.closest("[data-action]"),T=y?.dataset.action||"",S=y?.dataset.args,g=T.split(":"),O=g[0],x=[];if(S)try{let C=JSON.parse(S);x=Array.isArray(C)?C:[C]}catch{console.warn("Invalid JSON in data-args:",S)}else x=g.slice(1);let L={event:_,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:O,args:x};if(v&&y&&($==="*"||$===O)&&(p||_.type===E))return h.call(e,L);if(!v){let C=_.target.closest($||"*");if(C&&n.contains(C))return h.call(e,L)}},j=`__microBound_${u}_${a}`;n[j]||(n.addEventListener(u,M),n[j]=!0,r.push({node:n,type:u,listener:M}))})});for(let a of s.children)i(a,!1)}}i(t,!0)}function J(e){let t=e,o=new Set;function r(s){t=typeof s=="function"?s(t):{...t,...s},o.forEach(d=>d(t))}function n(s){return o.add(s),s(t),()=>o.delete(s)}function i(){return t}return{get:i,setState:r,getState:i,subscribe:n}}var W=new Map,H={subscribe(e,t){W.has(e)||W.set(e,new Set);let o=W.get(e);return o.add(t),()=>o.delete(t)},emit(e,t){let o=W.get(e);if(o)for(let r of o)r(t)},clear(){W.clear()}},q=new Map;function K(e,t={}){if(!q.has(e)){let o=J(t),r={...o,emit(n,i){o.setState(i),H.emit(`${e}::${n}`,o.getState())},on(n,i){return H.subscribe(`${e}::${n}`,i)}};q.set(e,r)}return q.get(e)}K.clear=()=>q.clear();var P=new WeakMap;function F(e,t,o){if(!e||t===null||P.has(e)&&P.get(e).value===t)return;let r=typeof t=="function"?t():t;if(e.nodeName==="SLOT"&&!e.hasAttribute("name")&&r&&typeof r=="object"&&"default"in r&&(r=r.default),Array.isArray(r)){let n=document.createDocumentFragment();r.forEach(i=>{let s=typeof i=="function"?i():i;if(s&&typeof s.mount=="function"){let d=document.createElement("div");s.mount(d),o._mountedChildren.push(s),d.firstElementChild&&n.appendChild(d.firstElementChild)}else if(s?.el instanceof HTMLElement)n.appendChild(s.el);else if(s instanceof Node)n.appendChild(s);else if(typeof s=="string"){let d=document.createElement("div");d.innerHTML=s,d.firstElementChild&&n.appendChild(d.firstElementChild)}}),e.replaceWith(n),P.set(e,{value:t});return}if(r&&typeof r.mount=="function"){let n=document.createElement("div");e.replaceWith(n),r.mount(n),o._mountedChildren.push(r)}else if(r?.el instanceof HTMLElement)e.replaceWith(r.el);else if(r instanceof Node)e.replaceWith(r);else if(typeof r=="string"){let n=document.createElement("div");n.innerHTML=r;let i=document.createDocumentFragment();for(;n.firstChild;)i.appendChild(n.firstChild);e.replaceWith(i)}else e.replaceWith(document.createTextNode(""));P.set(e,{value:t})}var N={};function D(e,t){if(!e)return null;if(N[t]){let n=N[t];if(n.isConnected){if(e.contains(n)||e.parentNode&&e.parentNode!==document.body&&e.parentNode.contains(n))return n;delete N[t]}else delete N[t]}let o=document.getElementById(t);if(o&&(e.contains(o)||e.parentNode&&e.parentNode.contains(o)))return N[t]=o,o;let r=[`[data-ref="${t}"]`,`[data-slot="${t}"]`,`slot[name="${t}"]`,"slot:not([name])",t];for(let n of r){let i=e.querySelector(n);if(i||e.parentNode&&(i=e.parentNode.querySelector(n),i))return N[t]=i,i}return null}var ce=0;function k(e,t,o,r){let i={...typeof r=="function"?r.call(o,t):typeof r=="object"?r:{},...t.slots||{}};t.children&&(i.default=t.children),Object.entries(i).forEach(([s,d])=>{let a;s==="default"||s==="children"?a=e.el?.querySelector('[data-ref="children"]')||e.el?.querySelector("slot:not([name])"):a=D(e.el,s),a&&F(a,d,o)})}function le(e,t={}){let o,r={},n=typeof e;n==="object"&&n!=="funcion"&&e!==null&&!Array.isArray(e)?(o=e.render,r={...e},delete r.render):(o=e,r=t||{});let{state:i={},on:s={},slots:d={},onMount:a,onUnmount:h,onBeforeMount:v,onBeforeUnmount:E,onUpdate:$}=r,p=null,A=!1,u={},M={},j=null,_=!1,y=[],T=i,S=null,g=!1,O={...i},x=!1,L=[],C=c=>{T=typeof c=="function"?c(T):{...T,...c},x||(x=!0,j={...u},queueMicrotask(()=>{x=!1,m(j),j=null}))},l={refs:{},setState:C,props:u,_mountedChildren:[],mount(c,f={}){if(A||_)return;let b=typeof c=="string"?document.querySelector(c):c;if(!b)throw new Error(`No element matches: ${c}`);I(v,()=>{_=!0,p=b,p.setAttribute("data-component-root","true"),u={...u,...f},M={...u},l.props=u,m(u),k(m,u,l,d),B(l,p,s,y),g||(A=!0,a?.call(m),z())})},update(c={}){if(!A)return;let f=c.props?c.props:c,b=f.on;b&&b!==s&&(s=b);let w={...u,...f};M={...u},u=w,l.props=u,m(u)},render(c={}){u={...u,...c},l.props=u;let f=typeof o=="function"?o.call(l,{state:T,setState:C,props:u,refs:l.refs}):o;return f&&(f=new String(f),f._id=m._id),f},_resetInternal:()=>{l._mountedChildren.forEach(c=>{c&&typeof c.unmount=="function"&&c.unmount()}),l._mountedChildren=[],S=null,g=!1,p=null,A=!1,_=!1,y=[],u={},M={},T={...O}},unmount(){if(!A||!p)return;I(E,()=>{p.firstChild&&(S=p.firstChild.cloneNode(!0),p.removeChild(p.firstChild)),y.forEach(({node:f,type:b,listener:w})=>{f.removeEventListener(b,w)}),y=[],L.forEach(f=>f()),L=[],A=!1,_=!1,g=!0,h?.call(l),l._resetInternal&&l._resetInternal()})},get renderFn(){return o},get el(){return p},get state(){return T}};l.ref=function(c){return D(this.el,c)},l.refs=new Proxy({},{get(c,f){return l.ref(f)}}),l.action=function(c){return c.target.closest("[data-action]")?.dataset.action||null};function z(){L=[],Object.entries(s).forEach(([c,f])=>{if(c.includes("::")){let b=f.bind(l),w=H.subscribe(c,b);L.push(w)}})}function X(c){u={...l.props,...c},l.props=u;let f=l.render(u);if(f===null||f===""){!g&&p&&p.firstChild?(S=p.firstChild.cloneNode(!0),I(E,()=>{p.innerHTML="",y.forEach(({node:w,type:Z,listener:G})=>{w.removeEventListener(Z,G)}),y=[],A=!1,g=!0,h?.call(l)})):g=!0;return}if(g&&S){p.appendChild(S),S=null,g=!1,A=!0,B(l,p,s,y),a?.call(l);return}g=!1,U(p,f),k(m,u,l,d),B(l,p,s,y),A&&$&&$.call(l,M)}function I(c,f){c?c.length?c.call(l,f):Promise.resolve(c.call(l)).then(f):f()}function m(c={}){return m._render(c),m}return Object.assign(m,l),["el","props","state","setState"].forEach(c=>{Object.defineProperty(m,c,{get(){return l[c]},enumerable:!0})}),m._render=X,m.render=l.render,m._id=ce++,m}function ae(e,t,o=r=>r.id??r.key??r){return e.map((r,n)=>{let i=o(r,n),s=t(r,n);return typeof s=="string"?s.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(i).replace(/"/g,"&quot;")}"`):s}).join("")}return re(ue);})();
//# sourceMappingURL=magnumjs-micro-ui.js.map
