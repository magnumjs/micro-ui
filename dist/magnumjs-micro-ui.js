/*!
 * @magnumjs/micro-ui v1.0.16
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUI=(()=>{var P=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var V=(e,s)=>{for(var t in s)P(e,t,{get:s[t],enumerable:!0})},W=(e,s,t,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of R(s))!D.call(e,i)&&i!==t&&P(e,i,{get:()=>s[i],enumerable:!(o=K(s,i))||o.enumerable});return e};var Z=e=>W(P({},"__esModule",{value:!0}),e);var Y={};V(Y,{context:()=>H,createComponent:()=>Q,createState:()=>B,renderList:()=>X,shared:()=>q});function A(e,s={}){if(typeof e!="string")return"";let{children:t={},slots:o={}}=s;function i(d,c){return d?t&&typeof t=="object"&&t[d]!=null?t[d]:o&&typeof o=="object"&&o[d]!=null?o[d]:c:t&&typeof t=="object"&&t.default!=null?t.default:o&&typeof o=="object"&&o.default!=null?o.default:typeof t=="string"?t:c}return e=e.replace(/<slot(?:\s+name="([^"]+)")?>([\s\S]*?)<\/slot>/gis,(d,c,p)=>i(c,p)),e=e.replace(/<([a-z]+)([^>]*)\sdata-slot="([^"]+)"([^>]*)>([\s\S]*?)<\/\1>/gis,(d,c,p,r,u,l)=>{let h=i(r,l);return`<${c}${p}${u}>${h}</${c}>`}),e}function I(e,s){if(!e)return!1;let t=document.createElement("div");t.innerHTML=s;let o=Array.from(t.children),i=Array.from(e.children),d=new Map,c=new Map;for(let r of o){let u=r.dataset.key;u&&d.set(u,r)}for(let r of i){let u=r.dataset.key;u&&c.set(u,r)}let p=0;for(let r of o){let u=r.dataset.key,l=e.children[p];if(u&&c.has(u)){let h=c.get(u);h.innerHTML!==r.innerHTML&&(h.innerHTML=r.innerHTML),h!==l&&e.insertBefore(h,l||null),c.delete(u)}else e.insertBefore(r,l||null);p++}for(let r of c.values())r.remove();for(;e.children.length>o.length;)e.lastChild.remove();return!0}function j(e,s,t,o){if(!s||!t)return;let i=s.firstElementChild;i&&Object.entries(t).forEach(([d,c])=>{let p=d.includes(":"),[r,u]=p?d.split(":"):d.split(" "),l=r==="*";(l?["click","input","change","keydown","submit"]:[r]).forEach(_=>{let C=b=>{let v=b.target.closest("[data-action]"),m=v?.dataset.action||"",T=v?.dataset.args,L=m.split(":"),$=L[0],M=[];if(T)try{let w=JSON.parse(T);M=Array.isArray(w)?w:[w]}catch{console.warn("Invalid JSON in data-args:",T)}else M=L.slice(1);let a={event:b,state:e.state,setState:e.setState,props:e.props,refs:e.refs,action:$,args:M};if(p&&v&&(u==="*"||u===$)&&(l||b.type===r))return c.call(e,a);if(!p){let w=b.target.closest(u||"*");if(w&&i.contains(w))return c.call(e,a)}},y=`__microBound_${_}_${d}`;i[y]||(i.addEventListener(_,C),i[y]=!0,o.push({node:i,type:_,listener:C}))})})}function B(e){let s=e,t=new Set;function o(c){s=typeof c=="function"?c(s):{...s,...c},t.forEach(p=>p(s))}function i(c){return t.add(c),c(s),()=>t.delete(c)}function d(){return s}return{get:d,setState:o,getState:d,subscribe:i}}var x=new Map,H={subscribe(e,s){x.has(e)||x.set(e,new Set);let t=x.get(e);return t.add(s),()=>t.delete(s)},emit(e,s){let t=x.get(e);if(t)for(let o of t)o(s)},clear(){x.clear()}},N=new Map;function q(e,s={}){if(!N.has(e)){let t=B(s),o={...t,emit(i,d){t.setState(d),H.emit(`${e}::${i}`,t.getState())},on(i,d){return H.subscribe(`${e}::${i}`,d)}};N.set(e,o)}return N.get(e)}q.clear=()=>N.clear();var G=0;function Q(e,{state:s={},on:t={},onMount:o,onUnmount:i,onBeforeMount:d,onBeforeUnmount:c,onUpdate:p}={}){let r=null,u=!1,l={},h={},_=null,C=!1,y=[],b=s,v=null,m=!1,T={...s},L=!1,$=[],M=n=>{b=typeof n=="function"?n(b):{...b,...n},L||(L=!0,_={...l},queueMicrotask(()=>{L=!1,g(_),_=null}))},a={refs:{},setState:M,props:l,mount(n,f={}){if(u||C)return;let S=typeof n=="string"?document.querySelector(n):n;if(!S)throw new Error(`No element matches: ${n}`);O(d,()=>{C=!0,r=S,l={...l,...f},h={...l},a.props=l,g(l),j(a,r,t,y),m||(u=!0,o?.call(g),w())})},update(n={}){if(!u)return;let f=n.props?n.props:n,S=f.on;S&&S!==t&&(t=S);let E={...l,...f};h={...l},l=E,a.props=l,g(l)},render(n={}){l={...l,...n},a.props=l;let f=typeof e=="function"?e.call(a,{state:b,setState:M,props:l,refs:a.refs}):e;return f=A(f,l),f&&(f=new String(f),f._id=g._id),f},_resetInternal:()=>{v=null,m=!1,r=null,u=!1,C=!1,y=[],l={},h={},b={...T}},unmount(){if(!u||!r)return;O(c,()=>{r.firstChild&&(v=r.firstChild.cloneNode(!0),r.removeChild(r.firstChild)),y.forEach(({node:f,type:S,listener:E})=>{f.removeEventListener(S,E)}),y=[],$.forEach(f=>f()),$=[],u=!1,C=!1,m=!0,i?.call(a),a._resetInternal&&a._resetInternal()})},get renderFn(){return e},get el(){return r},get state(){return b}};a.ref=function(n){return this.el&&(this.el.querySelector(`[data-ref="${n}"]`)||this.el.querySelector(n))||null},a.refs=new Proxy({},{get(n,f){return a.ref(f)}}),a.action=function(n){return n.target.closest("[data-action]")?.dataset.action||null};function w(){$=[],Object.entries(t).forEach(([n,f])=>{if(n.includes("::")){let S=f.bind(a),E=H.subscribe(n,S);$.push(E)}})}function k(n){l=n,a.props=l;let f=a.render(l);if(f===null||f===""){!m&&r&&r.firstChild?(v=r.firstChild.cloneNode(!0),O(c,()=>{r.innerHTML="",y.forEach(({node:E,type:z,listener:J})=>{E.removeEventListener(z,J)}),y=[],u=!1,m=!0,i?.call(a)})):m=!0;return}if(m&&v){r.appendChild(v),v=null,m=!1,u=!0,j(a,r,t,y),o?.call(a);return}m=!1,I(r,f),j(a,r,t,y),u&&p&&p.call(a,h)}function O(n,f){n?n.length?n.call(a,f):Promise.resolve(n.call(a)).then(f):f()}function g(n={}){return g._render(n)}return Object.assign(g,a),["el","props","state","setState"].forEach(n=>{Object.defineProperty(g,n,{get(){return a[n]},enumerable:!0})}),g._render=k,g.render=a.render,g._id=G++,g}function X(e,s,t=o=>o.id??o.key??o){return e.map((o,i)=>{let d=t(o,i),c=s(o,i);return typeof c=="string"?c.replace(/^<([a-zA-Z0-9-]+)/,`<$1 data-key="${String(d).replace(/"/g,"&quot;")}"`):c}).join("")}return Z(Y);})();
//# sourceMappingURL=magnumjs-micro-ui.js.map
