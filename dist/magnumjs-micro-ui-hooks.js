/*!
 * @magnumjs/micro-ui v1.10.1
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUIHooks=(()=>{var d=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var S=(e,n)=>{for(var t in n)d(e,t,{get:n[t],enumerable:!0})},v=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of g(n))!E.call(e,o)&&o!==t&&d(e,o,{get:()=>n[o],enumerable:!(r=C(n,o))||r.enumerable});return e};var x=e=>v(d({},"__esModule",{value:!0}),e);var P={};S(P,{useContext:()=>I,useEffect:()=>A,useEmit:()=>$,useEvent:()=>j,useEvents:()=>R,useFetch:()=>w,useState:()=>U});var y=null;function f(){return y}function w(e,n={}){let t=f();if(!t)throw new Error("useFetch must be called inside a component render or lifecycle");(!t.state||t.state.data===void 0&&t.state.loading===void 0&&t.state.error===void 0)&&t.setState({data:null,loading:!0,error:null});async function r(){t.setState(o=>({...o,loading:!0}));try{let u=await(await fetch(e,n)).json();t.setState({data:u,error:null,loading:!1}),t.emit&&t.emit("fetch::done",{url:e,data:u})}catch(o){t.setState({data:null,error:o,loading:!1}),t.emit&&t.emit("fetch::error",{url:e,error:o})}}return t.onMount(r),t.onEmit&&t.onEmit("fetch::refresh",r),{get:()=>({...t.state}),subscribe:o=>(t.onUpdate(()=>o({...t.state})),()=>{}),refresh:r}}var p={};function I(e,n={}){let t=f();if(!t)throw new Error("useContext() must be inside render()");p[e]||(p[e]={value:n,subs:new Set});let r=p[e];r.subs.add(t),t.onUnmount(()=>r.subs.delete(t));let o=u=>{r.value=typeof u=="function"?u(r.value):u,r.subs.forEach(s=>s.update())};return[r.value,o]}function U(e){let n=f();if(!n)throw new Error("useState must be inside render()");n._hasStateSetters||(n.state&&Object.keys(n.state).forEach(o=>{let u="set"+o.charAt(0).toUpperCase()+o.slice(1);n[u]||(n[u]=s=>{let i=n.state[o],a=typeof s=="function"?s(i):s;a!==i&&(n.state[o]=a,n.update())})}),n._hasStateSetters=!0);let t=n._renderIndex++;n._hooks||(n._hooks=[]),n._hooks[t]===void 0&&(n._hooks[t]=typeof e=="function"?e():e);let r=o=>{let u=n._hooks[t],s=typeof o=="function"?o(u):o;s!==u&&(n._hooks[t]=s,n.update())};return[n._hooks[t],r]}function A(e,n=[]){let t=f();if(!t)throw new Error("useEffect must be inside render()");let r=t._renderIndex++;t._hooks=t._hooks||[];let o=t._hooks[r]||[];if(n.length===0||n.some((s,i)=>s!==o[i])){let s;t.onUnmount(()=>s&&s()),s=e(),t._hooks[r]=n}}function m(){let e=new Map;return{subscribe(n,t){e.has(n)||e.set(n,new Set);let r=e.get(n);return r.add(t),()=>r.delete(t)},emit(n,t){let r=e.get(n);if(r)for(let o of r)o(t)},clear(){e.clear()}}}function M(e){let n=e,t=new Set;function r(s){typeof n=="object"&&n!==null&&typeof s=="object"&&s!==null&&!Array.isArray(n)&&!Array.isArray(s)?n={...n,...s}:n=typeof s=="function"?s(n):s,t.forEach(i=>i(n))}function o(s){return t.add(s),s(n),()=>t.delete(s)}function u(){return n}return{get:u,setState:r,getState:u,subscribe:o}}var c=m(),l=new Map;function k(e,n={}){if(!l.has(e)){let t=M(n),r={...t,emit(o,u){t.setState(u),c.emit(`${e}::${o}`,t.getState())},on(o,u){return c.subscribe(`${e}::${o}`,u)}};l.set(e,r)}return l.get(e)}k.clear=()=>l.clear();function $(){let e=f();if(!e)throw new Error("useEmit must be inside render()");if(e._hasEmits)return e._emitsApi;e._hasEmits=!0;let n=m(),t={emit:(r,o)=>n.emit(r,o),onEmit:(r,o)=>{let u=n.subscribe(r,o);return e.onUnmount(u),u},emitGlobal:(r,o)=>c.emit(r,o),onEmitGlobal:(r,o)=>{let u=c.subscribe(r,o);return e.onUnmount(u),u}};return Object.assign(e,t),e._emitsApi=t,e.onBeforeRender(function(){B(e,e.on)}),e.onUnmount(()=>{n.clear()}),t}function B(e,n={}){let t=[];Object.entries(n).forEach(([r,o])=>{if(r.includes("::")){let u=o.bind(e),s=c.subscribe(r,u);t.push(s)}else!r.includes(" ")&&!r.includes("*")&&!r.includes(":")&&e.onEmit(r,o.bind(e))}),e.onUnmount(()=>{t.forEach(r=>r()),t=[]})}function j(){let e=f();if(!e)throw new Error("useEvent must be inside render()");e._eventApi&&e._eventApi;function n(u){let s={on(i,a){return e.addEvent(`${i} [data-ref=${u}]`,a),s},onClick(i){return this.on("click",i)},onBlur(i){return this.on("blur",i)},onInput(i){return this.on("input",i)},onChange(i){return this.on("change",i)},onFocus(i){return this.on("focus",i)},onSubmit(i){return this.on("submit",i)},toString(){return`data-ref="${u}"`}};return s}function t(u){return s=>{let i=`h${e._renderIndex++}`;return e.addEvent(`${u} [data-ref=${i}]`,s),n(i)}}let r={onClick:t("click"),onBlur:t("blur"),onInput:t("input"),onChange:t("change"),onFocus:t("focus"),onSubmit:t("submit"),on:(u,s)=>t(u)(s)},o={...e.on};return e.prototype.on=r.on,Object.assign(e.on,o),e._eventApi=r,r}function R(){let e=f();if(!e)throw new Error("useEvent must be inside render()");if(e._events)return;function n(o){return o.replace(/<([a-zA-Z0-9-]+)([^>]*?)>/gs,(u,s,i)=>{let a=[...i.matchAll(/data-ref="([^"]+)"/g)].map(b=>b[1]);if(a.length<=1)return u;let h=`data-ref="${a.join(" ")}"`,_=i.replace(/\s*data-ref="[^"]*"/g,"");return`<${s} ${h}${_}>`})}e.onBeforeRender(n);let t={...e.on};e.on=function(u,s){u&&s&&e.addEvent(u,s)},Object.assign(e.on,t),e._events=1;function r(o){return u=>{let s=`h${e._renderIndex++}`;return e.addEvent(`${o} [data-ref~=${s}]`,u),`data-ref="${s}"`}}return{onClick:r("click")}}return x(P);})();
//# sourceMappingURL=magnumjs-micro-ui-hooks.js.map
