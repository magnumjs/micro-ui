/*!
 * @magnumjs/micro-ui v1.10.0
 * Author: Michael Glazer
 * Website: https://github.com/magnumjs/micro-ui#readme
 */
var MicroUIHooks=(()=>{var c=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var C=(n,t)=>{for(var e in t)c(n,e,{get:t[e],enumerable:!0})},g=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of _(t))!b.call(n,o)&&o!==e&&c(n,o,{get:()=>t[o],enumerable:!(r=h(t,o))||r.enumerable});return n};var E=n=>g(c({},"__esModule",{value:!0}),n);var j={};C(j,{useContext:()=>x,useEffect:()=>I,useEmit:()=>M,useFetch:()=>y,useState:()=>w});var S=null;function u(){return S}function y(n,t={}){let e=u();if(!e)throw new Error("useFetch must be called inside a component render or lifecycle");(!e.state||e.state.data===void 0&&e.state.loading===void 0&&e.state.error===void 0)&&e.setState({data:null,loading:!0,error:null});async function r(){e.setState(o=>({...o,loading:!0}));try{let s=await(await fetch(n,t)).json();e.setState({data:s,error:null,loading:!1}),e.emit&&e.emit("fetch::done",{url:n,data:s})}catch(o){e.setState({data:null,error:o,loading:!1}),e.emit&&e.emit("fetch::error",{url:n,error:o})}}return e.onMount(r),e.onEmit&&e.onEmit("fetch::refresh",r),{get:()=>({...e.state}),subscribe:o=>(e.onUpdate(()=>o({...e.state})),()=>{}),refresh:r}}var d={};function x(n,t={}){let e=u();if(!e)throw new Error("useContext() must be inside render()");d[n]||(d[n]={value:t,subs:new Set});let r=d[n];r.subs.add(e),e.onUnmount(()=>r.subs.delete(e));let o=s=>{r.value=typeof s=="function"?s(r.value):s,r.subs.forEach(i=>i.update())};return[r.value,o]}function w(n){let t=u();if(!t)throw new Error("useState must be inside render()");t._hasStateSetters||(t.state&&Object.keys(t.state).forEach(o=>{let s="set"+o.charAt(0).toUpperCase()+o.slice(1);t[s]||(t[s]=i=>{let f=t.state[o],m=typeof i=="function"?i(f):i;m!==f&&(t.state[o]=m,t.update())})}),t._hasStateSetters=!0);let e=t._renderIndex++;t._hooks||(t._hooks=[]),t._hooks[e]===void 0&&(t._hooks[e]=typeof n=="function"?n():n);let r=o=>{let s=t._hooks[e],i=typeof o=="function"?o(s):o;i!==s&&(t._hooks[e]=i,t.update())};return[t._hooks[e],r]}function I(n,t=[]){let e=u();if(!e)throw new Error("useEffect must be inside render()");let r=e._renderIndex++;e._hooks=e._hooks||[];let o=e._hooks[r]||[];if(t.length===0||t.some((i,f)=>i!==o[f])){let i;e.onUnmount(()=>i&&i()),i=n(),e._hooks[r]=t}}function p(){let n=new Map;return{subscribe(t,e){n.has(t)||n.set(t,new Set);let r=n.get(t);return r.add(e),()=>r.delete(e)},emit(t,e){let r=n.get(t);if(r)for(let o of r)o(e)},clear(){n.clear()}}}function U(n){let t=n,e=new Set;function r(i){typeof t=="object"&&t!==null&&typeof i=="object"&&i!==null&&!Array.isArray(t)&&!Array.isArray(i)?t={...t,...i}:t=typeof i=="function"?i(t):i,e.forEach(f=>f(t))}function o(i){return e.add(i),i(t),()=>e.delete(i)}function s(){return t}return{get:s,setState:r,getState:s,subscribe:o}}var l=p(),a=new Map;function v(n,t={}){if(!a.has(n)){let e=U(t),r={...e,emit(o,s){e.setState(s),l.emit(`${n}::${o}`,e.getState())},on(o,s){return l.subscribe(`${n}::${o}`,s)}};a.set(n,r)}return a.get(n)}v.clear=()=>a.clear();function M(){let n=u();if(!n)throw new Error("useEmit must be inside render()");if(n._hasEmits)return n._emitsApi;n._hasEmits=!0;let t=p(),e={emit:(r,o)=>t.emit(r,o),onEmit:(r,o)=>{let s=t.subscribe(r,o);return n.onUnmount(s),s},emitGlobal:(r,o)=>l.emit(r,o),onEmitGlobal:(r,o)=>{let s=l.subscribe(r,o);return n.onUnmount(s),s}};return Object.assign(n,e),n._emitsApi=e,A(n,n.on),n.onUnmount(()=>{t.clear()}),e}function A(n,t={}){let e=[];console.log("Context listeners registered:",Object.entries(t)),Object.entries(t).forEach(([r,o])=>{if(console.log(KeyboardEvent,o),r.includes("::")){let s=o.bind(n),i=l.subscribe(r,s);e.push(i)}else!r.includes(" ")&&!r.includes("*")&&!r.includes(":")&&n.onEmit(r,o.bind(n))}),n.onUnmount(()=>{e.forEach(r=>r()),e=[]})}return E(j);})();
//# sourceMappingURL=magnumjs-micro-ui-hooks.js.map
